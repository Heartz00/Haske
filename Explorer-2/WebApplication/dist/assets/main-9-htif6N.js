import{_ as L,o as p,r as j,S as g,t as z,a as we,b as he,s as ke,i as Le}from"./index-CkdC1qCT.js";import{e as n,f as l,E as s,g as D,Z as v,I as d,x as c,A as k,J as b,G as S,i as T,L as I,_ as x,$ as C,a0 as V,a1 as B,k as Me,a2 as me,a3 as Y,H as F,v as w,j as E,M as Q,D as Oe,a4 as Ce}from"./@vue-CXKnfUZt.js";import{b as G}from"./bootstrap-5y-2wTs5.js";/* empty css                        *//* empty css                     */import{c as Pe,a as $e}from"./vue-router-CIOaeZX7.js";import{m as P,a as Re}from"./vuex-BTKxU11I.js";import{P as q,j as ae,k as Ue,Q as oe,R as ne,F as le,N as Ae,E as re,f as Ee}from"./date-fns-CfkqNhwX.js";import{v as de}from"./uuid-CQkTLCs1.js";import{u as X}from"./uppie-BVBdnejX.js";import{$ as pe}from"./jquery-CYeU_ZbV.js";import{T as Fe}from"./bootstrap5-tags-UbNi5kvm.js";import{E as Ve}from"./jspdf-BzDPFVX0.js";import{F as Be,P as Ne,a as xe,T as He,A as H}from"./docx-pBPjU1yR.js";import{S as je}from"./signature_pad-DeBR_Uis.js";import{F as ze}from"./file-saver-DL08mUEU.js";import{K as Ge}from"./keycloak-js-BQppPikq.js";import{a as qe}from"./axios-CCb-kr4I.js";import{O as We}from"./@vuepic-D5L6H1b4.js";import{m as Je}from"./mitt-DJ65BbbF.js";import"./vue-i18n-DipsLOQt.js";import"./@intlify-Dg0E80p9.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./js-sha256-CSWIq9JC.js";import"./jwt-decode-VWaDGczM.js";function ge(){let e=getComputedStyle(document.documentElement).getPropertyValue("--bootstrap-theme");console.log("-------------- Applying Bootstrap theme ...",e),e?document.documentElement.setAttribute("data-bs-theme",e):(console.warn("-------------- Applying Bootstrap theme not defined yet, retrying ..."),setTimeout(ge,100))}const Ke={async created(){console.log("Creating App...");{console.log("Loading the defaults + custom CSS ...");let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href="customizable/custom.css",document.getElementsByTagName("HEAD")[0].appendChild(e),setTimeout(ge,0)}await this.$store.dispatch("configuration/load"),await this.$store.dispatch("studies/initialLoad"),await this.$store.dispatch("labels/refresh"),console.log("App created")}},Ye={class:"full-page"},Ze={class:"nav-side-layout"},Qe={class:"content"};function Xe(e,t,a,u,o,i){const r=v("router-view");return n(),l("div",Ye,[s("div",Ze,[D(r,{name:"SideBarView"})]),s("div",Qe,[D(r,{name:"ContentView"})])])}const et=L(Ke,[["render",Xe]]),tt={props:[],emits:[],data(){return{verboseLevel:"default",delayedDeletionPendingFilesCount:0}},async mounted(){if(this.verboseLevel=await p.getVerboseLevel(),this.hasDelayedDeletionPlugin){const e=await p.getDelayedDeletionStatus();this.delayedDeletionPendingFilesCount=e.FilesPendingDeletion}},methods:{async setVerboseLevel(e){this.verboseLevel=e,await p.setVerboseLevel(e)}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,tokens:e=>e.configuration.tokens,statistics:e=>e.studies.statistics,system:e=>e.configuration.system,installedPlugins:e=>e.configuration.installedPlugins}),totalDiskSize(){return this.statistics.TotalDiskSizeMB>1024*1024?Math.round(this.statistics.TotalDiskSizeMB/(1024*1024)*100)/100+" TB":this.statistics.TotalDiskSizeMB>1024?Math.round(this.statistics.TotalDiskSizeMB/1024*100)/100+" GB":this.statistics.TotalDiskSizeMB+" MB"},hasMaxPatientCount(){return this.system.MaximumPatientCount>0},hasMaxStorageSize(){return this.system.MaximumStorageSize>0},maxStorageSize(){return this.system.MaximumStorageSize>1024*1024?Math.round(this.system.MaximumStorageSize/(1024*1024)*100)/100+" TB":this.statistics.TotalDiskSizeMB>1024?Math.round(this.system.MaximumStorageSize/1024*100)/100+" GB":this.system.MaximumStorageSize+" MB"},hasDelayedDeletionPlugin(){return"delayed-deletion"in this.installedPlugins&&this.installedPlugins["delayed-deletion"].Enabled}}},st={class:"settings"},it={class:"table"},at={scope:"row",class:"w-50 header"},ot={key:0,class:"value"},nt={key:1,class:"value"},lt={scope:"row",class:"w-50 header"},rt={class:"value"},dt={scope:"row",class:"header"},ut={class:"value"},ct={scope:"row",class:"header"},ht={class:"value"},mt={scope:"row",class:"header"},pt={key:0,class:"value"},gt={key:1,class:"value"},bt={key:0},yt={scope:"row",class:"w-50 header"},ft={class:"value"},_t={class:"table"},Dt={scope:"row",class:"w-50 header"},vt={class:"value"},St={scope:"row",class:"header"},Tt={class:"value"},It={scope:"row",class:"header"},wt={class:"value"},kt={scope:"row",class:"header"},Lt={class:"value"},Mt={scope:"row",class:"header"},Ot={class:"value"},Ct={scope:"row",class:"header"},Pt={class:"value"},$t={scope:"row",class:"header"},Rt={class:"value"},Ut={class:"m-2"},At={style:{"text-decoration":"line-through"}},Et={class:"table"},Ft={scope:"row",class:"w-25 header"},Vt={class:"w-50 value"},Bt={class:"w-15 value"},Nt={key:0,class:"w-15 value"},xt=["href"];function Ht(e,t,a,u,o,i){return n(),l("div",st,[s("div",null,[s("h5",null,d(e.$t("settings.statistics")),1),s("table",it,[s("tbody",null,[s("tr",null,[s("th",at,"# "+d(e.$t("patients")),1),i.hasMaxPatientCount?c("",!0):(n(),l("td",ot,d(e.statistics.CountPatients),1)),i.hasMaxPatientCount?(n(),l("td",nt,d(e.statistics.CountPatients)+" / "+d(e.system.MaximumPatientCount)+" ("+d(e.system.MaximumStorageMode)+")",1)):c("",!0)]),s("tr",null,[s("th",lt,"# "+d(e.$t("studies")),1),s("td",rt,d(e.statistics.CountStudies),1)]),s("tr",null,[s("th",dt,"# "+d(e.$t("series_plural")),1),s("td",ut,d(e.statistics.CountSeries),1)]),s("tr",null,[s("th",ct,"# "+d(e.$t("instances")),1),s("td",ht,d(e.statistics.CountInstances),1)]),s("tr",null,[s("th",mt,d(e.$t("settings.storage_size")),1),i.hasMaxStorageSize?c("",!0):(n(),l("td",pt,d(i.totalDiskSize),1)),i.hasMaxStorageSize?(n(),l("td",gt,d(i.totalDiskSize)+" / "+d(i.maxStorageSize)+" ("+d(e.system.MaximumStorageMode)+")",1)):c("",!0)]),i.hasDelayedDeletionPlugin?(n(),l("tr",bt,[s("th",yt,"# "+d(e.$t("plugins.delayed_deletion.pending_files_count")),1),s("td",ft,d(o.delayedDeletionPendingFilesCount),1)])):c("",!0)])])]),s("div",null,[s("h5",null,d(e.$t("settings.orthanc_system_info")),1),s("table",_t,[s("tbody",null,[s("tr",null,[s("th",Dt,d(e.$t("settings.orthanc_version")),1),s("td",vt,d(e.system.Version),1)]),s("tr",null,[s("th",St,d(e.$t("settings.dicom_AET")),1),s("td",Tt,d(e.system.DicomAet),1)]),s("tr",null,[s("th",It,d(e.$t("settings.orthanc_name")),1),s("td",wt,d(e.system.Name),1)]),s("tr",null,[s("th",kt,d(e.$t("settings.dicom_port")),1),s("td",Lt,d(e.system.DicomPort),1)]),s("tr",null,[s("th",Mt,d(e.$t("settings.ingest_transcoding")),1),s("td",Ot,d(e.system.IngestTranscoding),1)]),s("tr",null,[s("th",Ct,d(e.$t("settings.overwrite_instances")),1),s("td",Pt,d(e.system.OverwriteInstances),1)]),s("tr",null,[s("th",$t,d(e.$t("settings.storage_compression")),1),s("td",Rt,d(e.system.StorageCompression),1)])])])]),s("div",null,[s("h5",null,d(e.$t("settings.verbosity_level")),1),s("div",null,[s("button",{type:"button",class:k(["btn mx-2",{"btn-primary":o.verboseLevel=="default","btn-secondary":o.verboseLevel!="default"}]),onClick:t[0]||(t[0]=r=>i.setVerboseLevel("default"))},d(e.$t("default")),3),s("button",{type:"button",class:k(["btn mx-2",{"btn-primary":o.verboseLevel=="verbose","btn-secondary":o.verboseLevel!="verbose"}]),onClick:t[1]||(t[1]=r=>i.setVerboseLevel("verbose"))},d(e.$t("verbose")),3),s("button",{type:"button",class:k(["btn mx-2",{"btn-primary":o.verboseLevel=="trace","btn-secondary":o.verboseLevel!="trace"}]),onClick:t[2]||(t[2]=r=>i.setVerboseLevel("trace"))},d(e.$t("trace")),3)])]),s("div",null,[s("h5",null,d(e.$t("settings.installed_plugins")),1),s("p",Ut,[b(d(e.$t("settings.plugins_not_enabled"))+" ",1),s("span",At,d(e.$t("settings.striked_through")),1)]),s("table",Et,[s("tbody",null,[(n(!0),l(S,null,T(e.installedPlugins,(r,h)=>(n(),l("tr",{key:h,class:k({"disabled-plugin":!r.Enabled})},[s("th",Ft,d(h),1),s("td",Vt,d(r.Description),1),s("td",Bt,d(r.Version),1),this.tokens.RequiredForLinks?c("",!0):(n(),l("td",Nt,[r.RootUri&&r.Enabled?(n(),l("a",{key:0,type:"button",class:"btn btn-primary",href:r.RootUri},d(e.$t("open")),9,xt)):c("",!0)]))],2))),128))])])])])}const jt=L(tt,[["render",Ht],["__scopeId","data-v-f1ecd415"]]),be={filterLabel(e){const t=new RegExp("^[0-9-_a-zA-Z]+$");return e&&e.length>0&&!t.test(e)&&(console.log("invalid label: ",e),document.querySelectorAll(".invalid-label-tips").forEach(u=>{u.classList.remove("invalid-label-tips-hidden")}),setTimeout(()=>{document.querySelectorAll(".invalid-label-tips").forEach(o=>{o.classList.add("invalid-label-tips-hidden")})},8e3)),e.replace(/[^0-9\-\_a-zA-Z]/gi,"")}},zt={props:[],emits:[],data(){return{availableLabels:[],originalAvailableLabelsFromConfig:[],allUsedLabels:[],allOriginalLabels:[],newLabel:"",limitAvailableLabels:!1,originalLimitAvailableLabels:!1}},async mounted(){await this.reset()},methods:{async reset(){let e=await p.getRolesConfig();this.newLabel="",this.originalAvailableLabelsFromConfig=e["available-labels"],this.allUsedLabels=await p.loadAllLabels(),this.originalAvailableLabelsFromConfig.length==0?(console.log("The available-labels list in the configuration is empty, getting the list of all current labels"),this.limitAvailableLabels=!1,this.allOriginalLabels=this.allUsedLabels,this.availableLabels=[...this.allUsedLabels]):(this.limitAvailableLabels=!0,this.availableLabels=[...this.originalAvailableLabelsFromConfig],this.allOriginalLabels=[...this.originalAvailableLabelsFromConfig]),this.originalLimitAvailableLabels=this.limitAvailableLabels},createLabel(){this.availableLabels.indexOf(this.newLabel)==-1&&(this.availableLabels.push(this.newLabel),this.availableLabels=this.availableLabels.sort()),this.newLabel=""},deleteLabel(e,t){let a=this.availableLabels.indexOf(t);a!=-1&&this.availableLabels.splice(a,1)},async save(){let e=await p.getRolesConfig();this.limitAvailableLabels?e["available-labels"]=this.availableLabels:e["available-labels"]=[],await p.setRolesConfig(e),await this.$store.dispatch("configuration/load"),this.reset()},cancel(){this.reset()},labelKeyPressed(e){let t=e.target.value;this.newLabel=be.filterLabel(t),e.keyCode==13&&this.createLabel()},canDeleteLabel(e){return this.allUsedLabels.indexOf(e)==-1}},computed:{...P({uiOptions:e=>e.configuration.uiOptions}),hasChanged(){return this.originalLimitAvailableLabels!=this.limitAvailableLabels||this.availableLabels.length!=this.allOriginalLabels.length||!this.availableLabels.every((e,t)=>e===this.allOriginalLabels[t])}},watch:{}},Gt=e=>(V("data-v-e2640a21"),e=e(),B(),e),qt={class:"settings"},Wt={class:"w-100 p-2 mx-0"},Jt={class:"form-check mt-3"},Kt={class:"form-check-label",for:"limit_labels"},Yt={class:"mt-1"},Zt=["innerHTML"],Qt={class:"form-check",style:{height:"3rem"}},Xt={for:"new-label-input",class:"form-label"},es={class:"invalid-label-tips invalid-label-tips-hidden"},ts={class:"form-check d-flex"},ss=["disabled"],is=["disabled"],as={class:"labels-list mt-5"},os=["onClick","disabled"],ns=Gt(()=>s("i",{class:"bi-trash"},null,-1)),ls=[ns],rs={class:"d-flex justify-content-end"},ds=["disabled"],us=["disabled"];function cs(e,t,a,u,o,i){return n(),l("div",qt,[s("div",null,[s("h5",null,d(e.$t("settings.available_labels_title")),1),s("div",Wt,[s("div",Jt,[I(s("input",{class:"form-check-input",type:"checkbox",value:"",id:"limit_labels","onUpdate:modelValue":t[0]||(t[0]=r=>o.limitAvailableLabels=r)},null,512),[[x,o.limitAvailableLabels]]),s("label",Kt,d(e.$t("settings.labels_limit_available_labels")),1)]),s("div",Yt,[s("p",{class:k(["instructions-text",{"instructions-text-disabled":!o.limitAvailableLabels}]),innerHTML:e.$t("settings.available_labels_global_instructions_html")},null,10,Zt)]),s("div",Qt,[s("label",Xt,[s("span",es,d(e.$t("labels.valid_alphabet_warning")),1)])]),s("div",ts,[I(s("input",{id:"new-label-input",type:"text",class:"form-control w-50","onUpdate:modelValue":t[1]||(t[1]=r=>o.newLabel=r),onKeyup:t[2]||(t[2]=r=>i.labelKeyPressed(r)),disabled:!o.limitAvailableLabels},null,40,ss),[[C,o.newLabel]]),s("button",{type:"button",class:"btn btn-sm btn-secondary m-1",onClick:t[3]||(t[3]=(...r)=>i.createLabel&&i.createLabel(...r)),disabled:!o.limitAvailableLabels},d(e.$t("settings.create_new_label")),9,is)]),s("div",as,[(n(!0),l(S,null,T(o.availableLabels,r=>(n(),l("div",{key:r,class:"labels-item border d-flex justify-content-between align-items-center"},[s("span",{class:k(["list-group-item-with-button-content",{"disabled-label":!o.limitAvailableLabels}])},d(r),3),s("button",{type:"button",class:"btn labels-button",onClick:h=>i.deleteLabel(h,r),disabled:!i.canDeleteLabel(r)||!o.limitAvailableLabels},ls,8,os)]))),128))])]),s("div",rs,[s("button",{type:"button",class:"btn btn-primary mx-1",disabled:!i.hasChanged,onClick:t[4]||(t[4]=(...r)=>i.save&&i.save(...r))},d(e.$t("save")),9,ds),s("button",{type:"button",class:"btn btn-secondary mx-1",disabled:!i.hasChanged,onClick:t[5]||(t[5]=(...r)=>i.cancel&&i.cancel(...r))},d(e.$t("cancel")),9,us)])])])}const hs=L(zt,[["render",cs],["__scopeId","data-v-e2640a21"]]),ms={props:[],emits:[],data(){return{allLabels:[],selectedLabels:[],allLabelPermissions:[],allGlobalPermissions:["admin-permissions","edit-labels","q-r-remote-modalities","settings","upload"],selectedLabelPermissions:[],selectedGlobalPermissions:[],hasAllLabelsAllowed:!1,currentConfig:{},originalConfig:{},selectedRole:null,hasChanged:!1}},async mounted(){var e=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));e.map(function(t){return new G.Popover(t)}),this.reset()},watch:{hasAllLabelsAllowed(e,t){e&&(this.selectedLabels=[]),this.updateHasChanged()},selectedRole(e,t){this.updateHasChanged()},selectedLabels(e,t){this.updateHasChanged()},selectedLabelPermissions(e,t){this.updateHasChanged()}},methods:{async reset(){if(this.originalConfig=await p.getRolesConfig(),this.currentConfig=JSON.parse(JSON.stringify(this.originalConfig)),this.allLabelPermissions=this.filterLabelPermissions(await p.getPermissionsList(),!1),this.allGlobalPermissions=this.filterGlobalPermissions(await p.getPermissionsList(),!1),this.allLabels=this.currentConfig["available-labels"],this.allLabels.length==0&&(console.log("The available-labels list is empty, getting the list of all current labels"),this.allLabels=await p.loadAllLabels()),this.selectedRole==null){let e=Object.keys(this.currentConfig.roles)[0];this.selectRole(e)}else this.selectRole(this.selectedRole);this.updateHasChanged()},filterLabelPermissions(e,t){return t&&e.indexOf("all")!=-1?[...this.allLabelPermissions]:e.filter(u=>this.allGlobalPermissions.indexOf(u)==-1&&u!="all")},filterGlobalPermissions(e,t){return t&&e.indexOf("all")!=-1?[...this.allGlobalPermissions]:e.filter(u=>this.allGlobalPermissions.indexOf(u)!=-1)},getCurrentUiRoles(){if(this.selectedRole!=null){let e=JSON.parse(JSON.stringify(this.currentConfig)),t=[...this.selectedLabelPermissions].concat(this.selectedGlobalPermissions);return e.roles[this.selectedRole].permissions=t,this.hasAllLabelsAllowed?e.roles[this.selectedRole]["authorized-labels"]=["*"]:e.roles[this.selectedRole]["authorized-labels"]=this.selectedLabels,e}else return this.currentConfig},selectRole(e){this.selectedRole!=null&&(this.currentConfig=this.getCurrentUiRoles()),this.selectedRole=e,this.selectedLabelPermissions=this.filterLabelPermissions(this.currentConfig.roles[this.selectedRole].permissions,!0),this.selectedGlobalPermissions=this.filterGlobalPermissions(this.currentConfig.roles[this.selectedRole].permissions,!0),this.selectedLabels=this.currentConfig.roles[this.selectedRole]["authorized-labels"],this.hasAllLabelsAllowed=this.currentConfig.roles[this.selectedRole]["authorized-labels"].indexOf("*")!=-1},isRoleSelected(e){return this.selectedRole==e},isLabelSelected(e){return this.selectedLabels.indexOf(e)!=-1},toggleSelectedLabel(e,t){e.preventDefault();let a=this.selectedLabels.indexOf(t);a!=-1?this.selectedLabels.splice(a,1):this.selectedLabels.push(t),this.updateHasChanged()},selectAllLabels(){this.selectedLabels=[...this.allLabels]},clearSelectedLabels(){this.selectedLabels=[]},isPermissionSelected(e,t){return t=="label"?this.selectedLabelPermissions.indexOf(e)!=-1:this.selectedGlobalPermissions.indexOf(e)!=-1},toggleSelectedPermission(e,t,a){if(e.preventDefault(),a=="label"){let u=this.selectedLabelPermissions.indexOf(t);u!=-1?this.selectedLabelPermissions.splice(u,1):this.selectedLabelPermissions.push(t)}else{let u=this.selectedGlobalPermissions.indexOf(t);u!=-1?this.selectedGlobalPermissions.splice(u,1):this.selectedGlobalPermissions.push(t)}this.updateHasChanged()},clearSelectedLabelPermissions(){this.selectedLabelPermissions=[]},selectAllLabelPermissions(){this.selectedLabelPermissions=[...this.allLabelPermissions]},clearSelectedGlobalPermissions(){this.selectedGlobalPermissions=[]},selectAllGlobalPermissions(){this.selectedGlobalPermissions=[...this.allGlobalPermissions]},updateHasChanged(){let e=JSON.stringify(this.originalConfig),t=JSON.stringify(this.getCurrentUiRoles());return console.log("hasChanged",this.originalConfig,this.getCurrentUiRoles()),console.log("hasChanged original ",e),console.log("hasChanged current ",t),this.hasChanged=e!=t},async save(){let e=await p.getRolesConfig(),t=this.getCurrentUiRoles();t["available-labels"]=e["available-labels"],await p.setRolesConfig(t),this.reset()},cancel(){this.reset()}},computed:{...P({uiOptions:e=>e.configuration.uiOptions}),labels(){return this.allLabels},isLabelsListEmpty(){return this.allLabels.length==0},labelPermissions(){return this.allLabelPermissions},globalPermissions(){return this.allGlobalPermissions},allRoles(){return this.currentConfig&&"roles"in this.currentConfig?Object.keys(this.currentConfig.roles).sort():[]}}},A=e=>(V("data-v-3d00788b"),e=e(),B(),e),ps={class:"settings"},gs={class:"container"},bs=["innerHTML"],ys={class:"row"},fs={class:"col-3 border-end border-3"},_s=A(()=>s("i",{class:"bi bi-people-fill"},null,-1)),Ds=["data-bs-content"],vs={class:"col-9"},Ss={class:"row"},Ts=A(()=>s("div",{class:"col-3 border-end border-3"},null,-1)),Is={class:"col-3"},ws=A(()=>s("i",{class:"bi bi-key-fill"},null,-1)),ks=["data-bs-content"],Ls={class:"col-6"},Ms=A(()=>s("i",{class:"bi bi-tags-fill"},null,-1)),Os=["data-bs-content"],Cs={class:"row"},Ps=A(()=>s("div",{class:"col-3 border-end border-3"},null,-1)),$s={class:"col-3"},Rs={class:""},Us=["title"],As=A(()=>s("i",{class:"bi bi-list-check"},null,-1)),Es=[As],Fs=["title"],Vs=A(()=>s("i",{class:"bi bi-x-circle"},null,-1)),Bs=[Vs],Ns={class:"col-6"},xs={class:""},Hs=["disabled","title"],js=A(()=>s("i",{class:"bi bi-list-check"},null,-1)),zs=[js],Gs=["disabled","title"],qs=A(()=>s("i",{class:"bi bi-x-circle"},null,-1)),Ws=[qs],Js={class:"row"},Ks={class:"col-3 border-end border-3 permissions-body",style:{height:"auto"}},Ys={class:"list-group"},Zs=["onClick"],Qs={class:"col-3 permissions-body"},Xs={class:"list-group"},ei=["onClick"],ti={class:"col-6 mb-3"},si={class:"form-check"},ii={class:"form-check-label",for:"all_future_labels"},ai=["onClick","disabled"],oi={class:"list-group-item-with-button-content"},ni={class:"w-100 text-center"},li={class:"row"},ri=A(()=>s("div",{class:"col-3 pt-3 border-end border-3"},null,-1)),di={class:"col-3 pt-3 permission-body-global border-top border-3"},ui={class:""},ci=["title"],hi=A(()=>s("i",{class:"bi bi-list-check"},null,-1)),mi=[hi],pi=["title"],gi=A(()=>s("i",{class:"bi bi-x-circle"},null,-1)),bi=[gi],yi={class:"list-group"},fi=["onClick"],_i=A(()=>s("div",{class:"col-6 pt-3 permission-body-global border-top border-3"},null,-1)),Di={class:"d-flex justify-content-end mt-2 mb-4"},vi=["disabled"],Si=["disabled"];function Ti(e,t,a,u,o,i){return n(),l("div",ps,[s("div",gs,[s("h5",null,d(e.$t("settings.permissions")),1),s("p",{class:"instructions",innerHTML:e.$t("settings.permissions_global_instructions_html")},null,8,bs),s("div",ys,[s("div",fs,[s("h6",null,[_s,b(" "+d(e.$t("settings.roles_title"))+" ",1),s("button",{class:"btn btn-sm bi bi-info-circle","data-bs-toggle":"popover","data-bs-trigger":"focus","data-bs-content":e.$t("settings.roles_description_html")},null,8,Ds)])]),s("div",vs,[s("h6",null,d(e.$t("settings.labels_based_permissions_title")),1)])]),s("div",Ss,[Ts,s("div",Is,[s("h6",null,[ws,b(d(e.$t("settings.permissions"))+" ",1),s("button",{class:"btn btn-sm bi bi-info-circle","data-bs-toggle":"popover","data-bs-trigger":"focus","data-bs-content":e.$t("settings.permissions_instructions")},null,8,ks)])]),s("div",Ls,[s("h6",null,[Ms,b(" "+d(e.$t("settings.labels_title"))+" ",1),s("button",{class:"btn btn-sm bi bi-info-circle","data-bs-toggle":"popover","data-bs-trigger":"focus","data-bs-content":e.$t("settings.labels_description_html")},null,8,Os)])])]),s("div",Cs,[Ps,s("div",$s,[s("p",Rs,[s("button",{type:"button",class:"btn btn-select btn-secondary",onClick:t[0]||(t[0]=r=>i.selectAllLabelPermissions()),"data-bs-toggle":"tooltip",title:e.$t("settings.select_all_label_permissions")},Es,8,Us),s("button",{type:"button",class:"btn btn-select btn-secondary",onClick:t[1]||(t[1]=r=>i.clearSelectedLabelPermissions()),"data-bs-toggle":"tooltip",title:e.$t("settings.permissions_clear_selection")},Bs,8,Fs)])]),s("div",Ns,[s("p",xs,[s("button",{type:"button",class:"btn btn-select btn-secondary",onClick:t[2]||(t[2]=r=>i.selectAllLabels()),disabled:o.hasAllLabelsAllowed,"data-bs-toggle":"tooltip",title:e.$t("settings.labels_select_all_currents")},zs,8,Hs),s("button",{type:"button",class:"btn btn-select btn-secondary",onClick:t[3]||(t[3]=r=>i.clearSelectedLabels()),disabled:o.hasAllLabelsAllowed,"data-bs-toggle":"tooltip",title:e.$t("settings.labels_clear_selection")},Ws,8,Gs)])])]),s("div",Js,[s("div",Ks,[s("div",Ys,[(n(!0),l(S,null,T(this.allRoles,r=>(n(),l("button",{key:r,type:"button",class:k(["list-group-item list-group-item-action",{active:i.isRoleSelected(r)}]),onClick:h=>i.selectRole(r)},d(r),11,Zs))),128))])]),s("div",Qs,[s("div",Xs,[(n(!0),l(S,null,T(i.labelPermissions,r=>(n(),l("label",{key:r,class:k(["list-group-item",{active:i.isPermissionSelected(r,"label")}]),onClick:h=>i.toggleSelectedPermission(h,r,"label")},d(r),11,ei))),128))])]),s("div",ti,[s("div",si,[I(s("input",{class:"form-check-input",type:"checkbox",value:"",id:"all_future_labels","onUpdate:modelValue":t[4]||(t[4]=r=>o.hasAllLabelsAllowed=r)},null,512),[[x,o.hasAllLabelsAllowed]]),s("label",ii,d(e.$t("settings.allow_all_currents_and_futures_labels")),1)]),s("div",{class:k(["labels-list",{"d-none":i.isLabelsListEmpty}])},[(n(!0),l(S,null,T(i.labels,r=>(n(),l("button",{key:r,onClick:h=>i.toggleSelectedLabel(h,r),class:k(["labels-item border d-flex justify-content-between align-items-center",{"is-label-selected":i.isLabelSelected(r),"is-label-not-selected":!i.isLabelSelected(r)}]),disabled:o.hasAllLabelsAllowed},[s("span",oi,d(r),1)],10,ai))),128))],2),s("div",{class:k(["labels-list mt-4",{"d-none":!i.isLabelsListEmpty}])},[s("p",ni,d(e.$t("settings.labels_list_empty")),1)],2)])]),s("div",li,[ri,s("div",di,[s("h6",null,d(e.$t("settings.global_permissions_title")),1),s("p",ui,[s("button",{type:"button",class:"btn btn-select btn-secondary",onClick:t[5]||(t[5]=r=>i.selectAllGlobalPermissions()),"data-bs-toggle":"tooltip",title:e.$t("settings.select_all_global_permissions")},mi,8,ci),s("button",{type:"button",class:"btn btn-select btn-secondary",onClick:t[6]||(t[6]=r=>i.clearSelectedGlobalPermissions()),"data-bs-toggle":"tooltip",title:e.$t("settings.permissions_clear_selection")},bi,8,pi)]),s("div",yi,[(n(!0),l(S,null,T(i.globalPermissions,r=>(n(),l("label",{key:r,class:k(["list-group-item",{active:i.isPermissionSelected(r,"global")}]),onClick:h=>i.toggleSelectedPermission(h,r,"global")},d(r),11,fi))),128))])]),_i]),s("div",Di,[s("button",{type:"button",class:"btn btn-primary mx-1",disabled:!o.hasChanged,onClick:t[7]||(t[7]=(...r)=>i.save&&i.save(...r))},d(e.$t("save")),9,vi),s("button",{type:"button",class:"btn btn-secondary mx-1",disabled:!o.hasChanged,onClick:t[8]||(t[8]=(...r)=>i.cancel&&i.cancel(...r))},d(e.$t("cancel")),9,Si)])])])}const Ii=L(ms,[["render",Ti],["__scopeId","data-v-3d00788b"]]),wi={props:["id","headerText","bodyText","cancelText","okText"],methods:{ok(){this.$emit("ok")}},mounted(){this.$refs["modal-main-div"].addEventListener("show.bs.modal",e=>{document.querySelector("body").appendChild(e.target)})}},ki=["id"],Li={class:"modal-dialog"},Mi={class:"modal-content"},Oi={class:"modal-header"},Ci={class:"modal-title",id:"modalLabel"},Pi=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),$i={class:"modal-body"},Ri=["innerHTML"],Ui={class:"modal-footer"},Ai={key:0,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function Ei(e,t,a,u,o,i){return n(),l("div",{class:"modal fade",id:this.id,tabindex:"-1","aria-labelledby":"modalLabel",ref:"modal-main-div"},[s("div",Li,[s("div",Mi,[s("div",Oi,[s("h5",Ci,d(a.headerText),1),Pi]),s("div",$i,[Me(e.$slots,"modalBody",{},()=>[s("span",{innerHTML:a.bodyText},null,8,Ri)])]),s("div",Ui,[a.cancelText?(n(),l("button",Ai,d(a.cancelText),1)):c("",!0),s("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[0]||(t[0]=r=>i.ok())},d(a.okText),1)])])])],8,ki)}const ee=L(wi,[["render",Ei]]),te={copyToClipboard(e,t,a){if(navigator.clipboard)navigator.clipboard.writeText(e).then(()=>{t!==void 0?t():console.log("copied to clipboard: ",e)},()=>{a!==void 0?a():console.log("failed to copy to clipboard")});else{const u=document.createElement("TEXTAREA"),o=document.activeElement;u.value=e,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),o.focus(),t!==void 0?t():console.log("hopefully copied to clipboard: ",e)}}},Fi={props:["valueToCopy"],setup(){return{}},data(){return{isSuccess:!1,isError:!1}},mounted(){},methods:{onSuccess(){console.log("copied to clipboard: "+this.valueToCopy),this.isSuccess=!0,this.isError=!1,setTimeout(()=>{this.isSuccess=!1},2500)},onFailure(){console.log("failed to copy to clipboard"),this.isSuccess=!1,this.isError=!0,setTimeout(()=>{this.isError=!1},2500)},click(){te.copyToClipboard(this.valueToCopy,()=>this.onSuccess(),()=>this.onFailure())}},computed:{},components:{}},Vi={key:0,class:"bi-check"},Bi={key:1,class:"bi-bug"},Ni={key:2,class:"bi-clipboard"};function xi(e,t,a,u,o,i){return this.valueToCopy!==void 0?(n(),l("button",{key:0,class:k(["btn-clipboard",{success:o.isSuccess,error:o.isError}]),type:"button","data-bs-toggle":"tooltip",title:"Copy to clipboard",onClick:t[0]||(t[0]=(...r)=>i.click&&i.click(...r))},[this.isSuccess?(n(),l("i",Vi)):c("",!0),this.isError?(n(),l("i",Bi)):c("",!0),!this.isSuccess&&!this.isError?(n(),l("i",Ni)):c("",!0)],2)):c("",!0)}const J=L(Fi,[["render",xi]]),Hi={props:["id","orthancId","studyMainDicomTags","patientMainDicomTags"],data(){return{expirationInDays:0,shareLink:""}},mounted(){this.reset(),this.$refs["modal-main-div"].addEventListener("show.bs.modal",e=>{document.querySelector("body").appendChild(e.target),this.reset()})},watch:{expirationInDays(e,t){this.shareLink=""}},methods:{async reset(){this.expirationInDays=this.uiOptions.DefaultShareDuration,this.shareLink=""},getDurationText(e){return e==0?this.$i18n.t("share.never"):""+e+" "+this.$i18n.t("share.days")},async share(){let e=[this.orthancId];this.isBulkSelection&&(e=this.selectedStudiesIds);let t=await p.createToken({tokenType:this.tokens.ShareType,resourcesIds:e,level:"study",validityDuration:this.expirationInDays*24*3600});this.shareLink=t.Url},copyAndClose(){te.copyToClipboard(this.shareLink)}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,tokens:e=>e.configuration.tokens,selectedStudiesIds:e=>e.studies.selectedStudiesIds}),isBulkSelection(){return!(this.patientMainDicomTags&&this.studyMainDicomTags&&Object.keys(this.patientMainDicomTags).length>0&&Object.keys(this.studyMainDicomTags).length>0)},resourceTitle(){return this.isBulkSelection?"":j.getResourceTitle("study",this.patientMainDicomTags,this.studyMainDicomTags,null,null)},studiesCount(){return this.selectedStudiesIds.length}},components:{CopyToClipboardButton:J}},ji=["id"],zi={class:"modal-dialog"},Gi={class:"modal-content"},qi={class:"modal-header"},Wi={key:0,class:"modal-title",id:"modalLabel"},Ji={key:1,class:"modal-title",id:"modalLabel"},Ki=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Yi={class:"modal-body"},Zi={class:"container"},Qi={class:"row py-3"},Xi={class:"col-md-6"},ea={class:"col-md-5"},ta=["value"],sa={class:"row py-3"},ia={class:"col-md-3"},aa={class:"col-md-8"},oa={id:"parent",style:{width:"100%"}},na={class:"col-md-1"},la={class:"d-flex flex-row-reverse"},ra={class:"modal-footer"},da={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function ua(e,t,a,u,o,i){const r=v("CopyToClipboardButton");return n(),l("div",{class:"modal fade",id:this.id,tabindex:"-1","aria-labelledby":"modalLabel",ref:"modal-main-div"},[s("div",zi,[s("div",Gi,[s("div",qi,[i.isBulkSelection?c("",!0):(n(),l("h5",Wi,d(e.$t("share.modal_title")+" "+i.resourceTitle),1)),i.isBulkSelection?(n(),l("h5",Ji,d(e.$t("share.modal_title_multiple_studies",{count:i.studiesCount})),1)):c("",!0),Ki]),s("div",Yi,[s("div",Zi,[s("div",Qi,[s("div",Xi,d(e.$t("share.expires_in")),1),s("div",ea,[I(s("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=h=>o.expirationInDays=h)},[(n(!0),l(S,null,T(e.uiOptions.ShareDurations,h=>(n(),l("option",{key:h,value:h},d(i.getDurationText(h)),9,ta))),128))],512),[[me,o.expirationInDays]])])]),s("div",sa,[s("div",ia,d(e.$t("share.link")),1),s("div",aa,[s("div",oa,[I(s("input",{type:"text",id:"txt_input","onUpdate:modelValue":t[1]||(t[1]=h=>o.shareLink=h),style:{"min-width":"100%!important"}},null,512),[[C,o.shareLink]])])]),s("div",na,[s("div",la,[D(r,{valueToCopy:this.shareLink},null,8,["valueToCopy"])])])])])]),s("div",ra,[s("button",da,d(e.$t("cancel")),1),o.shareLink==""?(n(),l("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=h=>i.share())},d(e.$t("share.button_title")),1)):c("",!0),o.shareLink!=""?(n(),l("button",{key:1,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[3]||(t[3]=h=>i.copyAndClose())},d(e.$t("share.copy_and_close")),1)):c("",!0)])])])],8,ji)}const ca=L(Hi,[["render",ua]]);document._datePickerPresetRanges=[{tLabel:"date_picker.today",value:[new Date,new Date]},{tLabel:"date_picker.yesterday",value:[q(new Date,1),q(new Date,1)]},{tLabel:"date_picker.this_week",value:[ae(new Date,{weekStartsOn:1}),new Date]},{tLabel:"date_picker.last_week",value:[ae(q(new Date,7),{weekStartsOn:1}),Ue(q(new Date,7),{weekStartsOn:1})]},{tLabel:"date_picker.this_month",value:[oe(new Date),ne(new Date)]},{tLabel:"date_picker.last_month",value:[oe(le(new Date,1)),ne(le(new Date,1))]},{tLabel:"date_picker.last_12_months",value:[Ae(new Date,1),new Date]}];const $={parse(e,t){return re(e,t,0)},toDicomDate(e){return(e.getFullYear()*1e4+(e.getMonth()+1)*100+e.getDate()).toString()},fromDicomDate(e){let t=null;return t=e.match(/^(\d{4})(\d{1,2})(\d{1,2})$/),t?new Date(t[1],t[2]-1,t[3]):null},parseDateForDatePicker(e){let t=null;return t=e.match(/^(\d{4})(\d{1,2})(\d{1,2})$/),t?[new Date(t[1],t[2]-1,t[3]),null]:(t=e.match(/^(\d{4})(\d{1,2})(\d{1,2})\-(\d{4})(\d{1,2})(\d{1,2})$/),t?[new Date(t[1],t[2]-1,t[3]),new Date(t[4],t[5]-1,t[6])]:null)},dicomDateFromDatePicker(e){let t="";return e==null?t=null:e instanceof Date?t=this.toDicomDate(e):e instanceof Array&&(e.length==2&&e[0]!=null&&e[0].getFullYear!=null&&e[1]!=null&&e[1].getFullYear!=null?this.toDicomDate(e[0])==this.toDicomDate(e[1])?t=this.toDicomDate(e[0]):t=this.toDicomDate(e[0])+"-"+this.toDicomDate(e[1]):e.length>=1&&e[0].getFullYear!=null?t=this.toDicomDate(e[0]):e.length==2&&typeof e[0]=="string"&&typeof e[1]=="string"?t=e[0]+"-"+e[1]:e.length==1&&typeof e[0]=="string"&&(t=e[0])),t},formatDateForDisplay(e,t){if(e&&e.length==8){let a=re(e,"yyyyMMdd",new Date);return Ee(a,t)}else return""},isDateTag(e){return["StudyDate","PatientBirthDate","SeriesDate","AcquisitionDate","ContentDate"].indexOf(e)!=-1}};document.requiredTags=["PatientID","PatientBirthDate","PatientSex",,"PatientName","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","ReferringPhysicianName","StudyID","SeriesInstanceUID","Modality","ContrastBolusAgent","SeriesNumber","ImageOrientationPatient","SeriesType"];const ha={props:["orthancId","studyMainDicomTags","patientMainDicomTags","seriesMainDicomTags","isAnonymization","resourceLevel"],data(){return{tags:{},dateTags:{},originalTags:{},removedTags:{},insertedTags:new Set,samePatientStudiesCount:0,hasLoadedSamePatientsStudiesCount:!1,errorMessageId:null,warningMessageId:null,jobProgressComplete:0,jobProgressFailed:0,jobProgressRemaining:100,jobRefreshTimeout:200,jobIsComplete:!1,jobIsRunning:!1,jobIsSuccess:!1,showModifiedResourceKey:null,showModifiedResourceValue:null,modificationMode:null,step:"init",action:"none"}},async mounted(){this.$refs["modal-main-div"].addEventListener("show.bs.modal",e=>{document.querySelector("body").appendChild(e.target),this.reset()})},methods:{setTagsFromDicomTags(e){for(const[t,a]of Object.entries(e))this.tags[t]=a,$.isDateTag(t)&&(this.dateTags[t]=$.fromDicomDate(a))},async reset(){this.step="init",this.hasLoadedSamePatientsStudiesCount||(this.samePatientStudiesCount=(await p.getSamePatientStudies(this.patientMainDicomTags,["PatientID"])).length,this.hasLoadedSamePatientsStudiesCount=!0),this.tags={},this.originalTags={},this.removedTags={},this.insertedTags=new Set;for(const[e,t]of Object.entries(this.patientMainDicomTags))this.originalTags[e]=t,this.removedTags[e]=!1;for(const[e,t]of Object.entries(this.studyMainDicomTags))this.originalTags[e]=t,this.removedTags[e]=!1;if(this.resourceLevel=="series")for(const[e,t]of Object.entries(this.seriesMainDicomTags))this.originalTags[e]=t,this.removedTags[e]=!1;this.jobProgressComplete=0,this.jobProgressFailed=0,this.jobProgressRemaining=100,this.resourceLevel=="study"?this.modificationMode=this.uiOptions.Modifications.DefaultMode:this.modificationMode=this.uiOptions.Modifications.SeriesDefaultMode,this.isAnonymization&&(this.resourceLevel=="study"?this.goToNextStep("init","anonymize-study"):this.goToNextStep("init","anonymize-series"))},back(){this.step=="tags"&&!this.isAnonymization?this.step="init":this.step=="warning"||this.step=="error"?this.step="tags":console.error("unknown step for back function ",this.step)},setWarning(e){this.warningMessageId=e,this.step="warning"},setError(e){this.errorMessageId=e,this.step="error"},startMonitoringJob(e){this.step="progress",this.jobRefreshTimeout=200,setTimeout(this.monitorJob,this.jobRefreshTimeout,[e])},async monitorJob(e){const t=await p.getJobStatus(e);if(this.jobIsComplete=t.State=="Success"||t.State=="Failure",this.jobIsRunning=t.State=="Running",this.jobIsSuccess=t.State=="Success",this.jobIsComplete?(this.jobProgressRemaining=0,this.jobIsSuccess?(this.jobProgressComplete=100,this.jobProgressFailed=0):(this.jobProgressComplete=0,this.jobProgressFailed=100)):(this.jobProgressFailed=0,this.jobProgressComplete=t.Progress,this.jobProgressRemaining=100-this.jobProgressComplete),!this.jobIsComplete)this.jobRefreshTimeout=Math.min(this.jobRefreshTimeout+200,2e3),setTimeout(this.monitorJob,this.jobRefreshTimeout,[e]);else{this.step="done";const a=t.Type;if(a=="MergeStudy"){const u=await p.getStudy(t.Content.TargetStudy);this.showModifiedResourceValue=u.MainDicomTags.StudyInstanceUID,this.showModifiedResourceKey="StudyInstanceUID"}else if(a=="ResourceModification")if(t.Content.Type=="Patient"){this.showModifiedResourceKey="PatientID";const u=await p.getPatient(t.Content.ID);this.showModifiedResourceValue=u.MainDicomTags.PatientID}else if(t.Content.Type=="Study"){this.showModifiedResourceKey="StudyInstanceUID";const u=await p.getStudy(t.Content.ID);this.showModifiedResourceValue=u.MainDicomTags.StudyInstanceUID}else if(t.Content.Type=="Series"){this.showModifiedResourceKey="StudyInstanceUID";const u=await p.getSeriesParentStudy(t.Content.ID);this.showModifiedResourceValue=u.MainDicomTags.StudyInstanceUID}else console.error("not handled yet")}},async modify(e=!1){try{if(this.action=="attach-study-to-existing-patient"){const t=await p.findPatient(this.tags.PatientID);if(t){const a=await p.modifyResource({resourceLevel:"study",orthancId:this.orthancId,replaceTags:t.MainDicomTags,keepTags:this.keepDicomUids?["StudyInstanceUID","SeriesInstanceUID","SOPInstanceUID"]:[],keepSource:this.keepSource,removeTags:this.removedTagsList});console.log("attach-study-to-existing-patient: created job ",a),this.startMonitoringJob(a)}else{console.error("Error while changing patient, the new PatientID does not exist ",this.tags.PatientID),this.setError("modify.error_attach_study_to_existing_patient_target_does_not_exist_html");return}}else if(this.action=="modify-any-tags-in-one-study"){if("PatientID"in this.modifiedTags){console.log("modify-any-tags-in-one-study: PatientID has changed");const a=await p.findPatient(this.tags.PatientID);if(a){console.error("modify-any-tags-in-one-study: Error while modifying patient-study tags, another patient with the same PatientID already exists ",this.tags.PatientID,a),this.setError("modify.error_modify_any_study_tags_patient_exists_html");return}}else if("PatientName"in this.modifiedTags||"PatientBirthDate"in this.modifiedTags||"PatientSex"in this.modifiedTags)if(console.log("modify-any-tags-in-one-study: Patient tags have changed"),this.samePatientStudiesCount=(await p.getSamePatientStudies(this.originalTags,["PatientID"])).length,this.samePatientStudiesCount>1){console.error("modify-any-tags-in-one-study: Error while modifying patient-study tags, this patient has other studies, you can not modify patient tags ",this.originalTags.PatientID,this.modifiedTags),this.setError("modify.error_modify_any_study_tags_can_not_modify_patient_tags_because_of_other_studies_html");return}else console.log("modify-any-tags-in-one-study: this is the only patient study, we can modify all tags");const t=await p.modifyResource({resourceLevel:"study",orthancId:this.orthancId,replaceTags:this.modifiedTags,keepTags:this.keepDicomUids?["StudyInstanceUID","SeriesInstanceUID","SOPInstanceUID"]:[],keepSource:this.keepSource,removeTags:this.removedTagsList});console.log("modify-any-tags-in-one-study: created job ",t),this.startMonitoringJob(t)}else if(this.action=="modify-patient-tags-in-all-studies"){if(this.tags.PatientID!=this.originalTags.PatientID){const u=await p.findPatient(this.tags.PatientID);if(u){console.error("modify-patient-tags-in-all-studies: Error while modifying patient tags, another patient with the same PatientID already exists ",this.tags.PatientID,u),this.setError("modify.error_modify_patient_tags_another_patient_exists_with_same_patient_id_html");return}}const t=await p.findPatient(this.originalTags.PatientID),a=await p.modifyResource({resourceLevel:"patient",orthancId:t.ID,replaceTags:this.tags,keepTags:this.keepDicomUids?["StudyInstanceUID","SeriesInstanceUID","SOPInstanceUID"]:[],removeTags:this.removedTagsList,keepSource:this.keepSource});console.log("modify-patient-tags-in-all-studies: created job ",a),this.startMonitoringJob(a)}else if(this.action=="anonymize-study"){const t=await p.anonymizeResource({resourceLevel:"study",orthancId:this.orthancId,replaceTags:this.tags,removeTags:this.removedTagsList});console.log("anonymize-study: created job ",t),this.startMonitoringJob(t)}else if(this.action=="attach-series-to-existing-study")if(this.tags.StudyInstanceUID==this.originalTags.StudyInstanceUID){console.error("attach-series-to-existing-study: Error target study is same as current study ",this.tags.StudyInstanceUID),this.setError("modify.error_attach_series_to_existing_study_target_unchanged_html");return}else{const t=await p.findStudy(this.tags.StudyInstanceUID);if(t==null){console.error("attach-series-to-existing-study: target study not found ",this.tags.StudyInstanceUID),this.setError("modify.error_attach_series_to_existing_study_target_does_not_exist_html");return}else{const a=await p.mergeSeriesInExistingStudy({seriesIds:[this.orthancId],targetStudyId:t.ID,keepSource:!1});console.log("attach-series-to-existing-study: created job ",a),this.startMonitoringJob(a)}}else if(this.action=="create-new-study-from-series"){const t=await p.findPatient(this.tags.PatientID);if(t){if(e)console.log("create-new-study-from-series: warning accepted, copying existing Patient tags"),this.tags.PatientName=t.MainDicomTags.PatientName,this.tags.PatientBirthDate=this.tags.PatientBirthDate=t.MainDicomTags.PatientBirthDate,this.dateTags.PatientBirthDate=$.fromDicomDate(t.MainDicomTags.PatientBirthDate),this.tags.PatientSex=t.MainDicomTags.PatientSex;else if(t.MainDicomTags.PatientName!=this.tags.PatientName||t.MainDicomTags.PatientBirthDate!=this.tags.PatientBirthDate||t.MainDicomTags.PatientSex!=this.tags.PatientSex){console.warn("create-new-study-from-series: Another patient exists but tags differ",t.MainDicomTags,this.tags),this.setWarning("modify.warning_create_new_study_from_series_html");return}}this.tags.StudyInstanceUID=await p.generateUid("study");const a=await p.modifyResource({resourceLevel:"series",orthancId:this.orthancId,replaceTags:this.tags,keepTags:["SeriesInstanceUID","SOPInstanceUID"],keepSource:!1});console.log("create-new-study-from-series: created job ",a),this.startMonitoringJob(a)}else if(this.action=="modify-series-tags"){const t=await p.modifyResource({resourceLevel:"series",orthancId:this.orthancId,replaceTags:this.modifiedTags,keepTags:this.keepDicomUids?["SeriesInstanceUID","SOPInstanceUID"]:[],keepSource:this.keepSource});console.log("modify-series-tags: created job ",t),this.startMonitoringJob(t)}else if(this.action=="anonymize-series"){const t=await p.anonymizeResource({resourceLevel:"series",orthancId:this.orthancId,replaceTags:this.tags,removeTags:this.removedTagsList});console.log("anonymize-study: created job ",t),this.startMonitoringJob(t)}else console.error("unhandled")}catch{this.setError("modify.error_modify_unexpected_error_html")}},goToNextStep(e,t){if(e=="init")if(this.step="tags",this.action=t,t=="anonymize-study"){const a=de();this.tags={},this.tags.PatientID=a,this.tags.PatientName="Anonymized "+a.substr(0,8),this.tags.PatientBirthDate="",this.dateTags.PatientBirthDate=null,this.tags.PatientSex="","StudyDescription"in this.studyMainDicomTags&&(this.tags.StudyDescription=this.studyMainDicomTags.StudyDescription)}else if(t=="attach-study-to-existing-patient")this.tags={},this.tags.PatientID=this.patientMainDicomTags.PatientID;else if(t=="modify-any-tags-in-one-study")this.tags={},this.setTagsFromDicomTags(this.patientMainDicomTags),this.setTagsFromDicomTags(this.studyMainDicomTags);else if(t=="modify-patient-tags-in-all-studies")this.tags={},this.setTagsFromDicomTags(this.patientMainDicomTags);else if(t=="attach-series-to-existing-study")this.tags={},this.tags.StudyInstanceUID="";else if(t=="create-new-study-from-series")this.tags={},this.tags.PatientID="",this.tags.PatientName="",this.tags.PatientBirthDate="",this.dateTags.PatientBirthDate=null,this.tags.PatientSex="",this.tags.StudyDescription="";else if(t=="modify-series-tags")this.tags={},this.setTagsFromDicomTags(this.seriesMainDicomTags);else if(t=="anonymize-series"){const a=de();this.tags={},this.tags.PatientID=a,this.tags.PatientName="Anonymized "+a.substr(0,8),this.tags.PatientBirthDate="",this.dateTags.PatientBirthDate=null,this.tags.PatientSex="","StudyDescription"in this.studyMainDicomTags&&(this.tags.StudyDescription=this.studyMainDicomTags.StudyDescription)}else console.error("unknown action ",t);else this.step=="warning"&&this.modify()},async showModifiedResources(){let e="",t={forceRefresh:Date.now()};this.showModifiedResourceKey&&(t[this.showModifiedResourceKey]=this.showModifiedResourceValue),this.$router.push({path:e,query:t})},isFrozenTag(e){return this.isRemovedTag(e)?!0:this.isDicomUid(e)?this.keepDicomUids:!1},isEditableTag(e){return this.isRemovedTag(e)?!1:this.resourceLevel=="series"&&this.action=="attach-series-to-existing-study"&&e=="StudyInstanceUID"?!0:!this.isDicomUid(e)},isDateTag(e){return $.isDateTag(e)},isDicomUid(e){return["StudyInstanceUID","SeriesInstanceUID","SOPInstanceUID"].indexOf(e)!=-1},isAutogeneratedDicomUid(e){return this.resourceLevel=="series"&&this.action=="attach-series-to-existing-study"?!1:this.isDicomUid(e)?!this.keepDicomUids:!1},isRemovable(e){return document.requiredTags.indexOf(e)==-1},isRemovedTag(e){return this.removedTags[e]===void 0&&console.warn("isRemovedTag: undefined tag"),this.removedTags[e]},toggleRemovedTag(e){this.removedTags[e]=!this.removedTags[e],this.removedTags[e]&&this.insertedTags.has(e)&&(delete this.tags[e],delete this.dateTags[e],delete this.originalTags[e],delete this.removedTags[e],this.insertedTags.delete(e)),this.removedTags?console.log(e+" will be removed"):console.log(e+" will not be removed")},insertTag(e,t){e.preventDefault(),e.stopPropagation(),console.log("insert tag "+t,this.tags,this.removedTags),this.tags[t]="",$.isDateTag(t)&&(this.dateTags[t]=null),this.removedTags[t]=!1,this.originalTags[t]=null,this.insertedTags.add(t),console.log("insert tag "+t,this.tags,this.removedTags)},isModeAllowed(e){return this.resourceLevel=="series"&&this.uiOptions.Modifications.SeriesAllowedModes.indexOf(e)!=-1?!0:this.resourceLevel=="study"&&this.uiOptions.Modifications.AllowedModes.indexOf(e)!=-1},canSelectModes(){return this.isAnonymization?!1:this.resourceLevel=="series"&&this.uiOptions.Modifications.SeriesAllowedModes.length>1?this.action=="modify-series-tags":this.resourceLevel=="study"&&this.uiOptions.Modifications.AllowedModes.length>1}},computed:{...P({uiOptions:e=>e.configuration.uiOptions}),resourceTitle(){return j.getResourceTitle(this.resourceLevel,this.patientMainDicomTags,this.studyMainDicomTags,this.seriesMainDicomTags,null)},keepSource(){if(this.modificationMode=="duplicate")return!0;if(this.modificationMode=="modify-new-uids")return!1;if(this.modificationMode=="modify-keep-uids"){if(this.action=="attach-study-to-existing-patient")return!1;if(this.action=="modify-any-tags-in-one-study"||this.action=="modify-patient-tags-in-all-studies")return!("PatientID"in this.modifiedTags);console.error("unhandled")}else console.error("unhandled")},keepDicomUids(){return this.modificationMode=="modify-keep-uids"},areTagsModified(){let e=!1;for(const[,t]of Object.entries(this.removedTags))t&&(e=!0);return Object.keys(this.modifiedTags).length>0||e},modifiedTags(){let e={};for(const[t]of Object.entries(this.tags))$.isDateTag(t)&&(this.tags[t]=$.dicomDateFromDatePicker(this.dateTags[t])),this.tags[t]!=this.originalTags[t]&&!this.removedTags[t]&&(e[t]=this.tags[t]);return e},insertableTags(){let e=[];this.action=="modify-any-tags-in-one-study"&&(e=e.concat(this.uiOptions.StudyMainTags),e=e.concat(this.uiOptions.PatientMainTags));const t=this;return e=e.filter(function(a){return!(a in t.originalTags)}),e.sort()},removedTagsList(){let e=[];for(const[t,a]of Object.entries(this.removedTags))a&&e.push(t);return e},modifyButtonTitle(){return this.isAnonymization?"modify.anonymize_button_title":"modify.modify_button_title"},modifyModeNewUidText(){return this.resourceLevel=="series"?"modify.modify_series_mode_new_uids_html":"modify.modify_study_mode_new_uids_html"},modifyModeKeepUidText(){return this.resourceLevel=="series"?"modify.modify_series_mode_keep_uids_html":"modify.modify_study_mode_keep_uids_html"},modifyModeDuplicateText(){return this.resourceLevel=="series"?"modify.modify_series_mode_duplicate_html":"modify.modify_study_mode_duplicate_html"},modifyButtonEnabled(){return this.isAnonymization||this.action=="modify-patient-tags-in-all-studies"?!0:this.areTagsModified},isDarkMode(){let e=document.documentElement.getAttribute("data-bs-theme");return e=getComputedStyle(document.documentElement).getPropertyValue("--bootstrap-theme"),console.log("DatePicker color mode is ",e),e=="dark"},datePickerFormat(){return this.uiOptions.DateFormat}},components:{CopyToClipboardButton:J}},ma=["id"],pa={class:"modal-dialog modal-lg modal-dialog-scrollable"},ga={class:"modal-content"},ba={class:"modal-header"},ya={key:0,class:"modal-title",id:"modalLabel"},fa={key:1,class:"modal-title",id:"modalLabel"},_a=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Da={key:0,class:"modal-body"},va={class:"container"},Sa={key:0,class:"row border-bottom pb-3"},Ta=["innerHTML"],Ia={class:"col-md-3"},wa=["innerHTML"],ka={key:1,class:"row border-bottom border-3 py-3"},La=["innerHTML"],Ma={class:"col-md-3"},Oa=["innerHTML"],Ca={key:2,class:"row pt-3"},Pa=["innerHTML"],$a={class:"col-md-3"},Ra=["innerHTML"],Ua={key:3,class:"row border-bottom pb-3"},Aa=["innerHTML"],Ea={class:"col-md-3"},Fa=["innerHTML"],Va={key:4,class:"row border-bottom border-3 py-3"},Ba=["innerHTML"],Na={class:"col-md-3"},xa=["innerHTML"],Ha={key:5,class:"row pt-3"},ja=["innerHTML"],za={class:"col-md-3"},Ga=["innerHTML"],qa={key:1,class:"modal-footer"},Wa={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Ja={key:2,class:"modal-body"},Ka={class:"container",style:{"min-height":"50vh"}},Ya={key:0,class:"col-md-6"},Za=["onUpdate:modelValue"],Qa={key:1,class:"col-md-6"},Xa=["onUpdate:modelValue"],eo={key:2,class:"col-md-6"},to={key:3,class:"col-md-6"},so=["value"],io={key:4,class:"col-md-1"},ao={class:"d-flex flex-row-reverse"},oo=["title","onClick"],no={key:0,class:"bi-trash"},lo=["title","onClick"],ro={key:0,class:"bi-recycle"},uo={key:0,class:"row pt-3"},co=s("div",{class:"col-md-8"},null,-1),ho={class:"col-md-2"},mo={class:"dropdown"},po={class:"btn btn-sm btn-secondary dropdown-toggle",type:"button",id:"dropdownInsertTag","data-bs-toggle":"dropdown","aria-expanded":"false"},go={class:"dropdown-menu"},bo=["value"],yo=["onClick"],fo={key:1,class:"row pt-3"},_o={key:0,class:"form-check"},Do=["innerHTML"],vo={key:1,class:"form-check"},So=["innerHTML"],To={key:2,class:"form-check"},Io=["innerHTML"],wo={key:3,class:"modal-footer"},ko={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Lo=["disabled"],Mo={key:4,class:"modal-body"},Oo={class:"container"},Co=["innerHTML"],Po=["innerHTML"],$o={key:5,class:"modal-footer"},Ro={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Uo={key:6,class:"modal-footer"},Ao={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},Eo={key:7,class:"modal-body"},Fo={class:"container"},Vo={class:"row pb-3"},Bo={class:"row"},No={class:"progress",style:{width:"100%"}},xo={key:8,class:"modal-footer"},Ho={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},jo=["disabled"];function zo(e,t,a,u,o,i){const r=v("Datepicker");return n(),l("div",{class:"modal fade",id:this.orthancId,tabindex:"-1","aria-labelledby":"modalLabel",ref:"modal-main-div"},[s("div",pa,[s("div",ga,[s("div",ba,[a.isAnonymization?c("",!0):(n(),l("h5",ya,d(e.$t("modify.modify_modal_title")+" "+i.resourceTitle),1)),a.isAnonymization?(n(),l("h5",fa,d(e.$t("modify.anonymize_modal_title")+" "+i.resourceTitle),1)):c("",!0),_a]),o.step=="init"?(n(),l("div",Da,[s("div",va,[a.resourceLevel=="study"&&!a.isAnonymization?(n(),l("div",Sa,[s("div",{class:"col-md-9",innerHTML:e.$t("modify.study_step_0_attach_study_to_existing_patient_html")},null,8,Ta),s("div",Ia,[s("button",{type:"button",class:"btn btn-primary w-100",innerHTML:e.$t("modify.study_step_0_attach_study_to_existing_patient_button_title_html"),onClick:t[0]||(t[0]=h=>i.goToNextStep(o.step,"attach-study-to-existing-patient"))},null,8,wa)])])):c("",!0),a.resourceLevel=="study"&&!a.isAnonymization&&o.samePatientStudiesCount>1?(n(),l("div",ka,[s("div",{class:"col-md-9",innerHTML:e.$t("modify.study_step_0_patient_has_other_studies_html",{count:o.samePatientStudiesCount})},null,8,La),s("div",Ma,[s("button",{type:"button",class:"btn btn-primary w-100",innerHTML:e.$t("modify.study_step_0_patient_has_other_studies_button_title_html"),onClick:t[1]||(t[1]=h=>i.goToNextStep(o.step,"modify-patient-tags-in-all-studies"))},null,8,Oa)])])):c("",!0),a.resourceLevel=="study"&&!a.isAnonymization&&o.samePatientStudiesCount>=1?(n(),l("div",Ca,[s("div",{class:"col-md-9",innerHTML:e.$t("modify.study_step_0_modify_study_html",{count:o.samePatientStudiesCount})},null,8,Pa),s("div",$a,[s("button",{type:"button",class:"btn btn-primary w-100",innerHTML:e.$t("modify.study_step_0_modify_study_button_title_html"),onClick:t[2]||(t[2]=h=>i.goToNextStep(o.step,"modify-any-tags-in-one-study"))},null,8,Ra)])])):c("",!0),a.resourceLevel=="series"&&!a.isAnonymization?(n(),l("div",Ua,[s("div",{class:"col-md-9",innerHTML:e.$t("modify.series_step_0_attach_series_to_existing_study_html")},null,8,Aa),s("div",Ea,[s("button",{type:"button",class:"btn btn-primary w-100",innerHTML:e.$t("modify.series_step_0_attach_series_to_existing_study_button_title_html"),onClick:t[3]||(t[3]=h=>i.goToNextStep(o.step,"attach-series-to-existing-study"))},null,8,Fa)])])):c("",!0),a.resourceLevel=="series"&&!a.isAnonymization?(n(),l("div",Va,[s("div",{class:"col-md-9",innerHTML:e.$t("modify.series_step_0_create_new_study_html")},null,8,Ba),s("div",Na,[s("button",{type:"button",class:"btn btn-primary w-100",innerHTML:e.$t("modify.series_step_0_create_new_study_button_title_html"),onClick:t[4]||(t[4]=h=>i.goToNextStep(o.step,"create-new-study-from-series"))},null,8,xa)])])):c("",!0),a.resourceLevel=="series"&&!a.isAnonymization?(n(),l("div",Ha,[s("div",{class:"col-md-9",innerHTML:e.$t("modify.series_step_0_modify_series_html")},null,8,ja),s("div",za,[s("button",{type:"button",class:"btn btn-primary w-100",innerHTML:e.$t("modify.series_step_0_modify_series_button_title_html"),onClick:t[5]||(t[5]=h=>i.goToNextStep(o.step,"modify-series-tags"))},null,8,Ga)])])):c("",!0)])])):c("",!0),o.step=="init"?(n(),l("div",qa,[s("button",Wa,d(e.$t("cancel")),1)])):c("",!0),o.step=="tags"?(n(),l("div",Ja,[s("div",Ka,[(n(!0),l(S,null,T(o.tags,(h,m)=>(n(),l("div",{key:m,class:"row"},[s("div",{class:k(["col-md-5",{"striked-through":i.isRemovedTag(m)}])},d(m),3),i.isFrozenTag(m)?(n(),l("div",Ya,[I((n(),l("input",{key:0,type:"text",class:k(["form-control",{"striked-through":!i.isDicomUid(m)}]),disabled:"","onUpdate:modelValue":y=>o.originalTags[m]=y},null,10,Za)),[[C,o.originalTags[m]]])])):c("",!0),i.isEditableTag(m)&&!i.isDateTag(m)?(n(),l("div",Qa,[I((n(),l("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":y=>o.tags[m]=y},null,8,Xa)),[[C,o.tags[m]]])])):c("",!0),i.isEditableTag(m)&&i.isDateTag(m)?(n(),l("div",eo,[D(r,{modelValue:o.dateTags[m],"onUpdate:modelValue":y=>o.dateTags[m]=y,range:!1,"enable-time-picker":!1,format:i.datePickerFormat,"preview-format":i.datePickerFormat,"text-input":"","arrow-navigation":"","highlight-week-days":[0,6],dark:i.isDarkMode},null,8,["modelValue","onUpdate:modelValue","format","preview-format","dark"])])):c("",!0),i.isAutogeneratedDicomUid(m)?(n(),l("div",to,[(n(),l("input",{key:0,type:"text",class:"form-control",disabled:"",value:e.$t("modify.autogenerated_dicom_uid")},null,8,so))])):c("",!0),(n(),l("div",io,[s("div",ao,[i.isRemovable(m)&&!i.isRemovedTag(m)?(n(),l("button",{key:0,class:"btn-small",type:"button","data-bs-toggle":"tooltip",title:e.$t("modify.remove_tag_tooltip"),onClick:y=>i.toggleRemovedTag(m)},[i.isRemovedTag(m)?c("",!0):(n(),l("i",no))],8,oo)):c("",!0),i.isRemovable(m)&&i.isRemovedTag(m)?(n(),l("button",{key:1,class:"btn-small",type:"button","data-bs-toggle":"tooltip",title:e.$t("modify.remove_tag_undo_tooltip"),onClick:y=>i.toggleRemovedTag(m)},[i.isRemovedTag(m)?(n(),l("i",ro)):c("",!0)],8,lo)):c("",!0)])]))]))),128)),o.action=="modify-any-tags-in-one-study"?(n(),l("div",uo,[co,s("div",ho,[s("div",mo,[s("button",po,d(e.$t("modify.insert_tag")),1),s("ul",go,[(n(!0),l(S,null,T(i.insertableTags,h=>(n(),l("li",{key:h,value:h},[s("a",{class:"dropdown-item",href:"#",onClick:m=>i.insertTag(m,h)},d(h),9,yo)],8,bo))),128))])])])])):c("",!0),i.canSelectModes()?(n(),l("div",fo,[i.isModeAllowed("modify-new-uids")?(n(),l("div",_o,[I(s("input",{class:"form-check-input",type:"radio",name:"modificationMode",id:"modifyNewUids",value:"modify-new-uids","onUpdate:modelValue":t[6]||(t[6]=h=>o.modificationMode=h)},null,512),[[Y,o.modificationMode]]),s("label",{class:"form-check-label",for:"modifyNewUids",innerHTML:e.$t(i.modifyModeNewUidText)},null,8,Do)])):c("",!0),i.isModeAllowed("modify-keep-uids")?(n(),l("div",vo,[I(s("input",{class:"form-check-input",type:"radio",name:"modificationMode",id:"modifyKeepUids",value:"modify-keep-uids","onUpdate:modelValue":t[7]||(t[7]=h=>o.modificationMode=h)},null,512),[[Y,o.modificationMode]]),s("label",{class:"form-check-label",for:"modifyKeepUids",innerHTML:e.$t(i.modifyModeKeepUidText)},null,8,So)])):c("",!0),i.isModeAllowed("duplicate")?(n(),l("div",To,[I(s("input",{class:"form-check-input",type:"radio",name:"modificationMode",id:"modifyDuplicate",value:"duplicate","onUpdate:modelValue":t[8]||(t[8]=h=>o.modificationMode=h)},null,512),[[Y,o.modificationMode]]),s("label",{class:"form-check-label",for:"modifyDuplicate",innerHTML:e.$t(i.modifyModeDuplicateText)},null,8,Io)])):c("",!0)])):c("",!0)])])):c("",!0),o.step=="tags"?(n(),l("div",wo,[a.isAnonymization?c("",!0):(n(),l("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=h=>i.back())},d(e.$t("modify.back_button_title")),1)),s("button",ko,d(e.$t("cancel")),1),s("button",{type:"button",class:"btn btn-primary",disabled:!i.modifyButtonEnabled,onClick:t[10]||(t[10]=h=>i.modify())},d(e.$t(i.modifyButtonTitle)),9,Lo)])):c("",!0),o.step=="warning"||o.step=="error"?(n(),l("div",Mo,[s("div",Oo,[o.step=="error"?(n(),l("div",{key:0,class:"alert alert-danger",role:"alert",innerHTML:e.$t(o.errorMessageId)},null,8,Co)):c("",!0),o.step=="warning"?(n(),l("div",{key:1,class:"alert alert-warning",role:"alert",innerHTML:e.$t(o.warningMessageId)},null,8,Po)):c("",!0)])])):c("",!0),o.step=="warning"?(n(),l("div",$o,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[11]||(t[11]=h=>i.back())},d(e.$t("modify.back_button_title")),1),s("button",Ro,d(e.$t("cancel")),1),s("button",{type:"button",class:"btn btn-primary",onClick:t[12]||(t[12]=h=>i.modify(!0))},d(e.$t(i.modifyButtonTitle)),1)])):c("",!0),o.step=="error"?(n(),l("div",Uo,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=h=>i.back())},d(e.$t("modify.back_button_title")),1),s("button",Ao,d(e.$t("cancel")),1)])):c("",!0),o.step=="progress"||o.step=="done"?(n(),l("div",Eo,[s("div",Fo,[s("div",Vo,d(e.$t("modify.job_in_progress")),1),s("div",Bo,[s("div",No,[s("div",{class:"progress-bar bg-success",role:"progressbar",style:F("width: "+this.jobProgressComplete+"%")},null,4),s("div",{class:"progress-bar bg-secondary",role:"progressbar",style:F("width: "+this.jobProgressRemaining+"%")},null,4),s("div",{class:"progress-bar bg-danger",role:"progressbar",style:F("width: "+this.jobProgressFailed+"%")},null,4)])])])])):c("",!0),o.step=="progress"||o.step=="done"?(n(),l("div",xo,[s("button",Ho,d(e.$t("close")),1),s("button",{type:"button",class:"btn btn-primary",disabled:o.step!="done","data-bs-dismiss":"modal",onClick:t[14]||(t[14]=h=>i.showModifiedResources())},d(e.$t("modify.show_modified_resources")),9,jo)])):c("",!0)])])],8,ma)}const Go=L(ha,[["render",zo]]),qo={props:["orthancStudyId","studyMainDicomTags","patientMainDicomTags"],data(){return{seriesTags:{},seriesDateTags:{},errorMessageId:null,warningMessageId:null,uploadedFileType:null,uploadedFileDate:null,uploadedFileBase64Content:null,uploadedFileHumanSize:null,step:"prepare"}},async mounted(){this.$refs["modal-main-div"].addEventListener("show.bs.modal",e=>{document.querySelector("body").appendChild(e.target),this.reset()}),X(document.querySelector("#addSeriesFileUpload-"+this.orthancStudyId),this.uppieUploadHandler)},methods:{async reset(){this.step="prepare",this.uploadedFileType=null,this.uploadedFileDate=null,this.uploadedFileHumanSize=null,this.uploadedFileName=null,this.uploadedFileBase64Content=null,this.warningMessageId=null,this.errorMessageId=null,this.seriesTags={},document.getElementById("addSeriesFileUpload-"+this.orthancStudyId).value=null},setError(e){this.step="error",this.errorMessageId=e},async addSeries(){try{let e={};for(const[a]of Object.entries(this.seriesTags))$.isDateTag(a)?e[a]=$.dicomDateFromDatePicker(this.seriesDateTags[a]):e[a]=this.seriesTags[a];"AcquisitionDate"in e||(e.AcquisitionDate=e.SeriesDate),"ContentDate"in e||(e.ContentDate=e.SeriesDate),await p.createDicom(this.orthancStudyId,this.uploadedFileBase64Content,e),document.getElementById("add-series-close-"+this.orthancStudyId).click(),this.messageBus.emit("added-series-to-study-"+this.orthancStudyId)}catch{this.setError("add_series.error_add_series_unexpected_error_html")}},isDateTag(e){return $.isDateTag(e)},onDrop(e){e.preventDefault(),this.analyzeFile(e.dataTransfer.items[0].getAsFile())},onDragOver(e){e.preventDefault()},getHumanSize(e){return e>1024*1024?Math.round(e/(1024*1024)*100)/100+" MB":Math.round(e/1024*100)/100+" kB"},async uppieUploadHandler(e,t,a){e.preventDefault(),this.analyzeFile(e.target.files[0])},async analyzeFile(e){if(console.log("analyzeFile",e),this.uploadedFileDate=e.lastModifiedDate,this.uploadedFileHumanSize=this.getHumanSize(e.size),this.uploadedFileName=e.name,this.warningMessageId=null,e.type=="application/pdf")this.uploadedFileType="pdf";else if(e.type.startsWith("image/"))this.uploadedFileType="image";else if(e.type==""&&e.name.endsWith)this.uploadedFileType="stl";else{this.uploadedFileType=null,this.warningMessageId="add_series.unrecognized_file_format";return}for(const[u,o]of Object.entries(this.uiOptions.AddSeriesDefaultTags[this.uploadedFileType]))this.seriesTags[u]=o,$.isDateTag(u)&&(o=="$TODAY$"?this.seriesDateTags[u]=new Date:o=="$STUDY_DATE$"?this.seriesDateTags[u]=$.fromDicomDate(this.studyMainDicomTags.StudyDate):o=="$FILE_DATE$"?this.seriesDateTags[u]=this.uploadedFileDate:this.seriesDateTags[u]=$.fromDicomDate(o));let t=new FileReader,a=this;t.onload=function(u){a.uploadedFileBase64Content=u.target.result},t.readAsDataURL(e)}},computed:{...P({uiOptions:e=>e.configuration.uiOptions}),resourceTitle(){return j.getResourceTitle("study",this.patientMainDicomTags,this.studyMainDicomTags,null,null)},addSeriesButtonEnabled(){return this.uploadedFileType!=null},isDarkMode(){let e=document.documentElement.getAttribute("data-bs-theme");return e=getComputedStyle(document.documentElement).getPropertyValue("--bootstrap-theme"),console.log("DatePicker color mode is ",e),e=="dark"},datePickerFormat(){return this.uiOptions.DateFormat}},components:{}},Wo=["id"],Jo={class:"modal-dialog modal-lg modal-dialog-scrollable"},Ko={class:"modal-content"},Yo={class:"modal-header"},Zo={class:"modal-title",id:"modalLabel"},Qo=["id"],Xo={key:0,class:"modal-body"},en={class:"mb-3"},tn={class:"mb-3"},sn={class:"btn btn-primary btn-file"},an=["id"],on={key:0,class:"modal-body"},nn={class:"container"},ln=["innerHTML"],rn={key:1,class:"modal-body"},dn={class:"container"},un=["innerHTML"],cn={key:2,class:"container",style:{"min-height":"40vh"}},hn={class:"col-md-5"},mn={key:0,class:"col-md-6"},pn=["onUpdate:modelValue"],gn={key:1,class:"col-md-6"},bn={key:1,class:"modal-footer"},yn={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},fn=["disabled"],_n={key:2,class:"modal-body"},Dn={class:"container"},vn=["innerHTML"],Sn={key:3,class:"modal-footer"},Tn={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function In(e,t,a,u,o,i){const r=v("Datepicker");return n(),l("div",{class:"modal fade",id:this.orthancStudyId,tabindex:"-1","aria-labelledby":"modalLabel",ref:"modal-main-div"},[s("div",Jo,[s("div",Ko,[s("div",Yo,[s("h5",Zo,d(e.$t("add_series.modal_title")+" "+i.resourceTitle),1),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",id:"add-series-close-"+a.orthancStudyId},null,8,Qo)]),o.step=="prepare"?(n(),l("div",Xo,[s("div",{class:"upload-drop-zone",onDrop:t[0]||(t[0]=(...h)=>this.onDrop&&this.onDrop(...h)),onDragover:t[1]||(t[1]=(...h)=>this.onDragOver&&this.onDragOver(...h))},[s("div",en,d(e.$t("add_series.drop_file")),1),s("div",tn,[s("label",sn,[b(d(e.$t("add_series.select_file"))+" ",1),s("input",{type:"file",style:{display:"none"},id:"addSeriesFileUpload-"+this.orthancStudyId,required:""},null,8,an)])])],32),o.warningMessageId!=null?(n(),l("div",on,[s("div",nn,[s("div",{class:"alert alert-warning",role:"alert",innerHTML:e.$t(o.warningMessageId)},null,8,ln)])])):c("",!0),o.uploadedFileType!=null?(n(),l("div",rn,[s("div",dn,[s("div",{class:"alert alert-info",role:"alert",innerHTML:e.$t("add_series.uploaded_file",{size:o.uploadedFileHumanSize,type:o.uploadedFileType,name:e.uploadedFileName})},null,8,un)])])):c("",!0),o.uploadedFileType!=null?(n(),l("div",cn,[(n(!0),l(S,null,T(o.seriesTags,(h,m)=>(n(),l("div",{key:m,class:"row"},[s("div",hn,d(m),1),i.isDateTag(m)?c("",!0):(n(),l("div",mn,[I((n(),l("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":y=>o.seriesTags[m]=y},null,8,pn)),[[C,o.seriesTags[m]]])])),i.isDateTag(m)?(n(),l("div",gn,[D(r,{modelValue:o.seriesDateTags[m],"onUpdate:modelValue":y=>o.seriesDateTags[m]=y,range:!1,"enable-time-picker":!1,format:i.datePickerFormat,"preview-format":i.datePickerFormat,"text-input":"","arrow-navigation":"","highlight-week-days":[0,6],dark:i.isDarkMode},null,8,["modelValue","onUpdate:modelValue","format","preview-format","dark"])])):c("",!0)]))),128))])):c("",!0)])):c("",!0),o.step=="prepare"?(n(),l("div",bn,[s("button",yn,d(e.$t("cancel")),1),s("button",{type:"button",class:"btn btn-primary",disabled:!i.addSeriesButtonEnabled,onClick:t[2]||(t[2]=h=>i.addSeries())},d(e.$t("add_series.button_title")),9,fn)])):c("",!0),o.step=="error"?(n(),l("div",_n,[s("div",Dn,[s("div",{class:"alert alert-danger",role:"alert",innerHTML:e.$t(o.errorMessageId)},null,8,vn)])])):c("",!0),o.step=="error"?(n(),l("div",Sn,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[3]||(t[3]=h=>e.back())},d(e.$t("modify.back_button_title")),1),s("button",Tn,d(e.$t("cancel")),1)])):c("",!0)])])],8,Wo)}const wn=L(qo,[["render",In]]),kn={props:["resourcesOrthancId","linkUrl","level","tokenType","validityDuration","title","iconClass","opensInNewTab","linkType","disabled"],setup(){return{}},data(){return{}},mounted(){},methods:{async clicked(e){if(!this.tokens.RequiredForLinks)return;e.preventDefault();let t=this.validityDuration;(t==null||t===void 0)&&(t=this.tokens.InstantLinksValidity);let a=this.level;a=="bulk-study"&&(a="study");let u=await p.createToken({tokenType:this.tokenType,resourcesIds:this.resourcesOrthancId,level:a,validityDuration:t}),o=this.linkUrl;u.Url!=null?o=u.Url:this.linkUrl.indexOf("?")==-1?o=o+"?token="+u.Token:o=o+"&token="+u.Token;let i=document.querySelector("#hidden-link-for-tokens");i==null&&(i=document.createElement("a"),document.body.appendChild(i),i.setAttribute("id","hidden-link-for-tokens"),i.setAttribute("type","hidden")),i.target=this.target,i.href=o,i.click()}},computed:{...P({tokens:e=>e.configuration.tokens}),target(){return this.opensInNewTab===void 0||this.opensInNewTab==!1?"_self":"_blank"},isButton(){return this.linkType===void 0||this.linkType=="button"},isDropDownItem(){return this.linkType=="dropdown-item"},isIcon(){return this.linkType=="icon"},classes(){return this.disabled?"btn-secondary disabled-link":"btn-secondary"},divClasses(){return this.linkType=="icon"?"div-icon":""}},components:{}},Ln=["title","target","href"],Mn=["target","href"],On=["target","href"];function Cn(e,t,a,u,o,i){return n(),l("div",{class:k(i.divClasses)},[i.isButton?(n(),l("a",{key:0,class:k(["btn btn-sm m-1",i.classes]),type:"button","data-bs-toggle":"tooltip",title:a.title,onClick:t[0]||(t[0]=(...r)=>i.clicked&&i.clicked(...r)),target:i.target,href:a.linkUrl},[s("i",{class:k(a.iconClass)},null,2)],10,Ln)):c("",!0),i.isDropDownItem?(n(),l("a",{key:1,class:"dropdown-item",target:i.target,onClick:t[1]||(t[1]=(...r)=>i.clicked&&i.clicked(...r)),href:a.linkUrl},d(a.title),9,Mn)):c("",!0),i.isIcon?(n(),l("a",{key:2,class:"icon",target:i.target,onClick:t[2]||(t[2]=(...r)=>i.clicked&&i.clicked(...r)),href:a.linkUrl},[s("i",{class:k(a.iconClass),style:{"padding-top":"4px"}},null,2)],8,On)):c("",!0)],2)}const ye=L(kn,[["render",Cn]]);window.filterLabel=e=>be.filterLabel(e);const Pn={props:["labels","studyId","id","title"],emits:["labelsUpdated"],setup(){},data(){return{labelsModel:[],allLabelsLocalCopy:new Set}},async created(){this.labelsModel=this.labels,this.canCreateNewLabels?this.allLabelsLocalCopy=[...this.allLabels]:this.allLabelsLocalCopy=[...this.uiOptions.AvailableLabels]},async mounted(){Fe.init()},computed:{...P({uiOptions:e=>e.configuration.uiOptions,allLabels:e=>e.labels.allLabels}),getTitle(){return this.title?this.$t(this.title):this.$t("labels.study_details_title")},canCreateNewLabels(){return this.uiOptions.AvailableLabels.length==0},placeHolderText(){return this.canCreateNewLabels?this.$t("labels.add_labels_placeholder"):this.$t("labels.add_labels_placeholder_no_create")}},components:{},methods:{hasLabel(e){return this.labelsModel.includes(e)}},watch:{labelsModel:{async handler(e,t){this.studyId?await p.updateLabels({studyId:this.studyId,labels:this.labelsModel})&&(this.$emit("labelsUpdated"),setTimeout(()=>{this.$store.dispatch("labels/refresh")},100)):this.$emit("labelsUpdated",this.labelsModel)},deep:!0}}},$n=["id"],Rn=["for"],Un=["innerHTML"],An={class:"invalid-label-tips invalid-label-tips-hidden"},En=["id","data-allow-new","placeholder"],Fn=["value","selected"];function Vn(e,t,a,u,o,i){return n(),l("div",{id:a.id},[s("label",{for:"select-"+a.id,class:"form-label"},[s("span",{innerHTML:i.getTitle},null,8,Un),s("span",An,d(e.$t("labels.valid_alphabet_warning")),1)],8,Rn),I(s("select",{class:"form-select",id:"select-"+a.id,name:"tags[]","onUpdate:modelValue":t[0]||(t[0]=r=>o.labelsModel=r),multiple:"","data-allow-clear":"true","data-allow-new":i.canCreateNewLabels,"data-badge-style":"info","data-input-filter":"filterLabel",placeholder:i.placeHolderText},[(n(!0),l(S,null,T(o.allLabelsLocalCopy,r=>(n(),l("option",{key:r,value:r,selected:i.hasLabel(r)},d(r),9,Fn))),128))],8,En),[[me,o.labelsModel]])],8,$n)}const fe=L(Pn,[["render",Vn]]),Bn={props:["resourcesOrthancId","resourceLevel"],emits:["bulkModalClosed"],data(){return{labelsToRemove:[],labelsToAdd:[],removedLabels:[],messages:[],addInProgress:!1,clearAllInProgress:!1,removeInProgress:!1}},async mounted(){this.reset(),this.$refs["modal-main-div"].addEventListener("show.bs.modal",e=>{document.querySelector("body").appendChild(e.target)}),this.$refs["modal-main-div"].addEventListener("hide.bs.modal",e=>{this.$emit("bulkModalClosed")})},watch:{},methods:{async showModal(){var e=new G.Modal(this.$el,{});e.show()},async reset(){this.labelsToRemove=[],this.labelsToAdd=[],this.removedLabels=[],this.messages=[],this.addInProgress=!1,this.clearAllInProgress=!1,this.removeInProgress=!1},async clearAllLabels(){this.clearAllInProgress=!0;let e=[];for(const u of this.resourcesOrthancId)e.push(await p.removeAllLabels(u));const t=await Promise.all(e);let a=new Set;for(const u of t)for(const o of u)a.add(o);this.messages.push({labels:a,part1:this.$t("labels.cleared_labels_message_part_1_html",{count:this.resourcesOrthancId.length}),part2:this.$t("labels.cleared_labels_message_part_2_html",{count:this.resourcesOrthancId.length})}),this.clearAllInProgress=!1,this.$store.dispatch("studies/refreshStudiesLabels",{studiesIds:this.resourcesOrthancId})},onLabelsToAddChanged(e){this.labelsToAdd=e},onLabelsToRemoveChanged(e){this.labelsToRemove=e},async addLabels(){this.addInProgress=!0;let e=[];for(const u of this.labelsToAdd)for(const o of this.resourcesOrthancId)e.push(p.addLabel({studyId:o,label:u}));const t=await Promise.all(e);let a=new Set;for(const u of t)a.add(u);this.messages.push({labels:a,part1:this.$t("labels.added_labels_message_part_1_html",{count:this.resourcesOrthancId.length}),part2:this.$t("labels.added_labels_message_part_2_html",{count:this.resourcesOrthancId.length})}),this.addInProgress=!1,this.$store.dispatch("studies/refreshStudiesLabels",{studiesIds:this.resourcesOrthancId})},isLabelToAdd(e){return this.labelsToAdd.includes(e)},isLabelToRemove(e){return this.labelsToRemove.includes(e)},async removeLabels(){this.removeInProgress=!0;let e=[];for(const u of this.labelsToRemove)for(const o of this.resourcesOrthancId)e.push(p.removeLabel({studyId:o,label:u}));const t=await Promise.all(e);let a=new Set;for(const u of t)a.add(u);this.messages.push({labels:a,part1:this.$t("labels.removed_labels_message_part_1_html",{count:this.resourcesOrthancId.length}),part2:this.$t("labels.removed_labels_message_part_2_html",{count:this.resourcesOrthancId.length})}),this.removeInProgress=!1,this.$store.dispatch("studies/refreshStudiesLabels",{studiesIds:this.resourcesOrthancId})}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,allLabels:e=>e.labels.allLabels}),isAddButtonEnabled(){return!this.addInProgress&&this.labelsToAdd.length>0},isRemoveButtonEnabled(){return!this.removeInProgress&&this.labelsToRemove.length>0}},components:{LabelsEditor:fe}},Nn={class:"modal fade",id:"bulk-labels-modal",tabindex:"-1","aria-labelledby":"modalLabel",ref:"modal-main-div"},xn={class:"modal-dialog modal-lg modal-dialog-scrollable"},Hn={class:"modal-content"},jn={class:"modal-header"},zn={class:"modal-title",id:"modalLabel"},Gn=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),qn={class:"modal-body"},Wn={class:"container"},Jn={class:"row border-bottom py-3"},Kn={class:"col-md-9"},Yn=["innerHTML"],Zn={class:"col-md-3"},Qn=["disabled"],Xn={key:0,class:"spinner-border spinner-border-sm alert-icon",role:"status","aria-hidden":"true"},el={class:"row border-bottom py-3"},tl={class:"col-md-9"},sl={class:"col-md-3"},il=["disabled"],al={key:0,class:"spinner-border spinner-border-sm alert-icon",role:"status","aria-hidden":"true"},ol={class:"row border-bottom py-3"},nl={class:"col-md-9"},ll={class:"col-md-3"},rl=["disabled"],dl={key:0,class:"spinner-border spinner-border-sm alert-icon",role:"status","aria-hidden":"true"},ul={class:"row border-bottom py-3"},cl={class:"col-md-12"},hl=["innerHTML"],ml=["innerHTML"],pl={class:"row py-3"},gl={class:"col-md-12"},bl={type:"button",class:"btn btn-primary w-100","data-bs-dismiss":"modal","aria-label":"Close"};function yl(e,t,a,u,o,i){const r=v("LabelsEditor");return n(),l("div",Nn,[s("div",xn,[s("div",Hn,[s("div",jn,[s("h5",zn,d(e.$t("labels.modal_title")),1),Gn]),s("div",qn,[s("div",Wn,[s("div",Jn,[s("div",Kn,[s("p",{innerHTML:e.$t("labels.clear_all_labels_message_html")},null,8,Yn)]),s("div",Zn,[s("button",{type:"button",class:"btn btn-primary w-100",onClick:t[0]||(t[0]=h=>i.clearAllLabels()),disabled:o.clearAllInProgress},[s("span",null,d(e.$t("labels.clear_all_button")),1),o.clearAllInProgress?(n(),l("span",Xn)):c("",!0)],8,Qn)])]),s("div",el,[s("div",tl,[D(r,{id:"addLabels",labels:o.labelsToAdd,title:"labels.add_labels_message_html",studyId:null,onLabelsUpdated:i.onLabelsToAddChanged},null,8,["labels","title","onLabelsUpdated"])]),s("div",sl,[s("button",{type:"button",class:"btn btn-primary w-100",onClick:t[1]||(t[1]=h=>i.addLabels()),disabled:!i.isAddButtonEnabled},[s("span",null,d(e.$t("labels.add_button")),1),o.addInProgress?(n(),l("span",al)):c("",!0)],8,il)])]),s("div",ol,[s("div",nl,[D(r,{id:"removeLabels",labels:o.labelsToRemove,title:"labels.remove_labels_message_html",studyId:null,onLabelsUpdated:i.onLabelsToRemoveChanged},null,8,["labels","title","onLabelsUpdated"])]),s("div",ll,[s("button",{type:"button",class:"btn btn-primary w-100",onClick:t[2]||(t[2]=h=>i.removeLabels()),disabled:!i.isRemoveButtonEnabled},[s("span",null,d(e.$t("labels.remove_button")),1),o.removeInProgress?(n(),l("span",dl)):c("",!0)],8,rl)])]),s("div",ul,[s("div",cl,[(n(!0),l(S,null,T(o.messages,h=>(n(),l("p",{key:h},[s("span",{innerHTML:h.part1},null,8,hl),(n(!0),l(S,null,T(h.labels,m=>(n(),l("span",{key:m,class:"label badge"},d(m),1))),128)),s("span",{innerHTML:h.part2},null,8,ml)]))),128))])]),s("div",pl,[s("div",gl,[s("button",bl,d(e.$t("close")),1)])])])])])])],512)}const fl=L(Bn,[["render",yl]]),_l={props:["resourceOrthancId","resourceDicomUid","resourceLevel","customClass","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags","instanceTags","instanceHeaders","studySeries","seriesInstances"],setup(){return{}},data(){return{isBulkLabelModalVisible:!1,isWsiSeries:!1,hasReportButton:!0,isReportButtonEnabled:!0,modalitiesList:[]}},watch:{async studySeries(e,t){if(this.resourceLevel=="study"){let a=new Set;for(let u of this.studySeries)a.add(u.MainDicomTags.Modality);this.modalitiesList=Array.from(a)}else if(this.resourceLevel=="bulk"){let a=new Set;for(let u of this.selectedStudiesIds){let o=await p.getStudySeries(u);for(let i of o)a.add(i.MainDicomTags.Modality)}this.modalitiesList=Array.from(a)}},async seriesInstances(e,t){if(this.studiesSourceType==g.LOCAL_ORTHANC&&this.resourceLevel=="series"){let a=await p.getSimplifiedInstanceTags(this.seriesInstances[0].ID);this.modalitiesList=[a.Modality],this.isWsiSeries=a.SOPClassUID=="1.2.840.10008.5.1.4.1.1.77.1.6"||a.Modality=="SM"}}},async mounted(){},methods:{toggleSubMenu(e){let t=e.target.parentElement;e.target.tagName=="I"&&(t=t.parentElement),pe(t.querySelector(".dropdown-menu")).toggle(),e.stopPropagation(),e.preventDefault()},deleteResource(e){this.resourceLevel=="bulk"?p.deleteResources(this.resourcesOrthancId).then(()=>{window.location.reload()}).catch(t=>{console.error("failed to delete resources : ",this.resourceOrthancId,t)}):p.deleteResource(this.resourceLevel,this.resourceOrthancId).then(()=>{this.$emit("deletedResource")}).catch(t=>{console.error("failed to delete resource : ",this.resourceOrthancId,t)})},getApiUrl(e){return p.getApiUrl(this.resourceLevel,this.resourceOrthancId,e)},async sendToDicomWebServer(e){const t=await p.sendToDicomWebServer(this.resourcesOrthancId,e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Send to DicomWeb ("+e+")"})},async sendToOrthancPeer(e){const t=await p.sendToOrthancPeer(this.resourcesOrthancId,e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Send to Peer ("+e+")"})},async sendToOrthancPeerWithTransfers(e){const t=await p.sendToOrthancPeerWithTransfers(this.resourcesForTransfer,e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Transfer to Peer ("+e+")"})},async sendToDicomModality(e){const t=await p.sendToDicomModality(this.resourcesOrthancId,e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Send to DICOM ("+e+")"})},async retrieve(){if(this.studiesSourceType==g.REMOTE_DICOM)if(this.resourceLevel=="bulk"){let e=this.selectedStudies.map(a=>({StudyInstanceUID:a.ID,PatientID:a.PatientMainDicomTags.PatientID}));const t=await p.remoteDicomRetrieveResources("Study",this.studiesRemoteSource,e,this.system.DicomAet);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Retrieve "+this.selectedStudies.length+" studies from ("+this.studiesRemoteSource+")"})}else{let e={StudyInstanceUID:this.studyMainDicomTags.StudyInstanceUID,PatientID:this.patientMainDicomTags.PatientID};(this.resourceLevel=="series"||this.resourceLevel=="instance")&&(e.SeriesInstanceUID=this.seriesMainDicomTags.SeriesInstanceUID),this.resourceLevel=="instance"&&(e.SOPInstanceUID=this.instanceTags["0008,0018"].Value);const t=await p.remoteDicomRetrieveResource(this.capitalizeFirstLetter(this.resourceLevel),this.studiesRemoteSource,e,this.system.DicomAet);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Retrieve "+this.capitalizeFirstLetter(this.resourceLevel)+" from ("+this.studiesRemoteSource+")"})}else if(this.studiesSourceType==g.REMOTE_DICOM_WEB){let e;this.resourceLevel=="bulk"?e=this.selectedStudies.map(a=>({Study:a.ID})):this.resourceLevel=="study"?e=[{Study:this.studyMainDicomTags.StudyInstanceUID}]:this.resourceLevel=="series"?e=[{Study:this.studyMainDicomTags.StudyInstanceUID,Series:this.seriesMainDicomTags.SeriesInstanceUID}]:this.resourceLevel=="instance"&&(e=[{Study:this.studyMainDicomTags.StudyInstanceUID,Series:this.seriesMainDicomTags.SeriesInstanceUID,Instance:this.instanceTags.SOPInstanceUID}]);const t=await p.wadoRsRetrieve(this.studiesRemoteSource,e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Retrieve "+this.capitalizeFirstLetter(this.resourceLevel)+" from ("+this.studiesRemoteSource+")"})}},capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)},copyIdToClipboard(){te.copyToClipboard(this.resourceOrthancId)},getViewerIcon(e){const t=this.uiOptions.ViewersOrdering,a=this.uiOptions.ViewersIcons;for(let u of t)if(u==e&&(this.hasOsimisViewer&&e=="osimis-web-viewer"||this.hasStoneViewer&&e=="stone-webviewer"||this.hasVolView&&e=="volview"||this.hasOhifViewer&&["ohif","ohif-vr","ohif-tmtv","ohif-seg","ohif-micro"].includes(e)||this.hasMedDreamViewer&&e=="meddream"||this.hasWsiViewer&&e=="wsi"))return a[u];return"bi bi-eye"},showBulkLabelModal(){this.isBulkLabelModalVisible=!0,setTimeout(()=>{this.$refs["bulk-label-modal"].showModal()},50)},async onBulkModalClosed(){this.isBulkLabelModalVisible=!1,await this.$store.dispatch("labels/refresh")},getOhifViewerUrl(e){if(this.resourceLevel=="bulk"){const t=this.selectedStudies.map(u=>u.MainDicomTags.StudyInstanceUID);return p.getOhifViewerUrlForDicomWebBulkStudies(e,t)}else{if(this.ohifDataSource=="dicom-web")return p.getOhifViewerUrlForDicomWeb(e,this.resourceDicomUid);if(this.ohifDataSource=="dicom-json")return p.getOhifViewerUrlForDicomJson(e,this.resourceOrthancId)}},async goToReportPage(e){!e&&this.resourceOrthancId&&(e=this.resourceOrthancId),e?this.$router.push({name:"reportPage",params:{id:e,name:this.patientName,birthDate:this.patientBirthDate,sex:this.patientSex}}):console.warn("No resourceOrthancId provided!")}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,studiesSourceType:e=>e.studies.sourceType,studiesRemoteSource:e=>e.studies.remoteSource,ohifDataSource:e=>e.configuration.ohifDataSource,installedPlugins:e=>e.configuration.installedPlugins,targetDicomWebServers:e=>e.configuration.targetDicomWebServers,targetDicomModalities:e=>e.configuration.targetDicomModalities,selectedStudiesIds:e=>e.studies.selectedStudiesIds,selectedStudies:e=>e.studies.selectedStudies,orthancPeers:e=>e.configuration.orthancPeers,tokens:e=>e.configuration.tokens,system:e=>e.configuration.system}),componentId(){return this.resourceLevel=="bulk"?"bulk-id":this.resourceOrthancId},hasSendTo(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableSendTo&&(this.hasSendToDicomWeb||this.hasSendToPeers||this.hasSendToDicomModalities||this.hasSendToPeersWithTransfer)},isSendToEnabled(){return this.resourceLevel=="bulk"?this.selectedStudiesIds.length>0:!0},hasLabelsButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableEditLabels&&this.resourceLevel=="bulk"},isLabelsEnabled(){return this.resourceLevel=="bulk"?this.selectedStudiesIds.length>0:!1},hasDeleteButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableDeleteResources},isDeleteEnabled(){return this.resourceLevel=="bulk"?this.selectedStudiesIds.length>0:!0},hasShareButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableShares&&"authorization"in this.installedPlugins&&["bulk","study"].includes(this.resourceLevel)},isShareEnabled(){return this.resourceLevel=="bulk"?this.selectedStudiesIds.length>0:!0},hasAddSeriesButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableAddSeries&&this.resourceLevel=="study"},hasWsiButton(){return!(this.studiesSourceType!=g.LOCAL_ORTHANC||this.resourceLevel!="series"||!this.hasWsiViewer)},isWsiButtonEnabled(){return this.isWsiSeries},wsiViewerUrl(){return p.getWsiViewerUrl(this.resourceOrthancId)},hasSendToPeers(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.orthancPeers.length>0},hasSendToPeersWithTransfer(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.hasSendToPeers&&"transfers"in this.installedPlugins},hasSendToDicomWeb(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.targetDicomWebServers.length>0},hasSendToDicomModalities(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.targetDicomModalities.length>0},hasOsimisViewer(){return this.studiesSourceType==g.LOCAL_ORTHANC&&"osimis-web-viewer"in this.installedPlugins},osimisViewerUrl(){return p.getOsimisViewerUrl(this.resourceLevel,this.resourceOrthancId)},hasWsiViewer(){return this.studiesSourceType==g.LOCAL_ORTHANC&&"wsi"in this.installedPlugins},hasStoneViewer(){return this.studiesSourceType==g.LOCAL_ORTHANC&&"stone-webviewer"in this.installedPlugins},stoneViewerUrl(){if(this.resourceLevel=="bulk"){const e=this.selectedStudies.map(a=>a.MainDicomTags.StudyInstanceUID);return p.getStoneViewerUrlForBulkStudies(e)}else return p.getStoneViewerUrl(this.resourceLevel,this.resourceDicomUid)},hasStoneViewerButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.hasStoneViewer&&(this.resourceLevel=="study"||this.resourceLevel=="bulk")},isStoneViewerButtonEnabled(){return this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0},hasVolView(){return"volview"in this.installedPlugins},volViewUrl(){return p.getVolViewUrl(this.resourceLevel,this.resourceOrthancId)},hasVolViewButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.hasVolView&&(this.resourceLevel=="study"||this.resourceLevel=="series")},isVolViewButtonEnabled(){return this.resourceLevel=="study"||this.resourceLevel=="series"},hasOhifViewer(){return this.uiOptions.EnableOpenInOhifViewer||this.uiOptions.EnableOpenInOhifViewer3},hasOhifViewerButton(){if(!this.uiOptions.ViewersOrdering.includes("ohif")||this.studiesSourceType!=g.LOCAL_ORTHANC)return!1;let e=this.modalitiesList;return e=e.filter(t=>!["SM","ECG","SR","SEG"].includes(t)),e.length==0&&this.resourceLevel!="bulk"?!1:this.uiOptions.EnableOpenInOhifViewer3?this.hasOhifViewer&&(this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.ohifDataSource=="dicom-web"):this.hasOhifViewer&&this.resourceLevel=="study"},hasOhifViewerButtonVr(){return!this.uiOptions.ViewersOrdering.includes("ohif-vr")||this.studiesSourceType!=g.LOCAL_ORTHANC||!(this.modalitiesList.includes("CT")||this.modalitiesList.includes("PT")||this.modalitiesList.includes("MR"))&&this.resourceLevel!="bulk"?!1:this.uiOptions.EnableOpenInOhifViewer3?this.hasOhifViewer&&(this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.ohifDataSource=="dicom-web"):!1},hasOhifViewerButtonTmtv(){return!this.uiOptions.ViewersOrdering.includes("ohif-tmtv")||this.studiesSourceType!=g.LOCAL_ORTHANC||!(this.modalitiesList.includes("CT")&&this.modalitiesList.includes("PT")&&!this.modalitiesList.includes("SM"))&&this.resourceLevel!="bulk"?!1:this.uiOptions.EnableOpenInOhifViewer3?this.hasOhifViewer&&(this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.ohifDataSource=="dicom-web"):!1},hasOhifViewerButtonSeg(){return!this.uiOptions.ViewersOrdering.includes("ohif-seg")||this.studiesSourceType!=g.LOCAL_ORTHANC||!(this.modalitiesList.includes("CT")&&this.modalitiesList.includes("PT")&&!this.modalitiesList.includes("SM"))&&this.resourceLevel!="bulk"?!1:this.uiOptions.EnableOpenInOhifViewer3?this.hasOhifViewer&&(this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.ohifDataSource=="dicom-web"):!1},hasOhifViewerButtonMicroscopy(){return!this.uiOptions.ViewersOrdering.includes("ohif-micro")||this.studiesSourceType!=g.LOCAL_ORTHANC||!this.modalitiesList.includes("SM")&&this.resourceLevel!="bulk"?!1:this.uiOptions.EnableOpenInOhifViewer3?this.hasOhifViewer&&(this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.ohifDataSource=="dicom-web"):!1},ohifViewerUrl(){return this.getOhifViewerUrl("basic")},ohifViewerUrlVr(){return this.getOhifViewerUrl("vr")},ohifViewerUrlTmtv(){return this.getOhifViewerUrl("tmtv")},ohifViewerUrlSeg(){return this.getOhifViewerUrl("seg")},ohifViewerUrlMicro(){return this.getOhifViewerUrl("microscopy")},isOhifButtonBasicViewerEnabled(){return this.uiOptions.EnableOpenInOhifViewer3?this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0:this.resourceLevel=="study"},isOhifButtonVrEnabled(){return this.uiOptions.EnableOpenInOhifViewer3?this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0:!1},isOhifButtonTmtvEnabled(){return this.uiOptions.EnableOpenInOhifViewer3?this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0:!1},isOhifButtonMicroscopyEnabled(){return this.uiOptions.EnableOpenInOhifViewer3?this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0:!1},isOhifButtonSegEnabled(){return this.uiOptions.EnableOpenInOhifViewer3?this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0:!1},hasMedDreamViewer(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableOpenInMedDreamViewer},hasMedDreamViewerButton(){return this.hasMedDreamViewer&&(this.resourceLevel=="study"||this.resourceLevel=="bulk")},isMedDreamViewerButtonEnabled(){return this.resourceLevel=="study"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0},medDreamViewerUrl(){return this.uiOptions.MedDreamViewerPublicRoot+"?study="+this.resourceDicomUid},isPdfPreview(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.resourceLevel=="instance"?this.instanceHeaders["0002,0002"].Value=="1.2.840.10008.5.1.4.1.1.104.1":!1},hasInstancePreviewButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.resourceLevel=="instance"},instancePreviewUrl(){return this.isPdfPreview?p.getInstancePdfUrl(this.resourceOrthancId):p.getInstancePreviewUrl(this.resourceOrthancId)},hasInstanceDownloadButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableDownloadDicomFile&&this.resourceLevel=="instance"},instanceDownloadUrl(){return p.getInstanceDownloadUrl(this.resourceOrthancId)},downloadBulkZipUrl(){return p.getBulkDownloadZipUrl(this.resourcesOrthancId)},downloadBulkDicomDirUrl(){return p.getBulkDownloadDicomDirUrl(this.resourcesOrthancId)},downloadZipUrl(){return p.getDownloadZipUrl(this.resourceLevel,this.resourceOrthancId)},downloadDicomDirUrl(){return p.getDownloadDicomDirUrl(this.resourceLevel,this.resourceOrthancId)},resourceTitle(){return j.getResourceTitle(this.resourceLevel,this.patientMainDicomTags,this.studyMainDicomTags,this.seriesMainDicomTags,this.instanceTags)},osimisViewerIcon(){return this.getViewerIcon("osimis-web-viewer")},stoneViewerIcon(){return this.getViewerIcon("stone-webviewer")},volViewIcon(){return this.getViewerIcon("volview")},medDreamViewerIcon(){return this.getViewerIcon("meddream")},ohifViewerIcon(){return this.getViewerIcon("ohif")},ohifViewerIconVr(){return this.getViewerIcon("ohif-vr")},ohifViewerIconTmtv(){return this.getViewerIcon("ohif-tmtv")},ohifViewerIconSeg(){return this.getViewerIcon("ohif-seg")},ohifViewerIconMicro(){return this.getViewerIcon("ohif-micro")},wsiViewerIcon(){return this.getViewerIcon("wsi")},deleteResourceTitle(){return{study:"delete_study_title",series:"delete_series_title",instance:"delete_instance_title",bulk:"delete_studies_title"}[this.resourceLevel]},deleteResourceBody(){return{study:"delete_study_body",series:"delete_series_body",instance:"delete_instance_body",bulk:"delete_studies_body"}[this.resourceLevel]},hasDownloadZipButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableDownloadZip&&this.resourceLevel!="instance"&&this.resourceLevel!="bulk"},hasBulkDownloadZipButton(){return this.system.ApiVersion<22?!1:this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableDownloadZip&&this.resourceLevel=="bulk"},isBulkDownloadZipEnabled(){return this.selectedStudiesIds.length>0},hasDownloadDicomDirButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableDownloadDicomDir&&this.resourceLevel!="instance"&&this.resourceLevel!="bulk"},hasBulkDownloadDicomDirButton(){return this.system.ApiVersion<22?!1:this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableDownloadDicomDir&&this.resourceLevel=="bulk"},isBulkDownloadDicomDirEnabled(){return this.selectedStudiesIds.length>0},hasRetrieveButton(){return this.studiesSourceType==g.REMOTE_DICOM||this.studiesSourceType==g.REMOTE_DICOM_WEB},isRetrieveButtonEnabled(){return this.resourceLevel!="bulk"||this.resourceLevel=="bulk"&&this.selectedStudiesIds.length>0},hasAnonymizationButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.resourceLevel!="bulk"},isAnonymizationEnabled(){return this.resourceLevel=="study"||this.resourceLevel=="series"?this.uiOptions.EnableAnonymization:!1},hasModificationButton(){return this.studiesSourceType==g.LOCAL_ORTHANC&&this.resourceLevel!="bulk"},isModificationEnabled(){return this.resourceLevel=="study"||this.resourceLevel=="series"?this.uiOptions.EnableModification:!1},hasApiViewButton(){return this.resourceLevel!="bulk"&&this.studiesSourceType==g.LOCAL_ORTHANC&&this.uiOptions.EnableApiViewMenu},resourcesOrthancId(){return this.resourceLevel=="bulk"?this.selectedStudiesIds:[this.resourceOrthancId]},resourcesForTransfer(){return this.resourceLevel=="bulk"?this.selectedStudiesIds.map(e=>({Level:"Study",ID:e})):[{Level:this.capitalizeFirstLetter(this.resourceLevel),ID:this.resourceOrthancId}]},computedResourceLevel(){return this.resourceLevel=="bulk"?"study":this.resourceLevel}},components:{Modal:ee,ShareModal:ca,ModifyModal:Go,TokenLinkButton:ye,BulkLabelsModal:fl,AddSeriesModal:wn}},Dl={class:"btn-group"},vl={class:"btn-group"},Sl={class:"btn-group"},Tl=["data-bs-target","disabled"],Il=["title"],wl={key:0,class:"btn-group"},kl=["data-bs-target","disabled"],Ll=["title"],Ml={key:1,class:"btn-group"},Ol=["data-bs-target"],Cl=["title"],Pl={key:2,class:"btn-group"},$l=["data-bs-target"],Rl=["title"],Ul={key:3,class:"btn-group"},Al=["data-bs-target"],El=["title"],Fl={key:4,class:"btn-group"},Vl={class:"dropdown"},Bl=s("button",{class:"dropdown btn btn-sm btn-secondary m-1 dropdown-toggle",type:"button",id:"apiDropdownMenuId","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("span",{"data-bs-toggle":"tooltip",title:"API"},[s("i",{class:"bi bi-code-slash"})])],-1),Nl={class:"dropdown-menu","aria-labelledby":"apiDropdownMenuId"},xl={key:0},Hl={key:5,class:"btn-group"},jl=["disabled"],zl=["title"],Gl={class:"btn-group"},ql={class:"dropdown"},Wl=["disabled"],Jl=["title"],Kl=s("i",{class:"bi bi-send"},null,-1),Yl=[Kl],Zl={key:1,class:"dropdown-menu","aria-labelledby":"sendToDropdownMenuId"},Ql={key:0,class:"dropdown-submenu"},Xl=s("i",{class:"bi bi-caret-down"},null,-1),er={class:"dropdown-menu"},tr=["onClick"],sr={key:1,class:"dropdown-submenu"},ir=s("i",{class:"bi bi-caret-down"},null,-1),ar={class:"dropdown-menu"},or=["onClick"],nr={key:2,class:"dropdown-submenu"},lr=s("i",{class:"bi bi-caret-down"},null,-1),rr={class:"dropdown-menu"},dr=["onClick"],ur={key:3,class:"dropdown-submenu"},cr=s("i",{class:"bi bi-caret-down"},null,-1),hr={class:"dropdown-menu"},mr=["onClick"],pr={key:6,class:"btn-group"},gr=["disabled"],br=["title"],yr={key:7,class:"btn-group"},fr=["title"];function _r(e,t,a,u,o,i){const r=v("TokenLinkButton"),h=v("Modal"),m=v("ShareModal"),y=v("ModifyModal"),f=v("AddSeriesModal"),R=v("BulkLabelsModal");return n(),l("div",null,[s("div",Dl,[(n(!0),l(S,null,T(e.uiOptions.ViewersOrdering,_=>(n(),l("span",{key:_},[_=="meddream"&&i.hasMedDreamViewerButton?(n(),w(r,{key:0,disabled:!i.isMedDreamViewerButtonEnabled,iconClass:i.medDreamViewerIcon,level:i.computedResourceLevel,linkUrl:i.medDreamViewerUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_meddream"),tokenType:"meddream-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),i.hasOsimisViewer&&_=="osimis-web-viewer"&&(this.resourceLevel=="study"||this.resourceLevel=="series")?(n(),w(r,{key:1,iconClass:i.osimisViewerIcon,level:this.resourceLevel,linkUrl:i.osimisViewerUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_osimis"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),_=="stone-webviewer"&&i.hasStoneViewerButton?(n(),w(r,{key:2,disabled:!i.isStoneViewerButtonEnabled,iconClass:i.stoneViewerIcon,level:i.computedResourceLevel,linkUrl:i.stoneViewerUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_stone"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),_=="volview"&&i.hasVolViewButton?(n(),w(r,{key:3,disabled:!i.isVolViewButtonEnabled,iconClass:i.volViewIcon,level:i.computedResourceLevel,linkUrl:i.volViewUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_volview"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),_=="ohif"&&i.hasOhifViewerButton?(n(),w(r,{key:4,disabled:!i.isOhifButtonBasicViewerEnabled,iconClass:i.ohifViewerIcon,level:i.computedResourceLevel,linkUrl:i.ohifViewerUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_ohif"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),_=="ohif-vr"&&i.hasOhifViewerButtonVr?(n(),w(r,{key:5,disabled:!i.isOhifButtonVrEnabled,iconClass:i.ohifViewerIconVr,level:i.computedResourceLevel,linkUrl:i.ohifViewerUrlVr,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_ohif_vr"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),_=="ohif-tmtv"&&i.hasOhifViewerButtonTmtv?(n(),w(r,{key:6,disabled:!i.isOhifButtonTmtvEnabled,iconClass:i.ohifViewerIconTmtv,level:i.computedResourceLevel,linkUrl:i.ohifViewerUrlTmtv,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_ohif_tmtv"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),_=="ohif-seg"&&i.hasOhifViewerButtonSeg?(n(),w(r,{key:7,disabled:!i.isOhifButtonSegEnabled,iconClass:i.ohifViewerIconSeg,level:i.computedResourceLevel,linkUrl:i.ohifViewerUrlSeg,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_ohif_seg"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0),_=="ohif-micro"&&i.hasOhifViewerButtonMicroscopy?(n(),w(r,{key:8,disabled:!i.isOhifButtonMicroscopyEnabled,iconClass:i.ohifViewerIconMicro,level:i.computedResourceLevel,linkUrl:i.ohifViewerUrlMicro,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_ohif_microscopy"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["disabled","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0)]))),128)),i.hasInstancePreviewButton?(n(),w(r,{key:0,iconClass:"bi bi-binoculars",level:this.resourceLevel,linkUrl:i.instancePreviewUrl,resourcesOrthancId:[a.resourceOrthancId],title:e.$t("preview"),tokenType:"download-instant-link",opensInNewTab:!0},null,8,["level","linkUrl","resourcesOrthancId","title"])):c("",!0),i.hasWsiButton?(n(),w(r,{key:1,hidden:!i.isWsiButtonEnabled,iconClass:i.wsiViewerIcon,level:this.resourceLevel,linkUrl:i.wsiViewerUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("view_in_wsi_viewer"),tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["hidden","iconClass","level","linkUrl","resourcesOrthancId","title"])):c("",!0)]),s("div",vl,[i.hasDownloadZipButton?(n(),w(r,{key:0,iconClass:"bi bi-download",level:this.resourceLevel,linkUrl:i.downloadZipUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("download_zip"),tokenType:"download-instant-link"},null,8,["level","linkUrl","resourcesOrthancId","title"])):c("",!0),i.hasBulkDownloadZipButton?(n(),w(r,{key:1,iconClass:"bi bi-download",level:"bulk-study",linkUrl:i.downloadBulkZipUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("download_zip"),tokenType:"download-instant-link",disabled:!i.isBulkDownloadZipEnabled},null,8,["linkUrl","resourcesOrthancId","title","disabled"])):c("",!0),i.hasDownloadDicomDirButton?(n(),w(r,{key:2,iconClass:"bi bi-box-arrow-down",level:this.resourceLevel,linkUrl:i.downloadDicomDirUrl,resourcesOrthancId:[a.resourceOrthancId],title:e.$t("download_dicomdir"),tokenType:"download-instant-link"},null,8,["level","linkUrl","resourcesOrthancId","title"])):c("",!0),i.hasBulkDownloadDicomDirButton?(n(),w(r,{key:3,iconClass:"bi bi-box-arrow-down",level:"bulk-study",linkUrl:i.downloadBulkDicomDirUrl,resourcesOrthancId:i.resourcesOrthancId,title:e.$t("download_dicomdir"),tokenType:"download-instant-link",disabled:!i.isBulkDownloadDicomDirEnabled},null,8,["linkUrl","resourcesOrthancId","title","disabled"])):c("",!0),i.hasInstanceDownloadButton?(n(),w(r,{key:4,iconClass:"bi bi-download",level:this.resourceLevel,linkUrl:i.instanceDownloadUrl,resourcesOrthancId:[a.resourceOrthancId],title:e.$t("download_dicom_file"),tokenType:"download-instant-link"},null,8,["level","linkUrl","resourcesOrthancId","title"])):c("",!0)]),s("div",Sl,[i.hasDeleteButton?(n(),l("button",{key:0,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#delete-modal-"+this.resourceOrthancId,disabled:!i.isDeleteEnabled},[s("i",{class:"bi bi-trash","data-bs-toggle":"tooltip",title:e.$t("delete")},null,8,Il)],8,Tl)):c("",!0),i.hasDeleteButton?(n(),w(h,{key:1,id:"delete-modal-"+this.resourceOrthancId,headerText:e.$t(this.deleteResourceTitle)+" "+this.resourceTitle,okText:e.$t("delete"),cancelText:e.$t("cancel"),bodyText:e.$t(this.deleteResourceBody),onOk:t[0]||(t[0]=_=>i.deleteResource(_))},null,8,["id","headerText","okText","cancelText","bodyText"])):c("",!0)]),i.hasShareButton?(n(),l("div",wl,[s("button",{class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#share-modal-"+this.resourceOrthancId,disabled:!i.isShareEnabled},[s("i",{class:"bi bi-share","data-bs-toggle":"tooltip",title:e.$t("share.button_title")},null,8,Ll)],8,kl),D(m,{id:"share-modal-"+this.resourceOrthancId,orthancId:this.resourceOrthancId,studyMainDicomTags:this.studyMainDicomTags,patientMainDicomTags:this.patientMainDicomTags},null,8,["id","orthancId","studyMainDicomTags","patientMainDicomTags"])])):c("",!0),i.hasModificationButton?(n(),l("div",Ml,[i.isModificationEnabled?(n(),l("button",{key:0,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#modify-modal-"+this.resourceOrthancId},[s("i",{class:"bi bi-pencil","data-bs-toggle":"tooltip",title:e.$t("modify.modify_button_title")},null,8,Cl)],8,Ol)):c("",!0),i.isModificationEnabled?(n(),w(y,{key:1,id:"modify-modal-"+this.resourceOrthancId,orthancId:this.resourceOrthancId,resourceLevel:this.resourceLevel,seriesMainDicomTags:this.seriesMainDicomTags,studyMainDicomTags:this.studyMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,isAnonymization:!1},null,8,["id","orthancId","resourceLevel","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags"])):c("",!0)])):c("",!0),i.hasAnonymizationButton?(n(),l("div",Pl,[i.isAnonymizationEnabled?(n(),l("button",{key:0,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#anonymize-modal-"+this.resourceOrthancId},[s("i",{class:"bi bi-person-slash","data-bs-toggle":"tooltip",title:e.$t("modify.anonymize_button_title")},null,8,Rl)],8,$l)):c("",!0),i.isAnonymizationEnabled?(n(),w(y,{key:1,id:"anonymize-modal-"+this.resourceOrthancId,orthancId:this.resourceOrthancId,resourceLevel:this.resourceLevel,seriesMainDicomTags:this.seriesMainDicomTags,studyMainDicomTags:this.studyMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,isAnonymization:!0},null,8,["id","orthancId","resourceLevel","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags"])):c("",!0)])):c("",!0),i.hasAddSeriesButton?(n(),l("div",Ul,[s("button",{class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#add-series-modal-"+this.resourceOrthancId},[s("i",{class:"bi bi-file-earmark-plus","data-bs-toggle":"tooltip",title:e.$t("add_series.button_title")},null,8,El)],8,Al),D(f,{id:"add-series-modal-"+this.resourceOrthancId,orthancStudyId:this.resourceOrthancId,studyMainDicomTags:this.studyMainDicomTags,patientMainDicomTags:this.patientMainDicomTags},null,8,["id","orthancStudyId","studyMainDicomTags","patientMainDicomTags"])])):c("",!0),i.hasApiViewButton?(n(),l("div",Fl,[s("div",Vl,[Bl,s("ul",Nl,[s("li",null,[s("button",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=(..._)=>i.copyIdToClipboard&&i.copyIdToClipboard(..._))},d(e.$t("copy_orthanc_id")),1)]),s("li",null,[D(r,{linkType:"dropdown-item",level:this.resourceLevel,linkUrl:i.getApiUrl(""),resourcesOrthancId:[a.resourceOrthancId],title:"/",tokenType:"download-instant-link",opensInNewTab:!0},null,8,["level","linkUrl","resourcesOrthancId"])]),this.resourceLevel=="instance"?(n(),l("li",xl,[D(r,{linkType:"dropdown-item",level:this.resourceLevel,linkUrl:i.getApiUrl("/tags?simplify"),resourcesOrthancId:[a.resourceOrthancId],title:"/tags?simplify",tokenType:"download-instant-link",opensInNewTab:!0},null,8,["level","linkUrl","resourcesOrthancId"])])):c("",!0),s("li",null,[D(r,{linkType:"dropdown-item",level:this.resourceLevel,linkUrl:i.getApiUrl("/metadata?expand"),resourcesOrthancId:[a.resourceOrthancId],title:"/metadata?expand",tokenType:"download-instant-link",opensInNewTab:!0},null,8,["level","linkUrl","resourcesOrthancId"])]),s("li",null,[D(r,{linkType:"dropdown-item",level:this.resourceLevel,linkUrl:i.getApiUrl("/statistics"),resourcesOrthancId:[a.resourceOrthancId],title:"/statistics",tokenType:"download-instant-link",opensInNewTab:!0},null,8,["level","linkUrl","resourcesOrthancId"])]),s("li",null,[D(r,{linkType:"dropdown-item",level:this.resourceLevel,linkUrl:i.getApiUrl("/attachments?expand"),resourcesOrthancId:[a.resourceOrthancId],title:"/attachments?expand",tokenType:"download-instant-link",opensInNewTab:!0},null,8,["level","linkUrl","resourcesOrthancId"])])])])])):c("",!0),this.resourceLevel=="bulk"?(n(),l("div",Hl,[i.hasLabelsButton?(n(),l("button",{key:0,class:"btn btn-sm btn-secondary m-1",type:"button",disabled:!i.isLabelsEnabled,onClick:t[2]||(t[2]=_=>i.showBulkLabelModal())},[s("i",{class:"bi bi-tag","data-bs-toggle":"tooltip",title:e.$t("labels.edit_labels_button")},null,8,zl)],8,jl)):c("",!0),e.uiOptions.EnableEditLabels&&o.isBulkLabelModalVisible?(n(),w(R,{key:1,id:"labels2-modal2-"+this.componentId,ref:"bulk-label-modal",resourceLevel:this.resourceLevel,resourcesOrthancId:e.selectedStudiesIds,onBulkModalClosed:i.onBulkModalClosed},null,8,["id","resourceLevel","resourcesOrthancId","onBulkModalClosed"])):c("",!0)])):c("",!0),s("div",Gl,[s("div",ql,[i.hasSendTo?(n(),l("button",{key:0,class:"dropdown btn btn-sm btn-secondary m-1 dropdown-toggle",type:"button",id:"sendToDropdownMenuId","data-bs-toggle":"dropdown","aria-expanded":"false",disabled:!i.isSendToEnabled},[s("span",{"data-bs-toggle":"tooltip",title:e.$t("send_to.button_title")},Yl,8,Jl)],8,Wl)):c("",!0),i.hasSendTo?(n(),l("ul",Zl,[i.hasSendToPeers?(n(),l("li",Ql,[s("a",{class:"dropdown-item",onClick:t[3]||(t[3]=(..._)=>i.toggleSubMenu&&i.toggleSubMenu(..._)),href:"#"},[b(d(e.$t("send_to.orthanc_peer"))+" ",1),Xl]),s("ul",er,[(n(!0),l(S,null,T(e.orthancPeers,_=>(n(),l("li",{key:_},[s("a",{class:"dropdown-item",onClick:M=>i.sendToOrthancPeer(_)},d(_),9,tr)]))),128))])])):c("",!0),i.hasSendToPeersWithTransfer?(n(),l("li",sr,[s("a",{class:"dropdown-item",onClick:t[4]||(t[4]=(..._)=>i.toggleSubMenu&&i.toggleSubMenu(..._)),href:"#"},[b(d(e.$t("send_to.transfers"))+" ",1),ir]),s("ul",ar,[(n(!0),l(S,null,T(e.orthancPeers,_=>(n(),l("li",{key:_},[s("a",{class:"dropdown-item",onClick:M=>i.sendToOrthancPeerWithTransfers(_)},d(_),9,or)]))),128))])])):c("",!0),i.hasSendToDicomWeb?(n(),l("li",nr,[s("a",{class:"dropdown-item",onClick:t[5]||(t[5]=(..._)=>i.toggleSubMenu&&i.toggleSubMenu(..._)),href:"#"},[b(d(e.$t("send_to.dicom_web"))+" ",1),lr]),s("ul",rr,[(n(!0),l(S,null,T(e.targetDicomWebServers,_=>(n(),l("li",{key:_},[s("a",{class:"dropdown-item",onClick:M=>i.sendToDicomWebServer(_)},d(_),9,dr)]))),128))])])):c("",!0),i.hasSendToDicomModalities?(n(),l("li",ur,[s("a",{class:"dropdown-item",onClick:t[6]||(t[6]=(..._)=>i.toggleSubMenu&&i.toggleSubMenu(..._)),href:"#"},[b(d(e.$t("send_to.dicom"))+" ",1),cr]),s("ul",hr,[(n(!0),l(S,null,T(e.targetDicomModalities,_=>(n(),l("li",{key:_},[s("a",{class:"dropdown-item",onClick:M=>i.sendToDicomModality(_)},d(_),9,mr)]))),128))])])):c("",!0)])):c("",!0)])]),i.hasRetrieveButton?(n(),l("div",pr,[s("button",{class:"btn btn-sm btn-secondary m-1",type:"button",disabled:!i.isRetrieveButtonEnabled,onClick:t[7]||(t[7]=(..._)=>i.retrieve&&i.retrieve(..._))},[s("i",{class:"bi bi-box-arrow-in-down","data-bs-toggle":"tooltip",title:e.$t("retrieve")},null,8,br)],8,gr)])):c("",!0),o.hasReportButton?(n(),l("div",yr,[s("button",{class:"btn btn-sm btn-secondary m-1",type:"button",onClick:t[8]||(t[8]=_=>i.goToReportPage(a.resourceOrthancId))},[s("i",{class:"bi bi-file-earmark-text","data-bs-toggle":"tooltip",title:e.$t("Report")},null,8,fr)])])):c("",!0)])}const K=L(_l,[["render",_r]]),Dr={props:["tags"],data(){return{}},mounted(){},computed:{},methods:{},components:{CopyToClipboardButton:J}},vr={key:0},Sr={class:"details-label"},Tr={key:1,class:"d-flex w-100"},Ir={class:"details-label"},wr={key:0,class:"details"};function kr(e,t,a,u,o,i){const r=v("tags-tree",!0),h=v("CopyToClipboardButton");return n(),l("ul",null,[(n(!0),l(S,null,T(a.tags,(m,y)=>(n(),l("li",{key:y},[m.Type=="Sequence"?(n(),l("span",vr,[s("span",Sr,d(y)+" - "+d(m.Name)+": ",1),s("ul",null,[(n(!0),l(S,null,T(m.Value,(f,R)=>(n(),l("li",{key:f},[b(" Item "+d(R+1)+" ",1),D(r,{tags:f},null,8,["tags"])]))),128))])])):(n(),l("span",Tr,[s("span",Ir,d(y)+" - "+d(m.Name)+": ",1),m.Type=="String"?(n(),l("span",wr,d(m.Value),1)):c("",!0),D(h,{valueToCopy:m.Value},null,8,["valueToCopy"])]))]))),128))])}const Lr=L(Dr,[["render",kr],["__scopeId","data-v-cc26be0e"]]),Mr={props:["instanceId","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags"],emits:["deletedInstance"],data(){return{tags:{},headers:{},loaded:!1}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,studiesSourceType:e=>e.studies.sourceType})},async mounted(){this.studiesSourceType==g.LOCAL_ORTHANC?(this.tags=await p.getInstanceTags(this.instanceId),this.headers=await p.getInstanceHeader(this.instanceId)):this.studiesSourceType==g.REMOTE_DICOM&&(this.tags={"0008,0018":{Name:"SOPInstanceUID",Type:"String",Value:this.instanceId}}),this.loaded=!0},components:{ResourceButtonGroup:K,TagsTree:Lr},methods:{onDeletedInstance(){this.$emit("deletedInstance",this.instanceId)}}},Or={key:0,class:"table table-responsive table-sm instance-details-table"},Cr={width:"80%",class:"cut-text"},Pr={width:"20%",class:"instance-button-group"},$r={width:"80%",class:"cut-text"};function Rr(e,t,a,u,o,i){const r=v("TagsTree"),h=v("ResourceButtonGroup");return o.loaded?(n(),l("table",Or,[s("tr",null,[s("td",Cr,[D(r,{tags:o.headers},null,8,["tags"])]),s("td",Pr,[D(h,{resourceOrthancId:this.instanceId,resourceLevel:"instance",studyMainDicomTags:this.studyMainDicomTags,seriesMainDicomTags:this.seriesMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,instanceTags:this.tags,instanceHeaders:this.headers,onDeletedResource:i.onDeletedInstance},null,8,["resourceOrthancId","studyMainDicomTags","seriesMainDicomTags","patientMainDicomTags","instanceTags","instanceHeaders","onDeletedResource"])])]),s("tr",null,[s("td",$r,[D(r,{tags:o.tags},null,8,["tags"])])])])):c("",!0)}const Ur=L(Mr,[["render",Rr],["__scopeId","data-v-3e81f50e"]]),Ar={props:["instanceId","instanceInfo","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags"],emits:["deletedInstance"],data(){return{loaded:!1,expanded:!1,collapseElement:null}},mounted(){this.$refs["instance-collapsible-details"].addEventListener("show.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!0)}),this.$refs["instance-collapsible-details"].addEventListener("hide.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!1)});var e=this.$refs["instance-collapsible-details"];this.collapseElement=new G.Collapse(e,{toggle:!1});for(const[t,a]of Object.entries(this.$route.query))t==="expand"&&a==="instance"&&this.collapseElement.show()},methods:{onDeletedInstance(e){this.$emit("deletedInstance",e)}},components:{InstanceDetails:Ur}},Er=e=>(V("data-v-751d476d"),e=e(),B(),e),Fr=Er(()=>s("td",null,null,-1)),Vr=["data-bs-target"],Br=["data-bs-target"],Nr=["data-bs-target"],xr=["id"],Hr={colspan:"100"};function jr(e,t,a,u,o,i){const r=v("InstanceDetails");return n(),l("tbody",null,[s("tr",{class:k({"instance-row-collapsed":!o.expanded,"instance-row-expanded":o.expanded})},[Fr,s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#instance-details-"+this.instanceId},d(a.instanceInfo.MainDicomTags.InstanceNumber),9,Vr),s("td",{class:"cut-text","data-bs-toggle":"collapse","data-bs-target":"#instance-details-"+this.instanceId},d(a.instanceInfo.MainDicomTags.SOPInstanceUID),9,Br),s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#instance-details-"+this.instanceId},d(a.instanceInfo.MainDicomTags.NumberOfFrames),9,Nr)],2),s("tr",{class:k(["collapse",{"instance-details-collapsed":!o.expanded,"instance-details-expanded":o.expanded}]),id:"instance-details-"+this.instanceId,ref:"instance-collapsible-details"},[s("td",Hr,[this.expanded?(n(),w(r,{key:0,instanceId:this.instanceId,studyMainDicomTags:this.studyMainDicomTags,seriesMainDicomTags:this.seriesMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,onDeletedInstance:i.onDeletedInstance},null,8,["instanceId","studyMainDicomTags","seriesMainDicomTags","patientMainDicomTags","onDeletedInstance"])):c("",!0)])],10,xr)])}const zr=L(Ar,[["render",jr],["__scopeId","data-v-751d476d"]]),Gr={props:["seriesId","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags","seriesInstances"],emits:["deletedInstance"],data(){return{loaded:!1,instancesInfo:{}}},computed:{sortedInstancesIds(){if(this.loaded){let e=Object.keys(this.instancesInfo);return e.sort((t,a)=>parseInt(this.instancesInfo[t].IndexInSeries)>parseInt(this.instancesInfo[a].IndexInSeries)?1:-1),e}else return[]}},watch:{seriesInstances(e,t){for(const a of this.seriesInstances)this.instancesInfo[a.ID]=a;this.loaded=!0}},async mounted(){},methods:{onDeletedInstance(e){delete this.instancesInfo[e],this.$emit("deletedInstance",e)}},components:{InstanceItem:zr}},qr={class:"table table-responsive table-sm instance-table"},Wr=s("th",{width:"2%",scope:"col",class:"instance-table-header"},null,-1),Jr=["title"],Kr=s("th",{width:"40%",scope:"col",class:"instance-table-header cut-text","data-bs-toggle":"tooltip",title:"SOP Instance UID"},"SOP Instance UID",-1),Yr=["title"];function Zr(e,t,a,u,o,i){const r=v("InstanceItem");return n(),l("table",qr,[s("thead",null,[Wr,s("th",{width:"7%",scope:"col",class:"instance-table-header cut-text","data-bs-toggle":"tooltip",title:e.$t("dicom_tags.InstanceNumber")},d(e.$t("dicom_tags.InstanceNumber")),9,Jr),Kr,s("th",{width:"5%",scope:"col",class:"series-table-header cut-text text-center","data-bs-toggle":"tooltip",title:e.$t("dicom_tags.NumberOfFrames")},"# "+d(e.$t("frames")),9,Yr)]),(n(!0),l(S,null,T(i.sortedInstancesIds,h=>(n(),w(r,{key:h,instanceId:h,instanceInfo:o.instancesInfo[h],studyMainDicomTags:this.studyMainDicomTags,seriesMainDicomTags:this.seriesMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,onDeletedInstance:i.onDeletedInstance},null,8,["instanceId","instanceInfo","studyMainDicomTags","seriesMainDicomTags","patientMainDicomTags","onDeletedInstance"]))),128))])}const Qr=L(Gr,[["render",Zr]]),Xr={props:["truncate","copy","tags","tag","showIfEmpty"],setup(){return{}},data(){return{}},mounted(){},methods:{},computed:{...P({uiOptions:e=>e.configuration.uiOptions}),title(){return z(this.$i18n.t,this.$i18n.te,this.tag)},value(){if(this.hasValue){let e=this.tags[this.tag];return $.isDateTag(this.tag)?$.formatDateForDisplay(e,this.uiOptions.DateFormat):e}else return""},hasValue(){return this.tag in this.tags},showValue(){return this.showIfEmpty||this.hasValue}},components:{CopyToClipboardButton:J}},ed={key:0,class:"d-flex"},td=["title"],sd=["title"];function id(e,t,a,u,o,i){const r=v("CopyToClipboardButton");return i.showValue?(n(),l("li",ed,[s("span",{class:k(["details-label",{"d-inline-block text-truncate":this.truncate}]),"data-bs-toggle":"tooltip",title:i.title},d(i.title)+": ",11,td),s("span",{class:"details","data-bs-toggle":"tooltip",title:i.value},d(i.value),9,sd),!this.copy&&i.value&&i.value.length>0?(n(),w(r,{key:0,valueToCopy:i.value},null,8,["valueToCopy"])):c("",!0)])):c("",!0)}const _e=L(Xr,[["render",id]]),ad={props:["seriesId","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags","instancesIds"],emits:["deletedSeries"],setup(){},data(){return{seriesInstances:[]}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,studiesSourceType:e=>e.studies.sourceType,studiesRemoteSource:e=>e.studies.remoteSource})},async mounted(){if(this.studiesSourceType==g.LOCAL_ORTHANC)this.seriesInstances=await p.getSeriesInstances(this.seriesId);else if(this.studiesSourceType==g.REMOTE_DICOM){let e=await p.remoteDicomFind("Instance",this.studiesRemoteSource,{StudyInstanceUID:this.studyMainDicomTags.StudyInstanceUID,PatientID:this.patientMainDicomTags.PatientID,SeriesInstanceUID:this.seriesMainDicomTags.SeriesInstanceUID,SOPInstanceUID:"",InstanceNumber:"",NumberOfFrames:""},!1);this.seriesInstances=e.map(t=>({ID:t.SOPInstanceUID,MainDicomTags:t})),this.seriesInstances=this.seriesInstances.sort((t,a)=>(parseInt(t.MainDicomTags.InstanceNumber)??t.MainDicomTags.SOPInstanceUID)<(parseInt(a.MainDicomTags.InstanceNumber)??a.MainDicomTags.SOPInstanceUID)?1:-1)}else if(this.studiesSourceType==g.REMOTE_DICOM_WEB){let e=await p.qidoRs("Instance",this.studiesRemoteSource,{StudyInstanceUID:this.studyMainDicomTags.StudyInstanceUID,SeriesInstanceUID:this.seriesMainDicomTags.SeriesInstanceUID,SOPInstanceUID:"",InstanceNumber:"",NumberOfFrames:""},!1);this.seriesInstances=e.map(t=>({ID:t.SOPInstanceUID,MainDicomTags:t})),this.seriesInstances=this.seriesInstances.sort((t,a)=>(parseInt(t.MainDicomTags.InstanceNumber)??t.MainDicomTags.SOPInstanceUID)<(parseInt(a.MainDicomTags.InstanceNumber)??a.MainDicomTags.SOPInstanceUID)?1:-1)}},components:{ResourceButtonGroup:K,InstanceList:Qr,ResourceDetailText:_e},methods:{onDeletedInstance(e){const t=this.instancesIds.indexOf(e);t>=0&&(this.instancesIds.splice(t,1),this.instancesIds.length==0&&this.$emit("deletedSeries",this.seriesId))},onDeletedSeries(){this.$emit("deletedSeries",this.seriesId)}}},od={class:"table table-responsive table-sm series-details-table"},nd={width:"70%",class:"cut-text"},ld={width:"30%",class:"series-button-group"},rd={colspan:"100"};function dd(e,t,a,u,o,i){const r=v("ResourceDetailText"),h=v("ResourceButtonGroup"),m=v("InstanceList");return n(),l("table",od,[s("tr",null,[s("td",nd,[s("ul",null,[(n(!0),l(S,null,T(e.uiOptions.SeriesMainTags,y=>(n(),w(r,{key:y,tags:a.seriesMainDicomTags,tag:y,showIfEmpty:!0},null,8,["tags","tag"]))),128))])]),s("td",ld,[D(h,{resourceOrthancId:this.seriesId,resourceLevel:"series",resourceDicomUid:this.seriesMainDicomTags.SeriesInstanceUID,studyMainDicomTags:this.studyMainDicomTags,seriesMainDicomTags:this.seriesMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,seriesInstances:this.seriesInstances,customClass:"instance-button-group",onDeletedResource:i.onDeletedSeries},null,8,["resourceOrthancId","resourceDicomUid","studyMainDicomTags","seriesMainDicomTags","patientMainDicomTags","seriesInstances","onDeletedResource"])])]),s("tr",null,[s("td",rd,[D(m,{seriesId:this.seriesId,seriesMainDicomTags:this.seriesMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,studyMainDicomTags:this.studyMainDicomTags,instancesIds:this.instancesIds,seriesInstances:this.seriesInstances,onDeletedInstance:i.onDeletedInstance},null,8,["seriesId","seriesMainDicomTags","patientMainDicomTags","studyMainDicomTags","instancesIds","seriesInstances","onDeletedInstance"])])])])}const ud=L(ad,[["render",dd],["__scopeId","data-v-a9d5c560"]]),cd={props:["seriesId","seriesInfo","studyMainDicomTags","patientMainDicomTags"],emits:["deletedSeries"],data(){return{loaded:!1,expanded:!1,collapseElement:null}},computed:{...P({studiesSourceType:e=>e.studies.sourceType}),instancesCount(){if(this.studiesSourceType==g.LOCAL_ORTHANC)return this.seriesInfo.Instances.length;if(this.studiesSourceType==g.REMOTE_DICOM||this.studiesSourceType==g.REMOTE_DICOM_WEB)return this.seriesInfo.MainDicomTags.NumberOfSeriesRelatedInstances}},mounted(){this.$refs["series-collapsible-details"].addEventListener("show.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!0)}),this.$refs["series-collapsible-details"].addEventListener("hide.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!1)});var e=this.$refs["series-collapsible-details"];this.collapseElement=new G.Collapse(e,{toggle:!1});for(const[t,a]of Object.entries(this.$route.query))t==="expand"&&(a==="series"||a==="instance")&&this.collapseElement.show()},methods:{onDeletedSeries(){this.$emit("deletedSeries",this.seriesId)}},components:{SeriesDetails:ud}},hd=e=>(V("data-v-8c373f54"),e=e(),B(),e),md=hd(()=>s("td",null,null,-1)),pd=["data-bs-target"],gd=["data-bs-target"],bd=["title"],yd=["data-bs-target"],fd=["data-bs-target"],_d=["id"],Dd={colspan:"100"};function vd(e,t,a,u,o,i){const r=v("SeriesDetails");return n(),l("tbody",null,[s("tr",{class:k({"series-row-collapsed":!o.expanded,"series-row-expanded":o.expanded})},[md,s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},d(a.seriesInfo.MainDicomTags.SeriesNumber),9,pd),s("td",{class:"cut-text","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},[s("span",{"data-bs-toggle":"tooltip",title:a.seriesInfo.MainDicomTags.SeriesDescription},d(a.seriesInfo.MainDicomTags.SeriesDescription),9,bd)],8,gd),s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},d(a.seriesInfo.MainDicomTags.Modality),9,yd),s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},d(i.instancesCount),9,fd)],2),s("tr",{class:k(["collapse",{"series-details-collapsed":!o.expanded,"series-details-expanded":o.expanded}]),id:"series-details-"+this.seriesId,ref:"series-collapsible-details"},[s("td",Dd,[this.expanded?(n(),w(r,{key:0,seriesId:this.seriesId,instancesIds:this.seriesInfo.Instances,seriesMainDicomTags:this.seriesInfo.MainDicomTags,studyMainDicomTags:this.studyMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,onDeletedSeries:i.onDeletedSeries},null,8,["seriesId","instancesIds","seriesMainDicomTags","studyMainDicomTags","patientMainDicomTags","onDeletedSeries"])):c("",!0)])],10,_d)])}const De=L(cd,[["render",vd],["__scopeId","data-v-8c373f54"]]),Sd={props:["studyId","patientMainDicomTags","studyMainDicomTags","studySeries"],emits:["deletedStudy"],data(){return{seriesInfo:{}}},computed:{sortedSeriesIds(){let e=Object.keys(this.seriesInfo);return e.sort((t,a)=>parseInt(this.seriesInfo[t].MainDicomTags.SeriesNumber)>parseInt(this.seriesInfo[a].MainDicomTags.SeriesNumber)?1:-1),e}},watch:{studySeries(e,t){for(const a of this.studySeries)this.seriesInfo[a.ID]=a}},methods:{columnTitle(e){return e=="instances_number"?"# "+this.$i18n.t("instances"):z(this.$i18n.t,this.$i18n.te,e)},columnTooltip(e){return e=="instances_number"?this.$i18n.t("instances_number"):z(this.$i18n.t,this.$i18n.te,e)},onDeletedSeries(e){delete this.seriesInfo[e],Object.keys(this.seriesInfo).length==0?this.$emit("deletedStudy",this.studyId):this.messageBus.emit("deleted-series-from-study-"+this.studyId)}},components:{SeriesItem:De}},Td={class:"table table-responsive table-sm series-table"},Id=s("th",{width:"2%",scope:"col",class:"series-table-header"},null,-1),wd=["title"],kd=["title"],Ld=["title"],Md=["title"];function Od(e,t,a,u,o,i){const r=v("SeriesItem");return n(),l("table",Td,[s("thead",null,[Id,s("th",{width:"7%",scope:"col",class:"series-table-header cut-text","data-bs-toggle":"tooltip",title:i.columnTooltip("SeriesNumber")},d(i.columnTitle("SeriesNumber")),9,wd),s("th",{width:"40%",scope:"col",class:"series-table-header cut-text","data-bs-toggle":"tooltip",title:i.columnTooltip("SeriesDescription")},d(i.columnTitle("SeriesDescription")),9,kd),s("th",{width:"11%",scope:"col",class:"series-table-header cut-text text-center","data-bs-toggle":"tooltip",title:i.columnTooltip("Modality")},d(i.columnTitle("Modality")),9,Ld),s("th",{width:"5%",scope:"col",class:"series-table-header cut-text text-center","data-bs-toggle":"tooltip",title:i.columnTooltip("instances_number")},d(i.columnTitle("instances_number")),9,Md)]),(n(!0),l(S,null,T(i.sortedSeriesIds,h=>(n(),w(r,{key:h,seriesId:h,seriesInfo:o.seriesInfo[h],studyMainDicomTags:this.studyMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,onDeletedSeries:i.onDeletedSeries},null,8,["seriesId","seriesInfo","studyMainDicomTags","patientMainDicomTags","onDeletedSeries"]))),128))])}const ve=L(Sd,[["render",Od]]),Cd={props:["studyId","studyMainDicomTags","patientMainDicomTags","labels"],emits:["deletedStudy","studyLabelsUpdated"],setup(){},data(){return{samePatientStudiesCount:0,studySeries:[],hasLoadedSamePatientsStudiesCount:!1,allLabelsLocalCopy:new Set,remoteStudyFoundLocally:!1}},async created(){this.allLabelsLocalCopy=await p.loadAllLabels(),this.messageBus.on("added-series-to-study-"+this.studyId,this.reloadSeriesList)},async mounted(){this.samePatientStudiesCount=(await p.getSamePatientStudies(this.patientMainDicomTags,this.uiOptions.ShowSamePatientStudiesFilter)).length,this.reloadSeriesList(),this.hasLoadedSamePatientsStudiesCount=!0,(this.studiesSourceType==g.REMOTE_DICOM||this.studiesSourceType==g.REMOTE_DICOM_WEB)&&(this.remoteStudyFoundLocally=await p.studyExists(this.studyMainDicomTags.StudyInstanceUID))},computed:{...P({uiOptions:e=>e.configuration.uiOptions,studiesSourceType:e=>e.studies.sourceType,studiesRemoteSource:e=>e.studies.remoteSource}),showLabels(){return this.studiesSourceType==g.LOCAL_ORTHANC},samePatientStudiesLink(){let e=[];for(let t of this.uiOptions.ShowSamePatientStudiesFilter)t in this.patientMainDicomTags&&(["PatientBirthDate"].indexOf(t)>=0?e.push(t+"="+this.patientMainDicomTags[t]):e.push(t+'="'+this.patientMainDicomTags[t]+'"'));return"/filtered-studies?"+e.join("&")},isLocalOrthanc(){return this.studiesSourceType==g.LOCAL_ORTHANC},isRemoteSource(){return this.studiesSourceType==g.REMOTE_DICOM||this.studiesSourceType==g.REMOTE_DICOM_WEB},sameLocalStudyLink(){return"/filtered-studies?StudyInstanceUID="+this.studyMainDicomTags.StudyInstanceUID}},components:{SeriesItem:De,SeriesList:ve,ResourceButtonGroup:K,ResourceDetailText:_e,LabelsEditor:fe},methods:{onDeletedStudy(){this.$emit("deletedStudy",this.studyId)},async reloadSeriesList(){if(this.studiesSourceType==g.LOCAL_ORTHANC)this.studySeries=await p.getStudySeries(this.studyId);else if(this.studiesSourceType==g.REMOTE_DICOM){let e=await p.remoteDicomFind("Series",this.studiesRemoteSource,{StudyInstanceUID:this.studyMainDicomTags.StudyInstanceUID,PatientID:this.patientMainDicomTags.PatientID,NumberOfSeriesRelatedInstances:"",Modality:"",SeriesDescription:"",SeriesNumber:""},!1);this.studySeries=e.map(t=>({ID:t.SeriesInstanceUID,MainDicomTags:t}))}else if(this.studiesSourceType==g.REMOTE_DICOM_WEB){let e=await p.qidoRs("Series",this.studiesRemoteSource,{StudyInstanceUID:this.studyMainDicomTags.StudyInstanceUID,NumberOfSeriesRelatedInstances:"",Modality:"",SeriesDescription:"",SeriesNumber:""},!1);this.studySeries=e.map(t=>({ID:t.SeriesInstanceUID,MainDicomTags:t}))}},async labelsUpdated(){this.$emit("studyLabelsUpdated",this.studyId)}},watch:{}},Pd={class:"table table-responsive table-sm study-details-table"},$d={key:0},Rd={colspan:"100%"},Ud={key:1},Ad={colspan:"100%"},Ed={width:"40%",class:"cut-text"},Fd={width:"40%",class:"cut-text"},Vd={key:0,class:"info-text"},Bd={key:1,class:"info-text"},Nd={key:2,class:"info-text"},xd={key:3,class:"info-text"},Hd={width:"20%",class:"study-button-group"},jd={colspan:"100"};function zd(e,t,a,u,o,i){const r=v("LabelsEditor"),h=v("ResourceDetailText"),m=v("router-link"),y=v("ResourceButtonGroup"),f=v("SeriesList");return n(),l("table",Pd,[i.showLabels&&e.uiOptions.EnableEditLabels?(n(),l("tr",$d,[s("td",Rd,[D(r,{labels:a.labels,title:"labels.study_details_title",studyId:a.studyId,onLabelsUpdated:i.labelsUpdated},null,8,["labels","title","studyId","onLabelsUpdated"])])])):c("",!0),i.showLabels&&!e.uiOptions.EnableEditLabels?(n(),l("tr",Ud,[s("td",Ad,[b(d(e.$t("labels.study_details_title"))+" ",1),(n(!0),l(S,null,T(e.labelsModel,R=>(n(),l("span",{key:R,class:"label badge"},d(R),1))),128))])])):c("",!0),s("tr",null,[s("td",Ed,[s("ul",null,[(n(!0),l(S,null,T(e.uiOptions.StudyMainTags,R=>(n(),w(h,{key:R,tags:a.studyMainDicomTags,tag:R,showIfEmpty:!0},null,8,["tags","tag"]))),128))])]),s("td",Fd,[s("ul",null,[(n(!0),l(S,null,T(e.uiOptions.PatientMainTags,R=>(n(),w(h,{key:R,tags:a.patientMainDicomTags,tag:R,showIfEmpty:!0},null,8,["tags","tag"]))),128))]),i.isLocalOrthanc&&o.hasLoadedSamePatientsStudiesCount&&o.samePatientStudiesCount>1?(n(),l("p",Vd,[b(d(e.$t("this_patient_has_other_studies",{count:o.samePatientStudiesCount}))+". ",1),D(m,{to:i.samePatientStudiesLink},{default:E(()=>[b(d(e.$t("this_patient_has_other_studies_show")),1)]),_:1},8,["to"])])):c("",!0),i.isLocalOrthanc&&o.hasLoadedSamePatientsStudiesCount&&o.samePatientStudiesCount==1?(n(),l("p",Bd,d(e.$t("this_patient_has_no_other_studies")),1)):c("",!0),i.isRemoteSource&&o.hasLoadedSamePatientsStudiesCount&&o.samePatientStudiesCount>1?(n(),l("p",Nd,[b(d(e.$t("this_remote_patient_has_local_studies",{count:o.samePatientStudiesCount}))+" ",1),D(m,{to:i.samePatientStudiesLink},{default:E(()=>[b(d(e.$t("this_patient_has_other_studies_show")),1)]),_:1},8,["to"])])):c("",!0),i.isRemoteSource&&o.remoteStudyFoundLocally?(n(),l("p",xd,[b(d(e.$t("this_study_is_already_stored_locally"))+" ",1),D(m,{to:i.sameLocalStudyLink},{default:E(()=>[b(d(e.$t("this_study_is_already_stored_locally_show")),1)]),_:1},8,["to"])])):c("",!0)]),s("td",Hd,[D(y,{resourceOrthancId:this.studyId,resourceLevel:"study",patientMainDicomTags:this.patientMainDicomTags,studyMainDicomTags:this.studyMainDicomTags,resourceDicomUid:this.studyMainDicomTags.StudyInstanceUID,studySeries:this.studySeries,onDeletedResource:i.onDeletedStudy},null,8,["resourceOrthancId","patientMainDicomTags","studyMainDicomTags","resourceDicomUid","studySeries","onDeletedResource"])])]),s("tr",null,[s("td",jd,[D(f,{studyId:this.studyId,studyMainDicomTags:this.studyMainDicomTags,patientMainDicomTags:this.patientMainDicomTags,studySeries:this.studySeries,onDeletedStudy:i.onDeletedStudy},null,8,["studyId","studyMainDicomTags","patientMainDicomTags","studySeries","onDeletedStudy"])])])])}const Gd=L(Cd,[["render",zd]]),qd={props:["studyId"],emits:["deletedStudy"],data(){return{study:{},loaded:!1,expanded:!1,collapseElement:null,selected:!1}},created(){this.messageBus.on("selected-all",this.onSelectedStudy),this.messageBus.on("unselected-all",this.onUnselectedStudy),this.messageBus.on("added-series-to-study-"+this.studyId,()=>{this.onStudyUpdated(this.studyId)}),this.messageBus.on("deleted-series-from-study-"+this.studyId,()=>{this.onStudyUpdated(this.studyId)})},async mounted(){this.study=this.studies.filter(t=>t.ID==this.studyId)[0],this.loaded=!0,this.seriesIds=this.study.Series,this.selected=this.selectedStudiesIds.indexOf(this.studyId)!=-1,this.$refs["study-collapsible-details"]||console.log("no refs: ",studyResponse),this.$refs["study-collapsible-details"].addEventListener("show.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!0)}),this.$refs["study-collapsible-details"].addEventListener("hide.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!1)});var e=this.$refs["study-collapsible-details"];this.collapseElement=new G.Collapse(e,{toggle:!1});for(const[t,a]of Object.entries(this.$route.query))t==="expand"&&(a==null||a==="study"||a==="series"||a==="instance")&&this.collapseElement.show()},watch:{},methods:{onDeletedStudy(e){this.$emit("deletedStudy",this.studyId)},async onStudyUpdated(e){await this.$store.dispatch("studies/reloadStudy",{studyId:e,study:await p.getStudy(e)}),this.study=this.studies.filter(t=>t.ID==this.studyId)[0]},onSelectedStudy(){this.selected=!0},onUnselectedStudy(){this.selected=!1},async clickedSelect(){await this.$store.dispatch("studies/selectStudy",{studyId:this.studyId,isSelected:!this.selected})}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,studies:e=>e.studies.studies,studiesSourceType:e=>e.studies.sourceType,selectedStudiesIds:e=>e.studies.selectedStudiesIds,allLabels:e=>e.labels.allLabels}),modalitiesInStudyForDisplay(){return this.study.RequestedTags.ModalitiesInStudy?this.study.RequestedTags.ModalitiesInStudy.split("\\").join(","):""},showLabels(){return this.studiesSourceType==g.LOCAL_ORTHANC?!this.expanded&&this.allLabels&&this.allLabels.length>0:!1},hasLabels(){return this.study&&this.study.Labels&&this.study.Labels.length>0},formattedPatientName(){return j.formatPatientName(this.study.PatientMainDicomTags.PatientName)},formattedPatientBirthDate(){return $.formatDateForDisplay(this.study.PatientMainDicomTags.PatientBirthDate,this.uiOptions.DateFormat)},formattedStudyDate(){return $.formatDateForDisplay(this.study.MainDicomTags.StudyDate,this.uiOptions.DateFormat)},seriesCount(){if(this.study.sourceType==g.REMOTE_DICOM||this.study.sourceType==g.REMOTE_DICOM_WEB)return this.study.MainDicomTags.NumberOfStudyRelatedSeries;if(this.study.Series)return this.study.Series.length},instancesCount(){if(this.study.RequestedTags)return this.study.RequestedTags.NumberOfStudyRelatedInstances},seriesAndInstancesCount(){const e=this.seriesCount,t=this.instancesCount;return t?String(e)+"/"+String(t):e},hasPrimaryViewerIcon(){return this.studiesSourceType==g.LOCAL_ORTHANC},primaryViewerUrl(){return j.getPrimaryViewerUrl("study",this.study.ID,this.study.MainDicomTags.StudyInstanceUID)}},components:{SeriesList:ve,StudyDetails:Gd,TokenLinkButton:ye}},Wd=e=>(V("data-v-3a4b3559"),e=e(),B(),e),Jd={class:"form-check"},Kd={key:0,class:"td-viewer-icon"},Yd=["data-bs-target"],Zd=["title"],Qd=["title"],Xd=["title"],eu=["title"],tu=["title"],su=["title"],iu=["title"],au=["title"],ou=["title"],nu=["title"],lu={key:10},ru=Wd(()=>s("td",null,null,-1)),du={colspan:"100%",class:"label-row"},uu={key:0},cu=["id"],hu={key:0,colspan:"100"};function mu(e,t,a,u,o,i){const r=v("TokenLinkButton"),h=v("StudyDetails");return n(),l("tbody",null,[o.loaded?(n(),l("tr",{key:0,class:k({"study-row-collapsed":!o.expanded,"study-row-expanded":o.expanded,"study-row-show-labels":i.showLabels}),onDblclick:t[2]||(t[2]=(...m)=>e.doubleClicked&&e.doubleClicked(...m))},[s("td",null,[s("div",Jd,[I(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=m=>o.selected=m),onClick:t[1]||(t[1]=(...m)=>i.clickedSelect&&i.clickedSelect(...m))},null,512),[[x,o.selected]])])]),i.hasPrimaryViewerIcon?(n(),l("td",Kd,[i.primaryViewerUrl?(n(),w(r,{key:0,level:"study",linkUrl:i.primaryViewerUrl,resourcesOrthancId:o.study.ID,linkType:"icon",iconClass:"bi bi-eye-fill",tokenType:"viewer-instant-link",opensInNewTab:!0},null,8,["linkUrl","resourcesOrthancId"])):c("",!0)])):c("",!0),(n(!0),l(S,null,T(e.uiOptions.StudyListColumns,m=>(n(),l("td",{key:m,class:k(["cut-text",{"text-center":m in["modalities","seriesCount","instancesCount","seriesAndInstancesCount"]}]),"data-bs-toggle":"collapse","data-bs-target":"#study-details-"+this.studyId},[m=="StudyDate"?(n(),l("span",{key:0,"data-bs-toggle":"tooltip",title:o.study.MainDicomTags.StudyDate},d(i.formattedStudyDate),9,Zd)):m=="AccessionNumber"?(n(),l("span",{key:1,"data-bs-toggle":"tooltip",title:o.study.MainDicomTags.AccessionNumber},d(o.study.MainDicomTags.AccessionNumber),9,Qd)):m=="PatientID"?(n(),l("span",{key:2,"data-bs-toggle":"tooltip",title:o.study.PatientMainDicomTags.PatientID},d(o.study.PatientMainDicomTags.PatientID),9,Xd)):m=="PatientName"?(n(),l("span",{key:3,"data-bs-toggle":"tooltip",title:o.study.PatientMainDicomTags.PatientName},d(i.formattedPatientName),9,eu)):m=="PatientBirthDate"?(n(),l("span",{key:4,"data-bs-toggle":"tooltip",title:o.study.PatientMainDicomTags.PatientBirthDate},d(i.formattedPatientBirthDate),9,tu)):m=="StudyDescription"?(n(),l("span",{key:5,"data-bs-toggle":"tooltip",title:o.study.MainDicomTags.StudyDescription},d(o.study.MainDicomTags.StudyDescription),9,su)):m=="modalities"?(n(),l("span",{key:6,"data-bs-toggle":"tooltip",title:i.modalitiesInStudyForDisplay},d(i.modalitiesInStudyForDisplay),9,iu)):m=="seriesCount"?(n(),l("span",{key:7,"data-bs-toggle":"tooltip",title:i.seriesCount},d(i.seriesCount),9,au)):m=="instancesCount"?(n(),l("span",{key:8,"data-bs-toggle":"tooltip",title:i.instancesCount},d(i.instancesCount),9,ou)):m=="seriesAndInstancesCount"?(n(),l("span",{key:9,"data-bs-toggle":"tooltip",title:i.seriesAndInstancesCount},d(i.seriesAndInstancesCount),9,nu)):(n(),l("span",lu,d(o.study.MainDicomTags[m]),1))],10,Yd))),128))],34)):c("",!0),I(s("tr",null,[ru,s("td",du,[(n(!0),l(S,null,T(o.study.Labels,m=>(n(),l("span",{key:m,class:"label badge"},d(m),1))),128)),i.hasLabels?c("",!0):(n(),l("span",uu," "))])],512),[[Q,i.showLabels]]),I(s("tr",{class:k(["collapse",{"study-details-collapsed":!o.expanded,"study-details-expanded":o.expanded}]),id:"study-details-"+this.studyId,ref:"study-collapsible-details"},[o.loaded&&o.expanded?(n(),l("td",hu,[D(h,{studyId:this.studyId,studyMainDicomTags:this.study.MainDicomTags,patientMainDicomTags:this.study.PatientMainDicomTags,labels:this.study.Labels,onDeletedStudy:i.onDeletedStudy,onStudyLabelsUpdated:i.onStudyUpdated},null,8,["studyId","studyMainDicomTags","patientMainDicomTags","labels","onDeletedStudy","onStudyLabelsUpdated"])])):c("",!0)],10,cu),[[Q,o.loaded]])])}const pu=L(qd,[["render",mu],["__scopeId","data-v-3a4b3559"]]);document._allowedFilters=["StudyDate","StudyTime","AccessionNumber","PatientID","PatientName","PatientBirthDate","StudyInstanceUID","StudyID","StudyDescription","ModalitiesInStudy","labels"];document._studyColumns={StudyDate:{width:"7%"},AccessionNumber:{width:"11%",placeholder:"1234"},PatientID:{width:"11%",placeholder:"1234"},PatientName:{width:"15%",placeholder:"John^Doe"},PatientBirthDate:{width:"7%"},StudyDescription:{width:"25%",placeholder:"Chest"},modalities:{width:"6%"},seriesCount:{width:"4%"},instancesCount:{width:"4%"},seriesAndInstancesCount:{width:"7%"},undefined:{width:"10%"}};const gu={props:[],emits:["deletedStudy"],data(){return{filterStudyDate:"",filterStudyDateForDatePicker:"",filterPatientBirthDate:"",filterPatientBirthDateForDatePicker:"",filterModalities:{},filterGenericTags:{},oldFilterGenericTags:{},filterLabels:[],allModalities:!0,noneModalities:!1,updatingFilterUi:!1,updatingRouteWithoutReload:!1,initializingModalityFilter:!1,searchTimerHandler:{},columns:document._studyColumns,datePickerPresetRanges:document._datePickerPresetRanges,allSelected:!1,isPartialSelected:!1,latestStudiesIds:[],shouldStopLoadingLatestStudies:!1,isLoadingLatestStudies:!1,isDisplayingLatestStudies:!1,sourceType:g.LOCAL_ORTHANC,remoteSource:null}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,isConfigurationLoaded:e=>e.configuration.loaded,studiesIds:e=>e.studies.studiesIds,selectedStudiesIds:e=>e.studies.selectedStudiesIds,isSearching:e=>e.studies.isSearching,statistics:e=>e.studies.statistics}),...Re(["studies/isFilterEmpty"]),notShowingAllResults(){return this.sourceType==g.LOCAL_ORTHANC?this.studiesIds.length>=this.statistics.CountStudies?!1:this.studiesIds.length==this.uiOptions.MaxStudiesDisplayed:!1},isDarkMode(){let e=document.documentElement.getAttribute("data-bs-theme");return e=getComputedStyle(document.documentElement).getPropertyValue("--bootstrap-theme"),e=="dark"},isRemoteDicom(){return this.sourceType==g.REMOTE_DICOM},isRemoteDicomWeb(){return this.sourceType==g.REMOTE_DICOM_WEB},isSearchAsYouTypeEnabled(){return this.sourceType==g.LOCAL_ORTHANC?this.uiOptions.StudyListSearchMode=="search-as-you-type":!1},isSearchButtonEnabled(){return this.sourceType==g.LOCAL_ORTHANC?this.uiOptions.StudyListSearchMode=="search-button":!0},showEmptyStudyListIfNoSearch(){return this.sourceType==g.LOCAL_ORTHANC?this.uiOptions.StudyListContentIfNoSearch=="empty":!0},showLastReceivedIfNoSearch(){return this.sourceType==g.LOCAL_ORTHANC?this.uiOptions.StudyListContentIfNoSearch=="most-recents":!1},isStudyListEmpty(){return this.studiesIds.length==0},datePickerFormat(){return this.uiOptions.DateFormat},hasPrimaryViewerIcon(){return this.sourceType==g.LOCAL_ORTHANC}},watch:{$route:async function(){this.updatingRouteWithoutReload||this.updateFilterFromRoute(this.$route.query)},isConfigurationLoaded(e,t){this.initModalityFilter();for(const a of this.uiOptions.StudyListColumns)["StudyDate","PatientBirthDate","modalities","seriesCount","instancesCount","seriesAndInstancesCount"].indexOf(a)==-1&&(this.filterGenericTags[a]="");this.updateFilterFromRoute(this.$route.query)},filterLabels:{handler(e,t){!this.updatingFilterUi&&!this.initializingModalityFilter&&this.updateFilter("labels",this.filterLabels,null)},deep:!0},filterModalities:{handler(e,t){!this.updatingFilterUi&&!this.initializingModalityFilter&&(this.isSearchAsYouTypeEnabled?this.updateFilter("ModalitiesInStudy",this.getModalityFilter(),null):this.getModalityFilter())},deep:!0},filterGenericTags:{handler(e,t){for(const[a,u]of Object.entries(this.filterGenericTags)){let o=null;a in this.oldFilterGenericTags&&(o=this.oldFilterGenericTags[a]),this.updateFilter(a,u,o),this.oldFilterGenericTags[a]=u}},deep:!0},filterStudyDate(e,t){this.updateFilter("StudyDate",e,t)},filterStudyDateForDatePicker(e,t){let a=$.dicomDateFromDatePicker(e);a==null&&(a=""),this.filterStudyDate=a},filterPatientBirthDate(e,t){this.updateFilter("PatientBirthDate",e,t)},filterPatientBirthDateForDatePicker(e,t){let a=$.dicomDateFromDatePicker(e);a==null&&(a=""),this.filterPatientBirthDate=a},selectedStudiesIds:{handler(e,t){this.updateSelectAll()},deep:!0}},async created(){this.messageBus.on("language-changed",this.translateDatePicker),this.messageBus.on("filter-label-changed",this.updateLabelsFilter)},async mounted(){this.updateSelectAll()},methods:{updateSelectAll(){this.selectedStudiesIds.length==0?(this.allSelected=!1,this.isPartialSelected=!1):this.selectedStudiesIds.length==this.studiesIds.length?(this.allSelected=!0,this.isPartialSelected=!1):(this.allSelected="",this.isPartialSelected=!0)},clickSelectAll(){this.allSelected==""||!this.allSelected?(this.$store.dispatch("studies/selectAllStudies",{isSelected:!0}),this.messageBus.emit("selected-all")):(this.$store.dispatch("studies/selectAllStudies",{isSelected:!1}),this.messageBus.emit("unselected-all"))},translateDatePicker(e){for(let t in document._datePickerPresetRanges)document._datePickerPresetRanges[t].label=this.$t(document._datePickerPresetRanges[t].tLabel)},columnTitle(e){return e=="seriesCount"?this.$i18n.t("series_count_header"):e=="instancesCount"?this.$i18n.t("instances_count_header"):e=="seriesAndInstancesCount"?this.$i18n.t("series_and_instances_count_header"):e=="modalities"?z(this.$i18n.t,this.$i18n.te,"ModalitiesInStudy"):z(this.$i18n.t,this.$i18n.te,e)},columnTooltip(e){return this.columnTitle(e)},columnWidth(e){return e in this.columns?this.columns[e].width:this.columns.undefined.width},clearModalityFilter(){for(const e of this.uiOptions.ModalitiesFilter)this.filterModalities[e]=!0},updateLabelsFilter(e){this.filterLabels=[e]},initModalityFilter(){this.initializingModalityFilter=!0,this.filterModalities={};for(const e of this.uiOptions.ModalitiesFilter)this.filterModalities[e]=!0;this.initializingModalityFilter=!1},getModalityFilter(){if(this.filterModalities===void 0)return"";let e=!0,t=[];for(const[a,u]of Object.entries(this.filterModalities))e&=u,u&&t.push(a);return e?(this.allModalities=!0,this.noneModalities=!1,""):t.length==0?(this.allModalities=!1,this.noneModalities=!0,"NONE"):(this.allModalities=!1,this.noneModalities=!1,t.join("\\"))},updateFilter(e,t,a){if(!this.updatingFilterUi){if(e=="labels"&&t!=a){this._updateLabelsFilter(t);return}if(this.isSearchAsYouTypeEnabled){if(e=="ModalitiesInStudy"&&a==null){this._updateFilter(e,t);return}t.length>=this.uiOptions.StudyListSearchAsYouTypeMinChars?(this.searchTimerHandler[e]&&clearTimeout(this.searchTimerHandler[e]),this.searchTimerHandler[e]=setTimeout(()=>{this._updateFilter(e,t)},this.uiOptions.StudyListSearchAsYouTypeDelay)):a&&t.length<a.length&&a.length>=this.uiOptions.StudyListSearchAsYouTypeMinChars&&(this.searchTimerHandler[e]=setTimeout(()=>{this._updateFilter(e,"")},this.uiOptions.StudyListSearchAsYouTypeDelay))}}},clipFilter(e,t){return this.isFilterLongEnough(e,t)?t:""},getMinimalFilterLength(e){if(["AccessionNumber","PatientName","PatientID","StudyDescription"].indexOf(e)!=-1){if(this.isSearchAsYouTypeEnabled)return this.uiOptions.StudyListSearchAsYouTypeMinChars}else if(["PatientBirthDate","StudyDate"].indexOf(e)!=-1)return 8;return 0},isFilterLongEnough(e,t){return t.length>=this.getMinimalFilterLength(e)},getFilterClass(e){const t=this.getFilterValue(e);return t!=null&&t.length>0&&!this.isFilterLongEnough(e,t)?"is-invalid-filter":""},hasFilter(e){return["seriesCount","instancesCount","seriesAndInstancesCount"].indexOf(e)==-1},getFilterPlaceholder(e){return e in this.columns&&this.columns[e].placeholder?this.columns[e].placeholder:"search-text"},getFilterValue(e){if(!this.isConfigurationLoaded)return null;if(e=="StudyDate")return this.filterStudyDate;if(e=="PatientBirthDate")return this.filterPatientBirthDate;if(e=="ModalitiesInStudy")console.error("getFilterValue ModalitiesInStudy");else return this.filterGenericTags[e]},_updateLabelsFilter(e){this.$store.dispatch("studies/updateLabelsFilterNoReload",{labels:e}),this.updateUrlNoReload(),this.reloadStudyList()},_updateFilter(e,t){this.searchTimerHandler[e]=null,this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:e,value:t}),this.updateUrlNoReload(),this.reloadStudyList()},async updateFilterFromRoute(e){this.updatingFilterUi=!0,await this.$store.dispatch("studies/clearStudies"),await this.$store.dispatch("studies/clearFilterNoReload");var t={};"source-type"in e&&"remote-source"in e?(e["source-type"].toLowerCase()==="dicom"?this.sourceType=g.REMOTE_DICOM:e["source-type"].toLowerCase()==="dicom-web"&&(this.sourceType=g.REMOTE_DICOM_WEB),this.remoteSource=e["remote-source"]):(this.sourceType=g.LOCAL_ORTHANC,this.remoteSource=null),await this.$store.dispatch("studies/updateSource",{"source-type":this.sourceType,"remote-source":this.remoteSource});for(const[a,u]of Object.entries(e))if(a=="labels"){const o=u.split(",");t[a]=o,await this.$store.dispatch("studies/updateLabelsFilterNoReload",{labels:o})}else a[0]===a[0].toUpperCase()&&(t[a]=u,await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:a,value:u}));await this.updateFilterForm(t),await this.reloadStudyList(),this.updatingFilterUi=!1},updateFilterForm(e){this.emptyFilterForm();for(const[t,a]of Object.entries(e))if(t=="labels")this.filterLabels=a;else if(t=="StudyDate")this.filterStudyDate=a,this.filterStudyDateForDatePicker=$.parseDateForDatePicker(a);else if(t=="PatientBirthDate")this.filterPatientBirthDate=a,this.filterPatientBirthDateForDatePicker=$.parseDateForDatePicker(a);else if(t=="ModalitiesInStudy"){const u=a.split("\\");if(u.length>0){let o=!0,i=!0;for(const r of this.uiOptions.ModalitiesFilter){const h=u.indexOf(r)!=-1;this.filterModalities[r]=h,o&=h,i&=!h}this.allModalities=o,this.noneModalities=i}}else this.filterGenericTags[t]=a},emptyFilterForm(){this.filterStudyDate="",this.filterStudyDateForDatePicker=null,this.filterPatientBirthDate="",this.filterPatientBirthDateForDatePicker=null,this.filterGenericTags={};for(const e of this.uiOptions.StudyListColumns)["StudyDate","PatientBirthDate","modalities","seriesCount","instancesCount","seriesAndInstancesCount"].indexOf(e)==-1&&(this.filterGenericTags[e]="");this.filterLabels=[],this.clearModalityFilter()},isFilteringOnlyOnLabels(){let e=!1;for(const t of this.uiOptions.StudyListColumns)["StudyDate","PatientBirthDate","modalities","seriesCount","instancesCount","seriesAndInstancesCount"].indexOf(t)==-1&&this.filterGenericTags[t]&&this.filterGenericTags[t]!=""&&(e=!0);return this.filterStudyDate==""&&this.filterPatientBirthDate==""&&!e&&this.filterLabels.length>0},async search(){if(this.isSearching)await this.$store.dispatch("studies/cancelSearch");else{{await this.$store.dispatch("studies/clearFilterNoReload");for(const e of this.uiOptions.StudyListColumns)["modalities","seriesCount","instancesCount","seriesAndInstancesCount"].indexOf(e)==-1&&await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:e,value:this.getFilterValue(e)});await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:"ModalitiesInStudy",value:this.getModalityFilter()}),await this.$store.dispatch("studies/updateLabelsFilterNoReload",{labels:this.filterLabels})}await this.updateUrlNoReload(),await this.reloadStudyList()}},async clearFilters(){await this.clearFiltersUi(),await this.$store.dispatch("studies/clearFilterNoReload"),this.reloadStudyList()},async clearFiltersUi(){this.updatingFilterUi=!0,this.emptyFilterForm(),this.updateUrl(),this.updatingFilterUi=!1},async toggleModalityFilter(e){const t=e.srcElement.getAttribute("data-value");let a=!0;t=="all"?a=!0:t=="none"&&(a=!1);for(const[u,o]of Object.entries(this.filterModalities))this.filterModalities[u]=a;this.getModalityFilter()},modalityFilterClicked(e){e.stopPropagation()},closeModalityFilter(e){pe("#dropdown-modalities-button").click(),e.preventDefault(),e.stopPropagation()},async updateUrlNoReload(){this.updatingRouteWithoutReload=!0,await this.updateUrl(),this.updatingRouteWithoutReload=!1},async updateUrl(){let e=[];this.sourceType!=g.LOCAL_ORTHANC&&(this.sourceType==g.REMOTE_DICOM?e.push("source-type=dicom"):this.sourceType==g.REMOTE_DICOM_WEB&&e.push("source-type=dicom-web"),e.push("remote-source="+this.remoteSource)),this.clipFilter("StudyDate",this.filterStudyDate)&&e.push("StudyDate="+this.filterStudyDate),this.clipFilter("PatientBirthDate",this.filterPatientBirthDate)&&e.push("PatientBirthDate="+this.filterPatientBirthDate),this.getModalityFilter()&&e.push("ModalitiesInStudy="+this.getModalityFilter());for(const[a,u]of Object.entries(this.filterGenericTags))this.clipFilter(a,u)&&e.push(a+"="+u);this.filterLabels.length>0&&e.push("labels="+this.filterLabels.join(","));let t="";e.length>0&&(t="/filtered-studies?"+e.join("&")),await this.$router.replace(t)},async reloadStudyList(){const e=this.uiOptions.StudyListContentIfNoSearch=="most-recents"&&this.isFilteringOnlyOnLabels();if(this.sourceType==g.LOCAL_ORTHANC&&(this["studies/isFilterEmpty"]||e)){if(await this.$store.dispatch("studies/clearStudies"),this.uiOptions.StudyListContentIfNoSearch=="empty")return;if(this.uiOptions.StudyListContentIfNoSearch=="most-recents"){this.isLoadingLatestStudies&&(this.shouldStopLoadingLatestStudies=!0,this.isLoadingLatestStudies=!1,this.isDisplayingLatestStudies=!0);const t=await p.getLastChangeId();await this.$store.dispatch("studies/clearStudies"),this.latestStudiesIds=new Set,this.shouldStopLoadingLatestStudies=!1,this.isLoadingLatestStudies=!0,this.isDisplayingLatestStudies=!1,this.loadStudiesFromChange(Math.max(0,t-1e3),1e3)}}else this.shouldStopLoadingLatestStudies=!0,this.isLoadingLatestStudies=!1,this.isDisplayingLatestStudies=!1,await this.$store.dispatch("studies/reloadFilteredStudies")},async loadStudiesFromChange(e,t){let a=await p.getChanges(e,t);for(let u of a.Changes.reverse())if((u.ChangeType=="NewStudy"||u.ChangeType=="StableStudy")&&!this.latestStudiesIds.has(u.ID)){if(this.shouldStopLoadingLatestStudies)return;try{const o=await p.getStudy(u.ID);if((this.filterLabels.length==0||this.filterLabels.filter(i=>o.Labels.includes(i)).length>0)&&this.$store.dispatch("studies/addStudy",{studyId:u.ID,study:o,reloadStats:!1}),this.latestStudiesIds.add(u.ID),this.latestStudiesIds.size==this.uiOptions.MaxStudiesDisplayed){this.isLoadingLatestStudies=!1,this.isDisplayingLatestStudies=!0;return}}catch{console.warn("Unable to load study - not authorized ?")}}this.shouldStopLoadingLatestStudies?(this.isLoadingLatestStudies=!1,this.isDisplayingLatestStudies=!0):e>0&&this.latestStudiesIds.size<this.statistics.CountStudies?setTimeout(()=>{this.loadStudiesFromChange(Math.max(0,Math.max(0,e-1e3)),1e3)},1):(this.isLoadingLatestStudies=!1,this.isDisplayingLatestStudies=!0)},onDeletedStudy(e){this.$store.dispatch("studies/deleteStudy",{studyId:e})}},components:{StudyItem:pu,ResourceButtonGroup:K}},bu={key:0,class:"remote-browsing-warning"},yu=["innerHTML"],fu=["innerHTML"],_u={class:"table table-responsive table-sm study-table table-borderless"},Du={class:"study-table-header"},vu=s("th",{width:"2%",scope:"col"},null,-1),Su={key:0,width:"3%",scope:"col"},Tu=["title","width"],Iu={scope:"col"},wu=s("i",{class:"fa-regular fa-circle-xmark"},null,-1),ku=[wu],Lu={key:0,scope:"col"},Mu={key:0},Ou=["onClick"],Cu={key:1,class:"dropdown"},Pu=s("button",{type:"button",class:"btn btn-default btn-sm filter-button dropdown-toggle","data-bs-toggle":"dropdown",id:"dropdown-modalities-button","aria-expanded":"false"},[s("span",{class:"fa fa-list"}),b(" "),s("span",{class:"caret"})],-1),$u={class:"dropdown-item"},Ru={class:"dropdown-item"},Uu=s("li",null,[s("hr",{class:"dropdown-divider"})],-1),Au={class:"dropdown-item"},Eu=["data-value","onUpdate:modelValue"],Fu={key:2},Vu=["onUpdate:modelValue","placeholder"],Bu={class:"study-table-actions"},Nu={width:"2%",scope:"col"},xu={class:"form-check",style:{"margin-left":"1.9rem"}},Hu=["indeterminate"],ju={width:"98%",colspan:"10",scope:"col"},zu={class:"container"},Gu={class:"row g-1"},qu={class:"col-4 study-list-bulk-buttons"},Wu={class:"col-6"},Ju={key:0,class:"alert alert-secondary study-list-alert",role:"alert"},Ku={key:0,class:"spinner-border spinner-border-sm alert-icon",role:"status","aria-hidden":"true"},Yu={key:1,class:"alert alert-secondary study-list-alert",role:"alert"},Zu=s("i",{class:"bi bi-exclamation-triangle-fill alert-icon"},null,-1),Qu={key:2,class:"alert alert-danger study-list-alert",role:"alert"},Xu=s("i",{class:"bi bi-exclamation-triangle-fill alert-icon"},null,-1),ec={key:3,class:"alert alert-warning study-list-alert",role:"alert"},tc=s("i",{class:"bi bi-exclamation-triangle-fill alert-icon"},null,-1),sc={key:4,class:"alert alert-warning study-list-alert",role:"alert"},ic=s("i",{class:"bi bi-exclamation-triangle-fill alert-icon"},null,-1),ac={key:5,class:"alert alert-secondary study-list-alert",role:"alert"},oc={key:0,class:"spinner-border spinner-border-sm alert-icon",role:"status","aria-hidden":"true"},nc={class:"col-2"},lc={key:0,class:"fa-solid fa-magnifying-glass"},rc={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function dc(e,t,a,u,o,i){const r=v("Datepicker"),h=v("ResourceButtonGroup"),m=v("StudyItem");return n(),l("div",null,[i.isRemoteDicom||i.isRemoteDicomWeb?(n(),l("div",bu,[s("div",null,[i.isRemoteDicom?(n(),l("p",{key:0,innerHTML:e.$t("remote_dicom_browsing",{source:o.remoteSource})},null,8,yu)):c("",!0),i.isRemoteDicomWeb?(n(),l("p",{key:1,innerHTML:e.$t("remote_dicom_web_browsing",{source:o.remoteSource})},null,8,fu)):c("",!0)])])):c("",!0),s("table",_u,[s("thead",Du,[vu,i.hasPrimaryViewerIcon?(n(),l("th",Su)):c("",!0),(n(!0),l(S,null,T(e.uiOptions.StudyListColumns,y=>(n(),l("th",{key:y,"data-bs-toggle":"tooltip",title:i.columnTooltip(y),width:i.columnWidth(y),class:"study-table-title"},d(i.columnTitle(y)),9,Tu))),128))]),s("thead",{class:"study-table-filters",onKeyup:t[9]||(t[9]=Oe((...y)=>i.search&&i.search(...y),["enter"]))},[s("th",Iu,[s("button",{onClick:t[0]||(t[0]=(...y)=>i.clearFilters&&i.clearFilters(...y)),type:"button",class:"form-control study-list-filter btn filter-button","data-bs-toggle":"tooltip",title:"Clear filter"},ku)]),i.hasPrimaryViewerIcon?(n(),l("th",Lu)):c("",!0),(n(!0),l(S,null,T(e.uiOptions.StudyListColumns,y=>(n(),l("th",{key:y},[y=="StudyDate"?(n(),l("div",Mu,[y=="StudyDate"?(n(),w(r,{key:0,modelValue:o.filterStudyDateForDatePicker,"onUpdate:modelValue":t[1]||(t[1]=f=>o.filterStudyDateForDatePicker=f),"enable-time-picker":!1,range:"","preset-dates":o.datePickerPresetRanges,format:i.datePickerFormat,"preview-format":i.datePickerFormat,"text-input":"","arrow-navigation":"","highlight-week-days":[0,6],dark:i.isDarkMode},{yearly:E(({label:f,range:R,presetDate:_})=>[s("span",{onClick:M=>_(R)},d(f),9,Ou)]),_:1},8,["modelValue","preset-dates","format","preview-format","dark"])):c("",!0)])):y=="modalities"?(n(),l("div",Cu,[Pu,s("ul",{class:"dropdown-menu","aria-labelledby":"dropdown-modalities-button",onClick:t[7]||(t[7]=(...f)=>i.modalityFilterClicked&&i.modalityFilterClicked(...f)),id:"modality-filter-dropdown"},[s("li",null,[s("label",$u,[I(s("input",{type:"checkbox","data-value":"all",onClick:t[2]||(t[2]=(...f)=>i.toggleModalityFilter&&i.toggleModalityFilter(...f)),"onUpdate:modelValue":t[3]||(t[3]=f=>o.allModalities=f)},null,512),[[x,o.allModalities]]),b(" "+d(e.$t("all_modalities")),1)])]),s("li",null,[s("label",Ru,[I(s("input",{type:"checkbox","data-value":"none",onClick:t[4]||(t[4]=(...f)=>i.toggleModalityFilter&&i.toggleModalityFilter(...f)),"onUpdate:modelValue":t[5]||(t[5]=f=>o.noneModalities=f)},null,512),[[x,o.noneModalities]]),b(" "+d(e.$t("no_modalities")),1)])]),Uu,(n(!0),l(S,null,T(e.uiOptions.ModalitiesFilter,f=>(n(),l("li",{key:f},[s("label",Au,[I(s("input",{type:"checkbox","data-value":f,"onUpdate:modelValue":R=>o.filterModalities[f]=R},null,8,Eu),[[x,o.filterModalities[f]]]),b(" "+d(f),1)])]))),128)),s("li",null,[s("button",{class:"btn btn-primary mx-5",onClick:t[6]||(t[6]=(...f)=>i.closeModalityFilter&&i.closeModalityFilter(...f))},d(e.$t("close")),1)])])])):y=="PatientBirthDate"?(n(),l("div",Fu,[D(r,{modelValue:o.filterPatientBirthDateForDatePicker,"onUpdate:modelValue":t[8]||(t[8]=f=>o.filterPatientBirthDateForDatePicker=f),"enable-time-picker":!1,range:"",format:i.datePickerFormat,"preview-format":i.datePickerFormat,"text-input":"","arrow-navigation":"","highlight-week-days":[0,6],dark:i.isDarkMode},null,8,["modelValue","format","preview-format","dark"])])):i.hasFilter(y)?I((n(),l("input",{key:3,type:"text",class:k(["form-control study-list-filter",i.getFilterClass(y)]),"onUpdate:modelValue":f=>this.filterGenericTags[y]=f,placeholder:i.getFilterPlaceholder(y)},null,10,Vu)),[[C,this.filterGenericTags[y]]]):c("",!0)]))),128))],32),s("thead",Bu,[s("th",Nu,[s("div",xu,[I(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=y=>o.allSelected=y),indeterminate:o.isPartialSelected,onClick:t[11]||(t[11]=(...y)=>i.clickSelectAll&&i.clickSelectAll(...y))},null,8,Hu),[[x,o.allSelected]])])]),s("th",ju,[s("div",zu,[s("div",Gu,[s("div",qu,[D(h,{resourceLevel:"bulk"})]),s("div",Wu,[!e.isSearching&&o.isLoadingLatestStudies?(n(),l("div",Ju,[o.isLoadingLatestStudies?(n(),l("span",Ku)):c("",!0),b(d(e.$t("loading_latest_studies")),1)])):!e.isSearching&&o.isDisplayingLatestStudies?(n(),l("div",Yu,[Zu,b(d(e.$t("displaying_latest_studies")),1)])):!e.isSearching&&i.notShowingAllResults?(n(),l("div",Qu,[Xu,b(" "+d(e.$t("not_showing_all_results"))+" ! ! ",1)])):!e.isSearching&&i.showEmptyStudyListIfNoSearch&&this["studies/isFilterEmpty"]?(n(),l("div",ec,[tc,b(" "+d(e.$t("enter_search")),1)])):!e.isSearching&&i.isStudyListEmpty?(n(),l("div",sc,[ic,b(" "+d(e.$t("no_result_found")),1)])):e.isSearching?(n(),l("div",ac,[e.isSearching?(n(),l("span",oc)):c("",!0),b(d(e.$t("searching")),1)])):c("",!0)]),s("div",nc,[i.isSearchButtonEnabled?(n(),l("button",{key:0,onClick:t[12]||(t[12]=(...y)=>i.search&&i.search(...y)),type:"submit",class:k(["form-control study-list-filter btn filter-button btn-secondary search-button",{"is-searching":e.isSearching,"is-not-searching":!e.isSearching}]),"data-bs-toggle":"tooltip",title:"Search"},[e.isSearching?c("",!0):(n(),l("i",lc)),e.isSearching?(n(),l("span",rc)):c("",!0)],2)):c("",!0)])])])])]),(n(!0),l(S,null,T(e.studiesIds,y=>(n(),w(m,{key:y,studyId:y,onDeletedStudy:i.onDeletedStudy},null,8,["studyId","onDeletedStudy"]))),128))])])}const ue=L(gu,[["render",dc]]),uc={props:["report"],emits:["deletedUploadReport"],data(){return{}},mounted(){},computed:{...P({uiOptions:e=>e.configuration.uiOptions}),pctSuccess(){return 100*this.report.successFilesCount/this.report.filesCount},pctSkipped(){return 100*this.report.skippedFilesCount/this.report.filesCount},pctFailed(){return 100*this.report.failedFilesCount/this.report.filesCount}},methods:{close(e){this.$emit("deletedUploadReport",e)},getStudyLine(e,t,a){let u=[];for(let o of this.uiOptions.UploadReportTags)o in t&&t[o]&&t[o].length>0?u.push(t[o]):o in a&&a[o]&&a[o].length>0&&u.push(a[o]);return u.length==0&&u.push(e.slice(0,20)+"..."),u.slice(0,this.uiOptions.UploadReportMaxTags).join(" - ")}},components:{Modal:ee}},cc={class:"card border-secondary job-card"},hc={class:"card-header jobs-header"},mc={class:"progress",style:{width:"90%"}},pc=["data-bs-target"],gc={class:"table table-sm"},bc={width:"50%"},yc={width:"50%"},fc={class:"text-right"},_c={class:"card-body text-secondary jobs-body"},Dc={class:"card-text"},vc={class:"upload-details"},Sc=s("br",null,null,-1),Tc=s("br",null,null,-1);function Ic(e,t,a,u,o,i){const r=v("Modal"),h=v("router-link");return n(),l("div",cc,[s("div",hc,[b(d(e.$t("upload"))+" "+d(a.report.filesCount)+" "+d(e.$t("files"))+" ",1),s("button",{type:"button",class:"btn-close job-card-close","aria-label":"Close",onClick:t[0]||(t[0]=m=>i.close(a.report.id))}),s("div",mc,[s("div",{class:"progress-bar bg-success",role:"progressbar",style:F("width: "+this.pctSuccess+"%")},null,4),s("div",{class:"progress-bar bg-secondary",role:"progressbar",style:F("width: "+this.pctSkipped+"%")},null,4),s("div",{class:"progress-bar bg-danger",role:"progressbar",style:F("width: "+this.pctFailed+"%")},null,4)]),I(s("div",null,[s("button",{class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#upload-errors-modal-"+this.report.id},d(e.$t("show_errors")),9,pc),D(r,{id:"upload-errors-modal-"+this.report.id,headerText:"Upload error report",okText:"Close",onOk:t[1]||(t[1]=m=>i.close(m))},{modalBody:E(()=>[s("table",gc,[s("thead",null,[s("tr",null,[s("th",bc,d(e.$t("file")),1),s("th",yc,d(e.$t("error")),1)])]),s("tbody",null,[(n(!0),l(S,null,T(a.report.errorMessages,(m,y)=>(n(),l("tr",{key:m},[s("td",null,d(y),1),s("td",fc,d(m),1)]))),128))])])]),_:1},8,["id"])],512),[[Q,Object.keys(a.report.errorMessages).length>0]])]),s("div",_c,[s("p",Dc,[s("span",vc,d(e.$t("uploaded_studies"))+":",1),Sc,(n(!0),l(S,null,T(a.report.uploadedStudies,(m,y)=>(n(),l("span",{key:y},[D(h,{to:"/filtered-studies?StudyInstanceUID="+m.MainDicomTags.StudyInstanceUID+"&expand=study",class:"upload-details-study"},{default:E(()=>[b(d(this.getStudyLine(y,m.MainDicomTags,m.PatientMainDicomTags)),1)]),_:2},1032,["to"]),Tc]))),128))])])])}const wc=L(uc,[["render",Ic]]);async function kc(e){let t=[],a=[];for(let u=0;u<e.length;u++)a.push(e[u].webkitGetAsEntry());for(;a.length>0;){let u=a.shift();if(u.isFile)t.push(u);else if(u.isDirectory){let o=u.createReader();a.push(...await Oc(o))}}return t}async function Lc(e){try{return await new Promise((t,a)=>e.file(t,a))}catch(t){console.error("getFileFromFileEntry",t)}}async function Mc(e){let t=await kc(e),a=[];for(let u of t)a.push(await Lc(u));return a}async function Oc(e){let t=[],a=await ce(e);for(;a.length>0;)t.push(...a),a=await ce(e);return t}async function ce(e){try{return await new Promise((t,a)=>{e.readEntries(t,a)})}catch(t){console.error("readEntriesPromise",t)}}function Cc(e){return new Promise((t,a)=>{let u=new FileReader;u.onload=()=>{t(u.result)},u.onerror=a,u.readAsArrayBuffer(e)})}const Pc={props:[],data(){return{uploadCounter:0,lastUploadReports:{}}},mounted(){X(document.querySelector("#filesUpload"),this.uppieUploadHandler),X(document.querySelector("#foldersUpload"),this.uppieUploadHandler)},methods:{onDrop(e){e.preventDefault(),Mc(e.dataTransfer.items).then(t=>{this.uploadFiles(t)})},onDragOver(e){e.preventDefault()},onDeletedUploadReport(e){delete this.lastUploadReports[e]},async uploadedFile(e,t){let a=t.ParentStudy;if(!this.lastUploadReports[e].uploadedStudiesIds.has(a)){this.lastUploadReports[e].uploadedStudiesIds.add(a);const u=await p.getStudy(a);this.lastUploadReports[e].uploadedStudies[a]=u,this.$store.dispatch("studies/addStudy",{study:u,studyId:a,reloadStats:!0})}},async uploadFiles(e){let t=this.uploadCounter++;this.lastUploadReports[t]={id:t,filesCount:e.length,successFilesCount:0,failedFilesCount:0,skippedFilesCount:0,uploadedStudiesIds:new Set,uploadedStudies:{},errorMessages:{}};for(let a of e){let u=a.webkitRelativePath||a.name;if(a.name=="DICOMDIR"){console.log("upload: skipping DICOMDIR file"),this.lastUploadReports[t].skippedFilesCount++,this.lastUploadReports[t].errorMessages[u]="skipped";continue}const o=await Cc(a);try{const i=await p.uploadFile(o);if(Array.isArray(i))if(i.length>0){this.lastUploadReports[t].successFilesCount++;for(let r of i)this.uploadedFile(t,r)}else this.lastUploadReports[t].failedFilesCount++,this.lastUploadReports[t].errorMessages[u]="no valid DICOM files found in zip";else this.lastUploadReports[t].successFilesCount++,this.uploadedFile(t,i)}catch(i){console.error("uploadFiles",i);let r="error "+i.response.status;i.response.status>=400&&i.response.status<500&&(r=i.response.data.Message),this.lastUploadReports[t].failedFilesCount++,this.lastUploadReports[t].errorMessages[u]=r}}},async uppieUploadHandler(e,t,a){await this.uploadFiles(e.target.files),document.getElementById("filesUpload").value=null,document.getElementById("foldersUpload").value=null}},components:{UploadReport:wc}},Se=e=>(V("data-v-af810a9f"),e=e(),B(),e),$c={class:"mb-3"},Rc={class:"mb-3"},Uc={class:"btn btn-primary btn-file"},Ac=Se(()=>s("input",{type:"file",style:{display:"none"},id:"foldersUpload",required:"",multiple:"",directory:"",webkitdirectory:"",allowdirs:""},null,-1)),Ec={class:"mb-3"},Fc={class:"btn btn-primary btn-file"},Vc=Se(()=>s("input",{type:"file",style:{display:"none"},id:"filesUpload",required:"",multiple:""},null,-1)),Bc={class:"upload-report-list"};function Nc(e,t,a,u,o,i){const r=v("UploadReport");return n(),l("div",null,[s("div",{class:"upload-handler-drop-zone",onDrop:t[0]||(t[0]=(...h)=>this.onDrop&&this.onDrop(...h)),onDragover:t[1]||(t[1]=(...h)=>this.onDragOver&&this.onDragOver(...h))},[s("div",$c,d(e.$t("drop_files")),1),s("div",Rc,[s("label",Uc,[b(d(e.$t("select_folder"))+" ",1),Ac])]),s("div",Ec,[s("label",Fc,[b(d(e.$t("select_files"))+" ",1),Vc])])],32),s("div",Bc,[(n(!0),l(S,null,T(o.lastUploadReports,(h,m)=>(n(),w(r,{report:h,key:m,onDeletedUploadReport:i.onDeletedUploadReport},null,8,["report","onDeletedUploadReport"]))),128))])])}const xc=L(Pc,[["render",Nc],["__scopeId","data-v-af810a9f"]]),Hc={props:["job"],emits:["deletedJob"],data(){return{isComplete:!1,isRunning:!1,isSuccess:!1,pctComplete:0,pctFailed:0,pctRemaining:100,refreshTimeout:200}},mounted(){},computed:{...P({uiOptions:e=>e.configuration.uiOptions})},methods:{close(e){this.$emit("deletedJob",e)},async refresh(e){const t=await p.getJobStatus(e);this.isComplete=t.State=="Success"||t.State=="Failure",this.isRunning=t.State=="Running",this.isSuccess=t.State=="Success",this.isComplete?(this.pctRemaining=0,this.isSuccess?(this.pctComplete=100,this.pctFailed=0):(this.pctComplete=0,this.pctFailed=100)):(this.pctFailed=0,this.pctComplete=t.Progress,this.pctRemaining=100-this.pctComplete),this.isComplete||(this.refreshTimeout=Math.min(this.refreshTimeout+200,2e3),setTimeout(this.refresh,this.refreshTimeout,[e]))}},async mounted(){this.refresh(this.job.id)},components:{Modal:ee}},jc={class:"card border-secondary job-card"},zc={class:"card-header jobs-header"},Gc={class:"progress",style:{width:"90%"}},qc=s("div",{class:"card-body text-secondary jobs-body"},[s("p",{class:"card-text"})],-1);function Wc(e,t,a,u,o,i){return n(),l("div",jc,[s("div",zc,[b(d(a.job.name)+" ",1),s("button",{type:"button",class:"btn-close job-card-close","aria-label":"Close",onClick:t[0]||(t[0]=r=>i.close(a.job.id))}),s("div",Gc,[s("div",{class:"progress-bar bg-success",role:"progressbar",style:F("width: "+this.pctComplete+"%")},null,4),s("div",{class:"progress-bar bg-secondary",role:"progressbar",style:F("width: "+this.pctRemaining+"%")},null,4),s("div",{class:"progress-bar bg-danger",role:"progressbar",style:F("width: "+this.pctFailed+"%")},null,4)])]),qc])}const Jc=L(Hc,[["render",Wc]]),Kc={props:[],data(){return{}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,jobs:e=>e.jobs.jobs,jobsIds:e=>e.jobs.jobsIds})},mounted(){},methods:{onDeletedJobItem(e){this.$store.dispatch("jobs/removeJob",{jobId:e})},getJob(e){return this.jobs[e]}},components:{JobItem:Jc}},Yc={class:"upload-report-list"};function Zc(e,t,a,u,o,i){const r=v("JobItem");return n(),l("div",null,[s("div",Yc,[(n(!0),l(S,null,T(e.jobsIds,h=>(n(),w(r,{job:this.getJob(h),key:h,href:h,onDeletedJob:i.onDeletedJobItem},null,8,["job","href","onDeletedJob"]))),128))])])}const Qc=L(Kc,[["render",Zc]]);let Z=[{name:"English",key:"en"},{name:"Deutsch",key:"de"},{name:"Español",key:"es"},{name:"Français",key:"fr"},{name:"Italiano",key:"it"},{name:"ქართული",key:"ka"},{name:"Русский",key:"ru"},{name:"Slovensko",key:"si"},{name:"Українська",key:"uk"},{name:"中文",key:"zh"}];const Xc={name:"App",props:[],data(){return{availableLanguages:["en"],selectedLanguageName:""}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,isConfigurationLoaded:e=>e.configuration.loaded}),showLanguagePicker(){return this.availableLanguages.length>1},pickableLanguages(){if(this.availableLanguages==null)return Z;{let e=[];for(let t of this.availableLanguages)for(let a of Z)a.key==t&&e.push(a);return e}}},watch:{isConfigurationLoaded(e,t){this.availableLanguages=this.uiOptions.AvailableLanguages;let a=!1;if(this.availableLanguages.length==1){let u=this.availableLanguages[0];console.log("language picker: selecting first and only language: ",u),a=this.changeLanguage(u)}else if(this.availableLanguages.length>1){if(localStorage.getItem("OE2.languageKey")!=null&&(console.log("language picker: selecting language from the local storage"),a=this.changeLanguage(localStorage.getItem("OE2.languageKey"))),!a&&this.uiOptions.DefaultLanguage!=null&&(console.log("language picker: selecting language from DefaultLanguage configuration"),a=this.changeLanguage(this.uiOptions.DefaultLanguage)),!a&&(console.log("language picker: selecting language from the browser languages"),navigator.languages&&navigator.languages.length>0))for(let u of navigator.languages){let o=u.split("-")[0];if(a=this.changeLanguage(o),a)break}a||(a=this.changeLanguage(this.availableLanguages[0]))}}},created(){this.selectedLanguageName="English"},methods:{changeLanguage(e){let t=null;for(let a of Z)a.key==e&&(t=a.name);return t!=null?(this.$i18n.locale=e,this.selectedLanguageName=t,localStorage.setItem("OE2.languageKey",e),this.messageBus.emit("language-changed",e),!0):!1}}},eh={key:0,class:"dropdown"},th={class:"btn btn-sm btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},sh=s("i",{class:"bi bi-translate"},null,-1),ih={class:"dropdown-menu language-picker"},ah=["value"],oh=["onClick"];function nh(e,t,a,u,o,i){return i.showLanguagePicker?(n(),l("div",eh,[s("button",th,[sh,b(" "+d(o.selectedLanguageName),1)]),s("ul",ih,[(n(!0),l(S,null,T(i.pickableLanguages,(r,h)=>(n(),l("li",{key:`lang-${h}`,value:r},[s("a",{class:"dropdown-item",href:"#",onClick:m=>i.changeLanguage(`${r.key}`)},d(r.name),9,oh)],8,ah))),128))])])):c("",!0)}const lh=L(Xc,[["render",nh]]),Te=""+new URL("orthanc-C7xmOuTs.png",import.meta.url).href,rh={props:[],emits:[],data(){return{selectedLabel:null,modalitiesEchoStatus:{}}},computed:{...P({uiOptions:e=>e.configuration.uiOptions,userProfile:e=>e.configuration.userProfile,system:e=>e.configuration.system,queryableDicomModalities:e=>e.configuration.queryableDicomModalities,queryableDicomWebServers:e=>e.configuration.queryableDicomWebServers,studiesIds:e=>e.studies.studiesIds,statistics:e=>e.studies.statistics,labelsFilter:e=>e.studies.labelsFilter,jobs:e=>e.jobs.jobsIds,allLabels:e=>e.labels.allLabels,hasCustomLogo:e=>e.configuration.hasCustomLogo,configuration:e=>e.configuration,studiesSourceType:e=>e.studies.sourceType,studiesRemoteSource:e=>e.studies.remoteSource}),customLogoUrl(){return this.hasCustomLogo&&this.configuration.customLogoUrl?this.customLogoUrl:"./customizable/custom-logo"},hasQueryableDicomWebServers(){return this.queryableDicomWebServers.length>0},hasQueryableDicomModalities(){return this.uiOptions.EnableDicomModalities&&this.queryableDicomModalities.length>0},hasAccessToSettings(){return this.uiOptions.EnableSettings},hasAccessToSettingsLabelsAndPermissions(){return this.hasAccessToSettings&&this.uiOptions.EnablePermissionsEdition},hasJobs(){return this.jobs.length>0},hasLogout(){return window.keycloak!==void 0},hasUserProfile(){return this.userProfile!=null&&this.userProfile.name},displayedStudyCount(){return this.studiesSourceType==g.LOCAL_ORTHANC?this.studiesIds.length:"-"},orthancApiUrl(){return we}},methods:{isSelectedModality(e){return this.studiesSourceType==g.REMOTE_DICOM&&this.studiesRemoteSource==e},isSelectedDicomWebServer(e){return this.studiesSourceType==g.REMOTE_DICOM_WEB&&this.studiesRemoteSource==e},isEchoRunning(e){return this.modalitiesEchoStatus[e]==null},isEchoSuccess(e){return this.modalitiesEchoStatus[e]==!0},selectLabel(e){this.selectedLabel=e,this.messageBus.emit("filter-label-changed",e)},isSelectedLabel(e){return this.labelsFilter.includes(e)},onAllLabelsChanged(){this.$store.dispatch("labels/refresh")},logout(e){e.preventDefault();let t={redirectUri:window.location.href};window.keycloak.logout(t).then(a=>{console.log("logout success",a)}).catch(a=>{console.error("logout failed",a)})},changePassword(e){e.preventDefault(),window.keycloak.login({action:"UPDATE_PASSWORD"}).then(t=>{console.log("login for password change success",t)}).catch(t=>{console.error("login for password change failed",t)})}},mounted(){this.$refs["modalities-collapsible"].addEventListener("show.bs.collapse",e=>{for(const t of this.queryableDicomModalities)this.modalitiesEchoStatus[t]=null;for(const t of this.queryableDicomModalities)p.remoteModalityEcho(t).then(a=>{this.modalitiesEchoStatus[t]=!0}).catch(()=>{this.modalitiesEchoStatus[t]=!1})})},components:{UploadHandler:xc,JobsList:Qc,LanguagePicker:lh}},O=e=>(V("data-v-79b9e1db"),e=e(),B(),e),dh={class:"nav-side-menu"},uh={class:"nav-side-content"},ch={key:0},hh=O(()=>s("img",{class:"orthanc-logo",src:Te},null,-1)),mh=[hh],ph={key:1},gh=["src"],bh={key:2},yh=O(()=>s("p",{class:"powered-by-orthanc"},[b(" powered by "),s("img",{src:Te})],-1)),fh=[yh],_h={key:3,class:"orthanc-name"},Dh={class:"menu-list"},vh={id:"menu-content",class:"menu-content collapse out"},Sh={class:"d-flex align-items-center fix-router-link"},Th=O(()=>s("i",{class:"fa fa-x-ray fa-lg menu-icon"},null,-1)),Ih={class:"study-count ms-auto"},wh={key:0,class:"sub-menu",id:"labels-list"},kh=["onClick"],Lh=O(()=>s("i",{class:"fa fa-tag label-icon"},null,-1)),Mh={key:1,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#upload-handler"},Oh=O(()=>s("i",{class:"fa fa-file-upload fa-lg menu-icon"},null,-1)),Ch=O(()=>s("span",{class:"ms-auto"},null,-1)),Ph={key:2,class:"collapse",id:"upload-handler"},$h={key:3,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#modalities-list"},Rh=O(()=>s("i",{class:"fa fa-radiation fa-lg menu-icon"},null,-1)),Uh=O(()=>s("span",{class:"arrow ms-auto"},null,-1)),Ah={class:"sub-menu collapse",id:"modalities-list",ref:"modalities-collapsible"},Eh={key:0,class:"ms-auto spinner-border spinner-border-sm","data-bs-toggle":"tooltip",title:"Checking connectivity"},Fh={key:1,class:"ms-auto"},Vh=O(()=>s("i",{class:"bi bi-check2 text-success echo-status","data-bs-toggle":"tooltip",title:"C-Echo succeeded"},null,-1)),Bh=[Vh],Nh={key:2,class:"ms-auto"},xh=O(()=>s("i",{class:"bi bi-x-lg text-danger echo-status","data-bs-toggle":"tooltip",title:"C-Echo failed"},null,-1)),Hh=[xh],jh={key:4,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#dicomweb-servers-list"},zh=O(()=>s("i",{class:"fa fa-globe fa-lg menu-icon"},null,-1)),Gh=O(()=>s("span",{class:"arrow ms-auto"},null,-1)),qh={class:"sub-menu collapse",id:"dicomweb-servers-list"},Wh={key:5,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#settings-list"},Jh=O(()=>s("i",{class:"fa fa-cogs fa-lg menu-icon"},null,-1)),Kh=O(()=>s("span",{class:"arrow ms-auto"},null,-1)),Yh={class:"sub-menu collapse",id:"settings-list"},Zh={key:0},Qh={key:1},Xh={key:6,class:"d-flex align-items-center fix-router-link"},em=["href"],tm=O(()=>s("i",{class:"fa fa-solid fa-backward fa-lg menu-icon"},null,-1)),sm=O(()=>s("span",{class:"ms-auto"},null,-1)),im={key:7,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#profile-list"},am=O(()=>s("i",{class:"fa fa-user fa-lg menu-icon"},null,-1)),om={key:0},nm={key:1},lm=O(()=>s("span",{class:"arrow ms-auto"},null,-1)),rm={class:"sub-menu collapse",id:"profile-list",ref:"profile-collapsible"},dm={key:0,class:"d-flex align-items-center fix-router-link"},um=O(()=>s("i",{class:"fa fa-solid fa-key fa-lg menu-icon"},null,-1)),cm=O(()=>s("span",{class:"ms-auto"},null,-1)),hm={key:1,class:"d-flex align-items-center fix-router-link"},mm=O(()=>s("i",{class:"fa fa-solid fa-arrow-right-from-bracket fa-lg menu-icon"},null,-1)),pm=O(()=>s("span",{class:"ms-auto"},null,-1)),gm={key:8,class:"d-flex align-items-center"},bm={href:"#"},ym=O(()=>s("i",{class:"fa fa-solid fa-bars-progress fa-lg menu-icon"},null,-1)),fm=O(()=>s("span",{class:"ms-auto"},null,-1)),_m={key:9,class:"collapse show",id:"jobs-list"},Dm={class:"bottom-side-bar"},vm={class:"bottom-side-bar-button"};function Sm(e,t,a,u,o,i){const r=v("router-link"),h=v("UploadHandler"),m=v("JobsList"),y=v("LanguagePicker");return n(),l("div",dh,[s("div",uh,[e.hasCustomLogo?c("",!0):(n(),l("div",ch,mh)),e.hasCustomLogo?(n(),l("div",ph,[s("img",{class:"custom-logo",src:i.customLogoUrl},null,8,gh)])):c("",!0),e.hasCustomLogo?(n(),l("div",bh,fh)):c("",!0),e.uiOptions.ShowOrthancName?(n(),l("div",_h,[s("p",null,d(e.system.Name),1)])):c("",!0),s("div",Dh,[s("ul",vh,[s("li",Sh,[D(r,{class:"router-link",to:"/"},{default:E(()=>[Th,b(d(e.$t("local_studies"))+" ",1),s("span",Ih,d(i.displayedStudyCount)+" / "+d(e.statistics.CountStudies),1)]),_:1})]),e.allLabels.length>0?(n(),l("ul",wh,[(n(!0),l(S,null,T(e.allLabels,f=>(n(),l("li",{key:f,class:k({active:i.isSelectedLabel(f)}),onClick:R=>i.selectLabel(f)},[Lh,b(" "+d(f),1)],10,kh))),128))])):c("",!0),e.uiOptions.EnableUpload?(n(),l("li",Mh,[Oh,b(d(e.$t("upload"))+" ",1),Ch])):c("",!0),e.uiOptions.EnableUpload?(n(),l("div",Ph,[D(h)])):c("",!0),i.hasQueryableDicomModalities?(n(),l("li",$h,[Rh,b(d(e.$t("dicom_modalities"))+" ",1),Uh])):c("",!0),s("ul",Ah,[(n(!0),l(S,null,T(e.queryableDicomModalities,f=>(n(),l("li",{key:f,class:k({active:this.isSelectedModality(f)})},[D(r,{class:"router-link",to:{path:"/filtered-studies",query:{"source-type":"dicom","remote-source":f}}},{default:E(()=>[b(d(f),1)]),_:2},1032,["to"]),this.isEchoRunning(f)?(n(),l("span",Eh)):this.isEchoSuccess(f)?(n(),l("span",Fh,Bh)):(n(),l("span",Nh,Hh))],2))),128))],512),i.hasQueryableDicomWebServers?(n(),l("li",jh,[zh,b(d(e.$t("dicom_web_servers"))+" ",1),Gh])):c("",!0),s("ul",qh,[(n(!0),l(S,null,T(e.queryableDicomWebServers,f=>(n(),l("li",{key:f,class:k({active:this.isSelectedDicomWebServer(f)})},[D(r,{class:"router-link",to:{path:"/filtered-studies",query:{"source-type":"dicom-web","remote-source":f}}},{default:E(()=>[b(d(f),1)]),_:2},1032,["to"])],2))),128))]),i.hasAccessToSettings?(n(),l("li",Wh,[Jh,b(d(e.$t("settings.title"))+" ",1),Kh])):c("",!0),s("ul",Yh,[s("li",null,[D(r,{class:"router-link",to:"/settings"},{default:E(()=>[b(d(e.$t("settings.system_info")),1)]),_:1})]),i.hasAccessToSettingsLabelsAndPermissions?(n(),l("li",Zh,[D(r,{class:"router-link",to:"/settings-labels"},{default:E(()=>[b(d(e.$t("settings.available_labels_title")),1)]),_:1})])):c("",!0),i.hasAccessToSettingsLabelsAndPermissions?(n(),l("li",Qh,[D(r,{class:"router-link",to:"/settings-permissions"},{default:E(()=>[b(d(e.$t("settings.permissions")),1)]),_:1})])):c("",!0)]),e.uiOptions.EnableLinkToLegacyUi?(n(),l("li",Xh,[s("a",{href:this.orthancApiUrl+"app/explorer.html"},[tm,b(d(e.$t("legacy_ui")),1)],8,em),sm])):c("",!0),i.hasLogout?(n(),l("li",im,[am,i.hasUserProfile?(n(),l("span",om,d(e.userProfile.name),1)):c("",!0),i.hasUserProfile?c("",!0):(n(),l("span",nm,d(e.$t("profile")),1)),lm])):c("",!0),s("ul",rm,[e.uiOptions.EnableChangePassword?(n(),l("li",dm,[s("a",{href:"#",onClick:t[0]||(t[0]=f=>i.changePassword(f))},[um,b(d(e.$t("change_password")),1)]),cm])):c("",!0),i.hasLogout?(n(),l("li",hm,[s("a",{href:"#",onClick:t[1]||(t[1]=f=>i.logout(f))},[mm,b(d(e.$t("logout")),1)]),pm])):c("",!0)],512),i.hasJobs?(n(),l("li",gm,[s("a",bm,[ym,b(d(e.$t("my_jobs")),1)]),fm])):c("",!0),i.hasJobs?(n(),l("div",_m,[D(m)])):c("",!0)])]),s("div",Dm,[s("div",vm,[D(y)])])])])}const N=L(rh,[["render",Sm],["__scopeId","data-v-79b9e1db"]]),Tm={props:[],data(){return{path:null}},mounted(){this.path=this.$router.currentRoute.value.fullPath}},Im={class:"alert alert-danger",role:"alert"},wm=s("br",null,null,-1);function km(e,t,a,u,o,i){return n(),l("div",Im,[b(d(e.$t("page_not_found"))+" ",1),wm,b(" "+d(o.path),1)])}const Lm=L(Tm,[["render",km]]),Mm=""+new URL("haske-CYf2ksCC.png",import.meta.url).href,Om={props:["id","name","birthDate","sex"],data(){return{patientName:this.name||"",patientId:this.id||"",patientDob:this.birthDate||"",patientGender:this.sex||"",studyDate:"",studyType:"",Modality:"",BodyPartExamined:"",InstitutionName:"",ReferringPhysicianName:"",clinicalindications:"",procedure:"",technique:"",findings:"",overallImpression:"",comparison:"",radiologistName:"",signaturePad:null,signatureImage:null,signatureDate:"",manualPatientName:"",manualPatientDob:"",manualPatientGender:"",manualStudyDate:"",manualStudyType:"",manualModality:"",manualBodyPartExamined:"",manualInstitutionName:""}},computed:{formattedGender(){return this.patientGender==="F"?"Female":this.patientGender==="M"?"Male":this.patientGender||this.manualPatientGender||""}},methods:{formatDate(e){if(!e)return"";const[t,a,u]=[e.slice(0,4),e.slice(4,6),e.slice(6)];return`${t}/${a}/${u}`},formatName(e){return e.replace(/[^\w\s]|_/g," ").replace(/\s+/g," ").trim()},async fetchPatientDetails(){const e=this.$route.params.id;try{const t=await p.getStudy(e),a=await p.getStudySeries(e);console.log("Study Series:",a);const u=a.length>0?a[0]:null;this.patientName=this.formatName(t.PatientMainDicomTags.PatientName)||"",this.patientId=t.PatientMainDicomTags.PatientID||"",this.patientDob=this.formatDate(t.PatientMainDicomTags.PatientBirthDate)||"",this.patientGender=t.PatientMainDicomTags.PatientSex||"",this.studyDate=this.formatDate(t.MainDicomTags.StudyDate)||"",this.studyType=t.MainDicomTags.StudyDescription||"",this.ReferringPhysicianName=this.formatName(t.MainDicomTags.ReferringPhysicianName)||"",u?(this.Modality=u.MainDicomTags.Modality||"",this.BodyPartExamined=u.MainDicomTags.BodyPartExamined||""):(this.Modality="",this.BodyPartExamined=""),this.InstitutionName=t.MainDicomTags.InstitutionName||""}catch(t){console.error("Error fetching patient details:",t)}},clearSignature(){this.signaturePad.clear(),this.signatureImage=null},uploadSignature(e){const t=e.target.files[0],a=new FileReader;a.onload=u=>{const o=new Image;o.src=u.target.result,o.onload=()=>{this.signaturePad.clear(),this.signaturePad.fromDataURL(o.src)}},a.readAsDataURL(t)},saveReport(){const e=this.$route.params.id,t={patientName:this.patientName||this.manualPatientName,patientId:this.patientId,patientDob:this.patientDob||this.manualPatientDob,patientGender:this.patientGender||this.manualPatientGender,studyDate:this.studyDate||this.manualStudyDate,studyType:this.studyType||this.manualStudyType,Modality:this.Modality||this.manualModality,BodyPartExamined:this.BodyPartExamined||this.manualBodyPartExamined,InstitutionName:this.InstitutionName||this.manualInstitutionName,clinicalindications:this.clinicalindications,procedure:this.procedure,technique:this.technique,findings:this.findings,overallImpression:this.overallImpression,comparison:this.comparison,radiologistName:this.radiologistName,signature:this.signaturePad.toDataURL(),signatureDate:this.signatureDate};localStorage.setItem(`report_${e}`,JSON.stringify(t)),alert("Report saved successfully!")},loadReport(){const e=this.$route.params.id,t=JSON.parse(localStorage.getItem(`report_${e}`));if(t){if(this.patientName=t.patientName||"",this.patientDob=t.patientDob||"",this.patientGender=t.patientGender||"",this.studyDate=t.studyDate||"",this.studyType=t.studyType||"",this.Modality=t.Modality||"",this.BodyPartExamined=t.BodyPartExamined||"",this.InstitutionName=t.InstitutionName||"",this.ReferringPhysicianName=t.ReferringPhysicianName||"",this.clinicalindications=t.clinicalindications||"",this.procedure=t.procedure||"",this.technique=t.technique||"",this.findings=t.findings||"",this.overallImpression=t.overallImpression||"",this.comparison=t.comparison||"",this.radiologistName=t.radiologistName||"",t.signature){const a=new Image;a.src=t.signature,a.onload=()=>{this.signaturePad.clear(),this.signaturePad.fromDataURL(a.src)}}this.signatureDate=t.signatureDate||"",this.manualPatientName=this.patientName,this.manualPatientDob=this.patientDob,this.manualPatientGender=this.patientGender,this.manualStudyDate=this.studyDate,this.manualStudyType=this.studyType,this.manualModality=this.Modality,this.manualBodyPartExamined=this.BodyPartExamined,this.manualInstitutionName=this.InstitutionName}},downloadReportAsWord(){const e=new Be,t=(a,u=!1,o=!1,i=H.LEFT)=>new xe({children:[new He({text:a,bold:u,italics:o})],alignment:i});e.addSection({properties:{},children:[t("Medical Imaging Report",!0,!1,H.CENTER),t("Patient Information:",!0,!1,H.CENTER),t(`Patient Name: ${this.patientName}`),t(`Patient ID: ${this.patientId}`),t(`Date of Birth: ${this.patientDob}`),t(`Gender: ${this.patientGender}`),t(`Institution Name: ${this.InstitutionName}`),t(`Referring Physician: ${this.ReferringPhysicianName}`),t("Examination Details:",!0,!1,H.CENTER),t(`Body Parts: ${this.BodyPartExamined}`),t(`Modality: ${this.Modality}`),t(`Study Date: ${this.studyDate}`),t(`Study Type: ${this.studyType}`),t("Report Content:",!0,!1,H.CENTER),t(`Clinical Indications: ${this.clinicalindications}`),t(`Procedure: ${this.procedure}`),t(`Technique: ${this.technique}`),t(`Findings: ${this.findings}`),t(`Overall Impression: ${this.overallImpression}`),t(`Comparison: ${this.comparison}`),t("Signed:",!0,!1,H.CENTER),t(`Name: ${this.radiologistName}`),t(`Signature Date: ${this.signatureDate}`)]}),Ne.toBlob(e).then(a=>{ze.saveAs(a,`${this.patientName}_Medical_Imaging_Report.docx`)})},downloadReportAsPDF(){const e=new Ve,t=new Image;t.src=Mm,t.onload=()=>{let a=0;const u=()=>{e.addImage(t,"PNG",85,5,40,10),e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Report",105,30,null,null,"center"),e.setDrawColor(0,0,0),e.line(20,35,190,35)},o=()=>{e.setFontSize(10),e.setFont("helvetica","italic"),e.text("sourced by Haske.",175,290),e.setFontSize(12)},i=()=>{e.addPage(),u(),r=2,e.setFontSize(12),o()};u(),o();let r=40;const h=7;e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Patient Information:",105,r,null,null,"center"),r+=5,e.line(20,r,190,r),r+=10,[{label:"Patient Name:",value:this.patientName},{label:"Patient ID:",value:this.patientId},{label:"Date of Birth:",value:this.patientDob},{label:"Gender:",value:this.patientGender},{label:"Institution Name:",value:this.InstitutionName},{label:"Referring Physician:",value:this.ReferringPhysicianName}].forEach(M=>{this.checkSpace(e,r,h)&&i(),e.setFont("helvetica","bold"),e.text(M.label,20,r),e.setFont("helvetica","normal"),e.text(M.value,60,r),r+=h}),r+=5,e.line(20,r-5,190,r-5),e.setFont("helvetica","bold"),e.text("Examination Details:",105,r,null,null,"center"),e.line(20,r+5,190,r+5),r+=15;const f=[{label:"Body Parts:",value:this.BodyPartExamined,x:20},{label:"Modality:",value:this.Modality,x:20},{label:"Study Date:",value:this.studyDate,x:110},{label:"Study Type:",value:this.studyType,x:110}];let R=r;if(f.slice(0,2).forEach(M=>{this.checkSpace(e,r,h)&&i(),e.setFont("helvetica","bold"),e.text(M.label,M.x,r),e.setFont("helvetica","normal"),e.text(M.value,M.x+40,r),r+=h}),r=R,f.slice(2).forEach(M=>{this.checkSpace(e,r,h)&&i(),e.setFont("helvetica","bold"),e.text(M.label,M.x,r),e.setFont("helvetica","normal"),e.text(M.value,M.x+40,r),r+=h}),e.line(20,r,190,r),r+=5,e.setFont("helvetica","bold"),e.text("Report Content:",105,r,null,null,"center"),r+=5,e.line(20,r,190,r),r+=10,[{label:"Clinical Indications",value:this.clinicalindications},{label:"Procedure",value:this.procedure},{label:"Technique",value:this.technique},{label:"Findings",value:this.findings},{label:"Overall Impression",value:this.overallImpression},{label:"Comparison",value:this.comparison}].forEach(M=>{this.checkSpace(e,r,20)&&i(),e.setFont("helvetica","bold"),e.text(M.label,20,r),e.setFont("helvetica","normal");const se=e.splitTextToSize(M.value,175);r+=5,se.forEach((Ie,ie)=>{this.checkSpace(e,r+ie*5,h)&&i(),e.setFont("helvetica","normal"),e.text(Ie,20,r+ie*6)}),r+=se.length*6+h}),this.checkSpace(e,r,50)&&i(),e.setFont("helvetica","bold"),e.text("Signed:",105,r,null,null,"center"),r+=5,e.line(20,r,190,r),r+=10,e.text("Name:",20,r),e.setFont("helvetica","normal"),e.text(this.radiologistName,40,r),r+=10,!this.signaturePad.isEmpty()){const M=this.signaturePad.toDataURL();e.addImage(M,"PNG",20,r-5,50,20),r+=25}e.setFont("helvetica","bold"),e.text("Signature Date:",20,r),e.setFont("helvetica","normal"),e.text(this.signatureDate,58,r),r+=10,a=e.internal.getNumberOfPages();for(let M=1;M<=a;M++)e.setPage(M),e.setFontSize(10),e.setFont("helvetica","italic"),e.text(`Page ${M} of ${a}`,105,290,null,null,"center");e.save(`${this.patientName}_Medical_Imaging_Report.pdf`)},t.onerror=()=>{console.error("Error loading logo image.")}},checkSpace(e,t,a){const u=e.internal.pageSize.getHeight();return t+a>u-20}},mounted(){const e=document.getElementById("signature-pad");this.signaturePad=new je(e),this.loadReport(),this.fetchPatientDetails()}},U=e=>(V("data-v-35dba7d1"),e=e(),B(),e),Cm={class:"report-page"},Pm=U(()=>s("header",null,[s("h1",null," Report")],-1)),$m={class:"full-width-section patient-info"},Rm=U(()=>s("h2",null,"Patient Information",-1)),Um={class:"patient-row"},Am={class:"form-group"},Em=U(()=>s("label",null,[s("i",{class:"fas fa-user"}),b(" Name")],-1)),Fm={class:"patient-detail"},Vm={class:"form-group"},Bm=U(()=>s("label",null,[s("i",{class:"fas fa-id-badge"}),b(" Patient ID")],-1)),Nm={class:"patient-detail"},xm={class:"form-group"},Hm=U(()=>s("label",null,[s("i",{class:"fas fa-calendar-alt"}),b(" Date of Birth")],-1)),jm={class:"patient-detail"},zm={class:"form-group"},Gm=U(()=>s("label",null,[s("i",{class:"fas fa-venus-mars"}),b(" Gender")],-1)),qm={class:"patient-detail"},Wm={class:"patient-row"},Jm={class:"form-group"},Km=U(()=>s("label",null,[s("i",{class:"fas fa-calendar-day"}),b(" Study Date")],-1)),Ym={class:"patient-detail"},Zm={class:"form-group"},Qm=U(()=>s("label",null,[s("i",{class:"fas fa-stethoscope"}),b(" Study Type")],-1)),Xm={class:"patient-detail"},ep={class:"form-group"},tp=U(()=>s("label",null,[s("i",{class:"fas fa-stethoscope"}),b(" Modality")],-1)),sp={class:"patient-detail"},ip={class:"form-group"},ap=U(()=>s("label",null,[s("i",{class:"fas fa-stethoscope"}),b(" Body Part")],-1)),op={class:"patient-detail"},np={class:"form-group"},lp=U(()=>s("label",null,[s("i",{class:"fas fa-stethoscope"}),b(" Institution Name ")],-1)),rp={class:"patient-detail"},dp={class:"form-group"},up=U(()=>s("label",null,[s("i",{class:"fas fa-stethoscope"}),b(" Referring Physician")],-1)),cp={class:"patient-detail"},hp={class:"full-width-section report-content"},mp=U(()=>s("h2",null,"Report Content",-1)),pp={class:"form-column"},gp={class:"form-group"},bp={class:"form-group"},yp={class:"form-group"},fp={class:"form-group"},_p={class:"form-group"},Dp={class:"form-group"},vp={class:"full-width-section radiologist-info"},Sp=U(()=>s("h2",null,"Radiologist Details",-1)),Tp={class:"form-group"},Ip={class:"signature-section"},wp=U(()=>s("label",null,"Signature",-1)),kp={class:"signature-container"},Lp=U(()=>s("canvas",{id:"signature-pad",width:"300",height:"150",style:{border:"1px solid #ccc"}},null,-1)),Mp={class:"signature-actions"},Op={class:"form-group"},Cp=U(()=>s("label",null,[s("i",{class:"fas fa-calendar-alt"}),b(" Signature Date")],-1)),Pp={class:"actions"};function $p(e,t,a,u,o,i){return n(),l("div",Cm,[Pm,s("section",$m,[Rm,s("div",Um,[s("div",Am,[Em,s("span",Fm,d(o.patientName||o.manualPatientName),1),o.patientName?c("",!0):I((n(),l("input",{key:0,type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>o.manualPatientName=r),placeholder:"Enter patient name"},null,512)),[[C,o.manualPatientName]])]),s("div",Vm,[Bm,s("span",Nm,d(o.patientId||"N/A"),1)]),s("div",xm,[Hm,s("span",jm,d(o.patientDob||o.manualPatientDob),1),o.patientDob?c("",!0):I((n(),l("input",{key:0,type:"date","onUpdate:modelValue":t[1]||(t[1]=r=>o.manualPatientDob=r)},null,512)),[[C,o.manualPatientDob]])]),s("div",zm,[Gm,s("span",qm,d(i.formattedGender),1),o.patientGender?c("",!0):I((n(),l("input",{key:0,type:"text","onUpdate:modelValue":t[2]||(t[2]=r=>o.manualPatientGender=r),placeholder:"Enter gender"},null,512)),[[C,o.manualPatientGender]])])]),s("div",Wm,[s("div",Jm,[Km,s("span",Ym,d(o.studyDate||o.manualStudyDate),1),o.studyDate?c("",!0):I((n(),l("input",{key:0,type:"date","onUpdate:modelValue":t[3]||(t[3]=r=>o.manualStudyDate=r)},null,512)),[[C,o.manualStudyDate]])]),s("div",Zm,[Qm,s("span",Xm,d(o.studyType||o.manualStudyType),1),o.studyType?c("",!0):I((n(),l("input",{key:0,type:"text","onUpdate:modelValue":t[4]||(t[4]=r=>o.manualStudyType=r),placeholder:"Enter study type"},null,512)),[[C,o.manualStudyType]])]),s("div",ep,[tp,s("span",sp,d(o.Modality||o.manualModality),1),o.Modality?c("",!0):I((n(),l("input",{key:0,type:"text","onUpdate:modelValue":t[5]||(t[5]=r=>o.manualModality=r),placeholder:"Enter Modality"},null,512)),[[C,o.manualModality]])]),s("div",ip,[ap,s("span",op,d(o.BodyPartExamined||o.manualBodyPartExamined),1),o.BodyPartExamined?c("",!0):I((n(),l("input",{key:0,type:"text","onUpdate:modelValue":t[6]||(t[6]=r=>o.manualBodyPartExamined=r),placeholder:"Enter Modality"},null,512)),[[C,o.manualBodyPartExamined]])]),s("div",np,[lp,s("span",rp,d(o.InstitutionName||o.manualInstitutionName),1),o.InstitutionName?c("",!0):I((n(),l("input",{key:0,type:"text","onUpdate:modelValue":t[7]||(t[7]=r=>o.manualInstitutionName=r),placeholder:"Enter Institution Name "},null,512)),[[C,o.manualInstitutionName]])]),s("div",dp,[up,s("span",cp,d(e.referringPhysicianName),1)])])]),s("section",hp,[mp,s("div",pp,[s("div",gp,[I(s("textarea",{"onUpdate:modelValue":t[8]||(t[8]=r=>o.clinicalindications=r),placeholder:"Enter Clinical Indications"},null,512),[[C,o.clinicalindications]])]),s("div",bp,[I(s("textarea",{"onUpdate:modelValue":t[9]||(t[9]=r=>o.procedure=r),placeholder:"Enter Procedure"},null,512),[[C,o.procedure]])]),s("div",yp,[I(s("textarea",{"onUpdate:modelValue":t[10]||(t[10]=r=>o.technique=r),placeholder:"Enter Technique"},null,512),[[C,o.technique]])]),s("div",fp,[I(s("textarea",{"onUpdate:modelValue":t[11]||(t[11]=r=>o.findings=r),placeholder:"Enter Findings"},null,512),[[C,o.findings]])]),s("div",_p,[I(s("textarea",{"onUpdate:modelValue":t[12]||(t[12]=r=>o.overallImpression=r),placeholder:"Overall Impression"},null,512),[[C,o.overallImpression]])]),s("div",Dp,[I(s("textarea",{"onUpdate:modelValue":t[13]||(t[13]=r=>o.comparison=r),placeholder:"Comparison"},null,512),[[C,o.comparison]])])])]),s("section",vp,[Sp,s("div",Tp,[I(s("textarea",{"onUpdate:modelValue":t[14]||(t[14]=r=>o.radiologistName=r),placeholder:"Radiologist Name"},null,512),[[C,o.radiologistName]])]),s("div",Ip,[wp,s("div",kp,[Lp,s("div",Mp,[s("button",{onClick:t[15]||(t[15]=(...r)=>i.clearSignature&&i.clearSignature(...r)),class:"action-btn"},"Clear Signature"),s("input",{type:"file",onChange:t[16]||(t[16]=(...r)=>i.uploadSignature&&i.uploadSignature(...r)),accept:"image/*",class:"browse-button"},null,32)])]),s("div",Op,[Cp,I(s("input",{type:"date","onUpdate:modelValue":t[17]||(t[17]=r=>o.signatureDate=r),class:"date-input"},null,512),[[C,o.signatureDate]])])])]),s("section",Pp,[s("button",{onClick:t[18]||(t[18]=(...r)=>i.saveReport&&i.saveReport(...r)),class:"action-btn"},"Save Report"),s("button",{onClick:t[19]||(t[19]=(...r)=>i.downloadReportAsPDF&&i.downloadReportAsPDF(...r)),class:"action-btn secondary"},"Download Report")])])}const Rp=L(Om,[["render",$p],["__scopeId","data-v-35dba7d1"]]);console.log("Base URL for router: ",he);function Up(e,t,a){e.path.includes("&state=")?(console.log("removeKeyCloakStates",e,t),a(!1)):a()}const W=Pe({history:$e(he),routes:[{path:"/",alias:"/index.html",components:{SideBarView:N,ContentView:ue}},{path:"/filtered-studies",components:{SideBarView:N,ContentView:ue}},{path:"/settings",components:{SideBarView:N,ContentView:jt}},{path:"/settings-labels",components:{SideBarView:N,ContentView:hs}},{path:"/settings-permissions",components:{SideBarView:N,ContentView:Ii}},{path:"/report/:id",name:"reportPage",components:{SideBarView:N,ContentView:Rp},props:{ContentView:!0}},{path:"/:pathMatch(.*)",beforeEnter:Up,components:{SideBarView:N,ContentView:Lm}}]}),Ap=["token","auth-token","authorization"];qe.get("../api/pre-login-configuration").then(e=>{const t=Ce(et),a=Je();t.use(W),t.use(ke),t.use(Le),t.component("Datepicker",We),t.config.globalProperties.messageBus=a;let u=null;if(e.data.Keycloak&&e.data.Keycloak!=null&&e.data.Keycloak.Enable){console.log("Keycloak is enabled"),u=e.data.Keycloak;let o={url:u.Url,realm:u.Realm,clientId:u.ClientId,onLoad:"login-required"};window.keycloak=new Ge(o),window.keycloak.init({onLoad:o.onLoad}).then(async i=>{i?console.log("Authenticated"):window.location.reload(),localStorage.setItem("vue-token",window.keycloak.token),localStorage.setItem("vue-refresh-token",window.keycloak.refreshToken),p.updateAuthHeader(),t.mount("#app"),console.log("App mounted with keycloak, current route is ",W.currentRoute.value.fullPath);const r=new URLSearchParams(W.currentRoute.value.fullPath);r.delete("state"),r.delete("code"),r.delete("session_state");const h=decodeURIComponent(r.toString()).replace("/=","/");console.log("App mounted, moving to cleaned route ",h),await W.push(h),setInterval(()=>{window.keycloak.updateToken(70).then(m=>{m?(console.log("Token refreshed"),localStorage.setItem("vue-token",window.keycloak.token),localStorage.setItem("vue-refresh-token",window.keycloak.refreshToken),p.updateAuthHeader()):console.log("Token not refreshed, valid for "+Math.round(window.keycloak.tokenParsed.exp+window.keycloak.timeSkew-new Date().getTime()/1e3)+" seconds")}).catch(()=>{console.log("Failed to refresh token")})},6e4)}).catch(()=>{console.log("Could not connect to Keycloak")})}else{const o=new URLSearchParams(window.location.search);for(let i of Ap){const r=o.get(i);r&&(localStorage.setItem(i,r),p.updateAuthHeader(i))}t.mount("#app")}});
